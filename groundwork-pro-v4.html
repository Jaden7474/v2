<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Groundwork Pro - Excavation Management Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Leaflet.js for real maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c' },
            dark: { 900: '#151515', 800: '#1f1f1f', 700: '#2a2a2a' }
          },
          borderRadius: {
            'sm': '0.25rem',
            'DEFAULT': '0.375rem',
            'md': '0.375rem',
            'lg': '0.5rem',
            'xl': '0.625rem',
            '2xl': '0.75rem',
          }
        }
      }
    }
  </script>
  <style>
    /* Dozer Font */
    @font-face {
      font-family: 'Dozer';
      src: url('./Dozer.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    /* Dozer font for headings and key UI elements */
    .font-dozer { font-family: 'Dozer', sans-serif; }
    h1, h2, h3, .text-5xl, .text-6xl, .text-4xl, .text-3xl, .text-2xl {
      font-family: 'Dozer', sans-serif;
      letter-spacing: 0.02em;
    }
    /* Stat card numbers */
    .stat-value { font-family: 'Dozer', sans-serif; }
    /* Navigation labels */
    nav button span { font-family: 'Dozer', sans-serif; letter-spacing: 0.03em; }

    .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 2px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #ccc; border-radius: 2px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #aaa; }
    .drag-over { background: #fff7ed !important; border: 2px dashed #f97316 !important; }
    .dragging { opacity: 0.5; }
    @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pulse-dot { animation: pulse-dot 2s infinite; }
    /* Tighter corners globally */
    .rounded-lg { border-radius: 0.5rem !important; }
    .rounded-xl { border-radius: 0.625rem !important; }
    .rounded-2xl { border-radius: 0.75rem !important; }
    .rounded-full { border-radius: 9999px !important; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ============================================
    // MOCK DATA - Would come from API in production
    // ============================================

    const JOBS = [
      { id: 1, name: 'Highway 71 Widening', client: 'ODOT', status: 'active', address: '4521 Highway 71, Columbus, OH', budget: 2850000, spent: 1847500, startDate: '2025-11-01', endDate: '2026-04-15', progress: 65, lat: 39.9612, lng: -82.9988 },
      { id: 2, name: 'Riverside Development', client: 'Kaufman Development', status: 'active', address: '892 River Rd, Cincinnati, OH', budget: 1200000, spent: 485000, startDate: '2025-12-15', endDate: '2026-06-30', progress: 35, lat: 39.1031, lng: -84.5120 },
      { id: 3, name: 'Downtown Parking Garage', client: 'City of Dayton', status: 'active', address: '100 Main St, Dayton, OH', budget: 890000, spent: 267000, startDate: '2026-01-10', endDate: '2026-05-20', progress: 25, lat: 39.7589, lng: -84.1916 },
      { id: 4, name: 'Maple Ridge Subdivision', client: 'DR Horton', status: 'bidding', address: '2000 Maple Dr, Dublin, OH', budget: 1500000, spent: 0, startDate: '2026-03-01', endDate: '2026-09-30', progress: 0, lat: 40.0992, lng: -83.1141 },
      { id: 5, name: 'Industrial Park Phase 2', client: 'Prologis', status: 'completed', address: '500 Commerce Blvd, Grove City, OH', budget: 675000, spent: 628000, startDate: '2025-06-01', endDate: '2025-12-20', progress: 100, lat: 39.8812, lng: -83.0930 },
    ];

    const EQUIPMENT = [
      { id: 1, name: 'CAT 336 Excavator', type: 'Excavator', status: 'active', jobId: 1, hours: 4521, nextService: 4750, fuelLevel: 72, lat: 39.9615, lng: -82.9985, lastUpdate: '2 min ago', dailyRate: 850, owned: true, purchasePrice: 385000, purchaseDate: '2022-03-15' },
      { id: 2, name: 'CAT D6 Dozer', type: 'Dozer', status: 'active', jobId: 1, hours: 3892, nextService: 4000, fuelLevel: 45, lat: 39.9610, lng: -82.9990, lastUpdate: '5 min ago', dailyRate: 750, owned: true, purchasePrice: 320000, purchaseDate: '2021-08-20' },
      { id: 3, name: 'Volvo A40G', type: 'Haul Truck', status: 'active', jobId: 2, hours: 2156, nextService: 2250, fuelLevel: 89, lat: 39.1035, lng: -84.5125, lastUpdate: '1 min ago', dailyRate: 650, owned: true, purchasePrice: 425000, purchaseDate: '2023-01-10' },
      { id: 4, name: 'CAT 14M Grader', type: 'Grader', status: 'maintenance', jobId: null, hours: 5678, nextService: 5750, fuelLevel: 30, lat: 39.9500, lng: -83.0500, lastUpdate: '1 hr ago', dailyRate: 600, owned: true, purchasePrice: 295000, purchaseDate: '2020-05-22' },
      { id: 5, name: 'Komatsu PC210', type: 'Excavator', status: 'active', jobId: 3, hours: 1823, nextService: 2000, fuelLevel: 61, lat: 39.7592, lng: -84.1920, lastUpdate: '3 min ago', dailyRate: 700, owned: true, purchasePrice: 275000, purchaseDate: '2024-02-28' },
      { id: 6, name: 'John Deere 310L', type: 'Backhoe', status: 'idle', jobId: null, hours: 892, nextService: 1000, fuelLevel: 95, lat: 39.9500, lng: -83.0500, lastUpdate: '2 days ago', dailyRate: 400, owned: true, purchasePrice: 125000, purchaseDate: '2024-06-15' },
      { id: 7, name: 'CAT 950M Loader', type: 'Loader', status: 'active', jobId: 2, hours: 3421, nextService: 3500, fuelLevel: 55, lat: 39.1028, lng: -84.5118, lastUpdate: '8 min ago', dailyRate: 550, owned: true, purchasePrice: 265000, purchaseDate: '2022-11-30' },
      { id: 8, name: 'Bomag BW211', type: 'Compactor', status: 'active', jobId: 1, hours: 1567, nextService: 1750, fuelLevel: 78, lat: 39.9608, lng: -82.9992, lastUpdate: '4 min ago', dailyRate: 450, owned: true, purchasePrice: 185000, purchaseDate: '2023-07-12' },
    ];

    const EMPLOYEES = [
      { id: 1, name: 'Mike Johnson', role: 'Foreman', phone: '(614) 555-0101', email: 'mjohnson@groundwork.com', hourlyRate: 42, certifications: [{ name: 'OSHA 30', expires: '2026-08-15' }, { name: 'CDL Class A', expires: '2026-03-22' }], jobId: 1, status: 'clocked-in', clockedInAt: '06:45 AM' },
      { id: 2, name: 'Sarah Williams', role: 'Equipment Operator', phone: '(614) 555-0102', email: 'swilliams@groundwork.com', hourlyRate: 35, certifications: [{ name: 'OSHA 10', expires: '2025-12-01' }, { name: 'CDL Class B', expires: '2027-01-15' }], jobId: 1, status: 'clocked-in', clockedInAt: '07:00 AM' },
      { id: 3, name: 'James Rodriguez', role: 'Equipment Operator', phone: '(614) 555-0103', email: 'jrodriguez@groundwork.com', hourlyRate: 35, certifications: [{ name: 'OSHA 10', expires: '2026-05-20' }, { name: 'Excavator Cert', expires: '2026-11-30' }], jobId: 2, status: 'clocked-in', clockedInAt: '06:30 AM' },
      { id: 4, name: 'David Chen', role: 'Foreman', phone: '(614) 555-0104', email: 'dchen@groundwork.com', hourlyRate: 42, certifications: [{ name: 'OSHA 30', expires: '2026-02-28' }, { name: 'CDL Class A', expires: '2025-09-10' }], jobId: 2, status: 'clocked-in', clockedInAt: '06:45 AM' },
      { id: 5, name: 'Tom Martinez', role: 'Laborer', phone: '(614) 555-0105', email: 'tmartinez@groundwork.com', hourlyRate: 26, certifications: [{ name: 'OSHA 10', expires: '2026-07-12' }], jobId: 1, status: 'clocked-in', clockedInAt: '07:15 AM' },
      { id: 6, name: 'Chris Taylor', role: 'Equipment Operator', phone: '(614) 555-0106', email: 'ctaylor@groundwork.com', hourlyRate: 35, certifications: [{ name: 'OSHA 10', expires: '2026-04-18' }, { name: 'CDL Class A', expires: '2026-12-05' }], jobId: 3, status: 'clocked-in', clockedInAt: '07:00 AM' },
      { id: 7, name: 'Brian Wilson', role: 'Mechanic', phone: '(614) 555-0107', email: 'bwilson@groundwork.com', hourlyRate: 38, certifications: [{ name: 'ASE Master', expires: '2027-03-01' }, { name: 'CAT Certified', expires: '2026-06-30' }], jobId: null, status: 'clocked-in', clockedInAt: '07:30 AM' },
      { id: 8, name: 'Kevin Brown', role: 'Laborer', phone: '(614) 555-0108', email: 'kbrown@groundwork.com', hourlyRate: 26, certifications: [{ name: 'OSHA 10', expires: '2026-09-25' }], jobId: null, status: 'off', clockedInAt: null },
    ];

    const WORK_ORDERS = [
      { id: 1, equipmentId: 4, type: 'repair', priority: 'high', status: 'in-progress', title: 'Hydraulic Leak - Main Cylinder', description: 'Significant hydraulic fluid leak from main lift cylinder. Needs seal replacement.', assignedTo: 7, createdAt: '2026-02-02', dueDate: '2026-02-05', parts: [{ name: 'Cylinder Seal Kit', partNo: 'CAT-14M-SEAL-01', qty: 1, cost: 485 }], laborHours: 6 },
      { id: 2, equipmentId: 2, type: 'preventive', priority: 'medium', status: 'scheduled', title: '4000 Hour Service', description: 'Scheduled preventive maintenance at 4000 hours. Oil change, filters, inspection.', assignedTo: 7, createdAt: '2026-02-01', dueDate: '2026-02-08', parts: [{ name: 'Oil Filter', partNo: 'CAT-D6-OIL-01', qty: 2, cost: 45 }, { name: 'Fuel Filter', partNo: 'CAT-D6-FUEL-01', qty: 2, cost: 62 }, { name: 'Engine Oil 15W-40', partNo: 'OIL-15W40-5GAL', qty: 3, cost: 89 }], laborHours: 4 },
      { id: 3, equipmentId: 5, type: 'inspection', priority: 'low', status: 'scheduled', title: 'Annual DOT Inspection', description: 'Required annual inspection for road compliance.', assignedTo: 7, createdAt: '2026-02-03', dueDate: '2026-02-15', parts: [], laborHours: 2 },
    ];

    const DAILY_REPORTS = [
      { id: 1, jobId: 1, date: '2026-02-03', submittedBy: 1, weather: 'Partly Cloudy', tempHigh: 42, tempLow: 28, crewSize: 6, workAccomplished: 'Completed 450 LF of storm sewer installation. Set 3 manholes. Backfilled and compacted 200 LF.', materialsUsed: [{ item: 'Storm Pipe 24"', qty: 450, unit: 'LF' }, { item: 'Crusite Stone', qty: 85, unit: 'TN' }], issues: 'Minor delay due to unmarked utilities. Called 811 for re-mark.', tomorrowPlan: 'Continue storm sewer east toward Main St intersection.' },
      { id: 2, jobId: 2, date: '2026-02-03', submittedBy: 4, weather: 'Sunny', tempHigh: 45, tempLow: 30, crewSize: 4, workAccomplished: 'Mass excavation of building pad area. Removed approximately 2,400 CY of material. Hauled to approved disposal site.', materialsUsed: [{ item: 'Excavated Material', qty: 2400, unit: 'CY' }], issues: 'None', tomorrowPlan: 'Complete building pad excavation. Begin proof rolling.' },
    ];

    const COST_CODES = [
      { code: '01-100', description: 'Mobilization', budgeted: 45000 },
      { code: '02-100', description: 'Clearing & Grubbing', budgeted: 28000 },
      { code: '02-200', description: 'Mass Excavation', budgeted: 185000 },
      { code: '02-300', description: 'Structural Excavation', budgeted: 92000 },
      { code: '02-400', description: 'Backfill & Compaction', budgeted: 124000 },
      { code: '03-100', description: 'Storm Sewer', budgeted: 340000 },
      { code: '03-200', description: 'Sanitary Sewer', budgeted: 280000 },
      { code: '03-300', description: 'Water Main', budgeted: 195000 },
      { code: '04-100', description: 'Aggregate Base', budgeted: 156000 },
      { code: '04-200', description: 'Asphalt Paving', budgeted: 420000 },
    ];

    // INVENTORY DATA
    const INVENTORY = [
      { id: 1, name: '24" HDPE Storm Pipe', category: 'Pipe', unit: 'LF', qtyOnHand: 850, qtyReserved: 450, reorderPoint: 200, unitCost: 42, jobId: 1, location: 'Yard A' },
      { id: 2, name: '18" RCP Storm Pipe', category: 'Pipe', unit: 'LF', qtyOnHand: 320, qtyReserved: 0, reorderPoint: 100, unitCost: 38, jobId: null, location: 'Yard A' },
      { id: 3, name: '#57 Crushed Stone', category: 'Aggregate', unit: 'TN', qtyOnHand: 245, qtyReserved: 85, reorderPoint: 100, unitCost: 28, jobId: 1, location: 'Yard B' },
      { id: 4, name: '#304 Limestone', category: 'Aggregate', unit: 'TN', qtyOnHand: 180, qtyReserved: 50, reorderPoint: 75, unitCost: 32, jobId: 2, location: 'Yard B' },
      { id: 5, name: '4" PVC SDR35', category: 'Pipe', unit: 'LF', qtyOnHand: 1200, qtyReserved: 400, reorderPoint: 300, unitCost: 8, jobId: 1, location: 'Yard A' },
      { id: 6, name: 'Manhole Ring & Cover', category: 'Structures', unit: 'EA', qtyOnHand: 12, qtyReserved: 3, reorderPoint: 5, unitCost: 485, jobId: 1, location: 'Yard A' },
      { id: 7, name: '48" Manhole Base', category: 'Structures', unit: 'EA', qtyOnHand: 8, qtyReserved: 3, reorderPoint: 3, unitCost: 1250, jobId: 1, location: 'Yard A' },
      { id: 8, name: 'Geotextile Fabric', category: 'Materials', unit: 'SY', qtyOnHand: 2500, qtyReserved: 800, reorderPoint: 500, unitCost: 2.5, jobId: null, location: 'Yard C' },
      { id: 9, name: 'Silt Fence', category: 'Erosion Control', unit: 'LF', qtyOnHand: 1800, qtyReserved: 500, reorderPoint: 400, unitCost: 3, jobId: 2, location: 'Yard C' },
      { id: 10, name: 'Orange Safety Fence', category: 'Safety', unit: 'LF', qtyOnHand: 600, qtyReserved: 200, reorderPoint: 200, unitCost: 0.5, jobId: null, location: 'Yard C' },
    ];

    // SAFETY TRAINING DATA
    const SAFETY_TRAINING = [
      { id: 1, title: 'Excavation & Trenching Safety', category: 'OSHA Required', duration: '45 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300', required: true, dueDate: '2026-03-01', completedBy: [1, 2, 3, 5] },
      { id: 2, title: 'Fall Protection Fundamentals', category: 'OSHA Required', duration: '30 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=300', required: true, dueDate: '2026-03-01', completedBy: [1, 4, 6] },
      { id: 3, title: 'Heavy Equipment Blind Spots', category: 'Equipment', duration: '20 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=300', required: true, dueDate: '2026-02-15', completedBy: [2, 3, 6] },
      { id: 4, title: 'Silica Dust Exposure Prevention', category: 'Health', duration: '25 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300', required: true, dueDate: '2026-04-01', completedBy: [1, 2, 3, 4, 5, 6] },
      { id: 5, title: 'Lockout/Tagout Procedures', category: 'OSHA Required', duration: '35 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=300', required: true, dueDate: '2026-03-15', completedBy: [] },
      { id: 6, title: 'Spotter Signals & Communication', category: 'Equipment', duration: '15 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=300', required: false, dueDate: null, completedBy: [2, 3, 6] },
      { id: 7, title: 'Heat Illness Prevention', category: 'Health', duration: '20 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300', required: false, dueDate: null, completedBy: [1, 2, 3, 4, 5, 6, 7, 8] },
      { id: 8, title: 'Underground Utility Awareness', category: 'Site Safety', duration: '30 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', thumbnail: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300', required: true, dueDate: '2026-02-28', completedBy: [1, 4] },
    ];

    // BIDS DATA
    const BIDS = [
      { id: 1, projectName: 'Westside Connector Road', client: 'City of Cincinnati', bidDate: '2026-02-15', amount: 2450000, status: 'pending', probability: 65, estimator: 'John Doe', notes: 'Strong relationship with city. Competitive pricing.' },
      { id: 2, projectName: 'Amazon Distribution Center', client: 'Turner Construction', bidDate: '2026-02-08', amount: 890000, status: 'submitted', probability: 40, estimator: 'John Doe', notes: 'Sub to Turner. Heavy competition expected.' },
      { id: 3, projectName: 'Oakwood Estates Phase 3', client: 'Ryan Homes', bidDate: '2026-01-20', amount: 1150000, status: 'won', probability: 100, estimator: 'John Doe', notes: 'Repeat customer. Start date TBD.' },
      { id: 4, projectName: 'I-75 Bridge Approach', client: 'ODOT', bidDate: '2026-01-10', amount: 3200000, status: 'lost', probability: 0, estimator: 'John Doe', notes: 'Lost to ABC Excavating by 4%.' },
      { id: 5, projectName: 'Mercy Hospital Expansion', client: 'Messer Construction', bidDate: '2026-02-20', amount: 675000, status: 'pending', probability: 55, estimator: 'John Doe', notes: 'Tight schedule. Premium pricing.' },
    ];

    // VENDORS DATA
    const VENDORS = [
      { id: 1, name: 'Martin Marietta Materials', category: 'Aggregates', contact: 'Bob Stevens', phone: '(513) 555-0201', email: 'bstevens@martinmarietta.com', rating: 5, activeOrders: 2 },
      { id: 2, name: 'Ferguson Waterworks', category: 'Pipe & Fittings', contact: 'Lisa Chen', phone: '(513) 555-0202', email: 'lchen@ferguson.com', rating: 4, activeOrders: 1 },
      { id: 3, name: 'United Rentals', category: 'Equipment Rental', contact: 'Mike Thompson', phone: '(513) 555-0203', email: 'mthompson@ur.com', rating: 4, activeOrders: 0 },
      { id: 4, name: 'Sunbelt Rentals', category: 'Equipment Rental', contact: 'Sarah Davis', phone: '(513) 555-0204', email: 'sdavis@sunbelt.com', rating: 5, activeOrders: 1 },
      { id: 5, name: 'Forterra Pipe', category: 'Concrete Products', contact: 'Tom Wilson', phone: '(513) 555-0205', email: 'twilson@forterra.com', rating: 5, activeOrders: 3 },
      { id: 6, name: 'CAT - Ohio Machinery', category: 'Parts & Service', contact: 'Jim Brown', phone: '(513) 555-0206', email: 'jbrown@ohiomachinery.com', rating: 5, activeOrders: 1 },
    ];

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    const formatCurrency = (amount) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
    const formatDate = (dateStr) => new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    const formatTime = (date) => date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
    const getDaysUntil = (dateStr) => Math.ceil((new Date(dateStr) - new Date()) / (1000 * 60 * 60 * 24));

    const getStatusColor = (status) => {
      const colors = {
        'active': 'bg-green-100 text-green-800',
        'idle': 'bg-yellow-100 text-yellow-800',
        'maintenance': 'bg-red-100 text-red-800',
        'completed': 'bg-blue-100 text-blue-800',
        'bidding': 'bg-purple-100 text-purple-800',
        'clocked-in': 'bg-green-100 text-green-800',
        'off': 'bg-gray-100 text-gray-600',
        'in-progress': 'bg-blue-100 text-blue-800',
        'scheduled': 'bg-yellow-100 text-yellow-800',
        'pending': 'bg-orange-100 text-orange-800',
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    };

    const getPriorityColor = (priority) => {
      const colors = { high: 'text-red-600', medium: 'text-yellow-600', low: 'text-green-600' };
      return colors[priority] || 'text-gray-600';
    };

    // ============================================
    // ICON COMPONENT
    // ============================================

    const Icon = ({ name, className = '' }) => (
      <i className={`fa-solid fa-${name} ${className}`}></i>
    );

    // ============================================
    // SHARED COMPONENTS
    // ============================================

    const Card = ({ children, className = '', onClick }) => (
      <div className={`bg-white rounded-lg border border-gray-200 shadow-sm ${className}`} onClick={onClick}>
        {children}
      </div>
    );

    const Button = ({ children, variant = 'primary', size = 'md', onClick, disabled, className = '' }) => {
      const variants = {
        primary: 'bg-dark-900 hover:bg-dark-800 text-white',
        secondary: 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-300',
        brand: 'bg-brand-500 hover:bg-brand-600 text-white',
        danger: 'bg-red-600 hover:bg-red-700 text-white',
        ghost: 'hover:bg-gray-100 text-gray-600',
      };
      const sizes = {
        sm: 'px-3 py-1.5 text-sm',
        md: 'px-4 py-2 text-sm',
        lg: 'px-6 py-3 text-base',
      };
      return (
        <button
          className={`${variants[variant]} ${sizes[size]} rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${className}`}
          onClick={onClick}
          disabled={disabled}
        >
          {children}
        </button>
      );
    };

    const Badge = ({ children, variant = 'default', className = '' }) => {
      const variants = {
        default: 'bg-gray-100 text-gray-800',
        success: 'bg-green-100 text-green-800',
        warning: 'bg-yellow-100 text-yellow-800',
        danger: 'bg-red-100 text-red-800',
        info: 'bg-blue-100 text-blue-800',
      };
      return (
        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${variants[variant]} ${className}`}>
          {children}
        </span>
      );
    };

    const ProgressBar = ({ value, max = 100, color = 'brand', size = 'md', showLabel = false }) => {
      const percentage = Math.min((value / max) * 100, 100);
      const colors = {
        brand: 'bg-brand-500',
        green: 'bg-green-500',
        yellow: 'bg-yellow-500',
        red: 'bg-red-500',
        blue: 'bg-blue-500',
      };
      const sizes = { sm: 'h-1.5', md: 'h-2', lg: 'h-3' };
      const autoColor = percentage > 90 ? 'red' : percentage > 75 ? 'yellow' : 'green';
      const barColor = color === 'auto' ? autoColor : color;

      return (
        <div className="w-full">
          <div className={`w-full bg-gray-200 rounded-full ${sizes[size]}`}>
            <div className={`${colors[barColor]} ${sizes[size]} rounded-full transition-all duration-300`} style={{ width: `${percentage}%` }}></div>
          </div>
          {showLabel && <span className="text-xs text-gray-500 mt-1">{Math.round(percentage)}%</span>}
        </div>
      );
    };

    const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
      if (!isOpen) return null;
      const sizes = { sm: 'max-w-md', md: 'max-w-2xl', lg: 'max-w-4xl', xl: 'max-w-6xl', full: 'max-w-[95vw]' };
      return (
        <div className="fixed inset-0 z-50 overflow-y-auto">
          <div className="fixed inset-0 bg-black/50" onClick={onClose}></div>
          <div className="flex min-h-full items-center justify-center p-4">
            <div className={`relative bg-white rounded-xl shadow-2xl ${sizes[size]} w-full max-h-[90vh] overflow-hidden`}>
              <div className="flex items-center justify-between p-4 border-b border-gray-200">
                <h2 className="text-lg font-semibold text-gray-900">{title}</h2>
                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                  <Icon name="xmark" className="w-5 h-5 text-gray-500" />
                </button>
              </div>
              <div className="overflow-y-auto max-h-[calc(90vh-80px)] p-4">
                {children}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const Tabs = ({ tabs, activeTab, onChange }) => (
      <div className="border-b border-gray-200">
        <nav className="flex gap-4">
          {tabs.map(tab => (
            <button
              key={tab.id}
              onClick={() => onChange(tab.id)}
              className={`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-brand-500 text-brand-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
            >
              {tab.icon && <Icon name={tab.icon} className="mr-2" />}
              {tab.label}
              {tab.count !== undefined && (
                <span className={`ml-2 px-2 py-0.5 rounded-full text-xs ${activeTab === tab.id ? 'bg-brand-100 text-brand-600' : 'bg-gray-100 text-gray-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </nav>
      </div>
    );

    const SearchInput = ({ value, onChange, placeholder = 'Search...' }) => (
      <div className="relative">
        <Icon name="magnifying-glass" className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder={placeholder}
          className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent"
        />
      </div>
    );

    const StatCard = ({ icon, label, value, subValue, trend, color = 'brand' }) => {
      const iconBg = {
        brand: 'bg-brand-100 text-brand-600',
        green: 'bg-green-100 text-green-600',
        red: 'bg-red-100 text-red-600',
        blue: 'bg-blue-100 text-blue-600',
        yellow: 'bg-yellow-100 text-yellow-600',
      };
      return (
        <Card className="p-4">
          <div className="flex items-start justify-between">
            <div className={`p-2 rounded-lg ${iconBg[color]}`}>
              <Icon name={icon} className="text-lg" />
            </div>
            {trend && (
              <span className={`text-xs font-medium ${trend > 0 ? 'text-green-600' : 'text-red-600'}`}>
                <Icon name={trend > 0 ? 'arrow-up' : 'arrow-down'} className="mr-1" />
                {Math.abs(trend)}%
              </span>
            )}
          </div>
          <div className="mt-3">
            <p className="text-2xl font-dozer text-gray-900">{value}</p>
            <p className="text-sm text-gray-500 font-medium">{label}</p>
            {subValue && <p className="text-xs text-gray-400 mt-1">{subValue}</p>}
          </div>
        </Card>
      );
    };

    const Table = ({ columns, data, onRowClick }) => (
      <div className="overflow-x-auto">
        <table className="w-full">
          <thead>
            <tr className="border-b border-gray-200">
              {columns.map((col, i) => (
                <th key={i} className={`px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ${col.className || ''}`}>
                  {col.header}
                </th>
              ))}
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-100">
            {data.map((row, rowIndex) => (
              <tr
                key={rowIndex}
                className={`hover:bg-gray-50 ${onRowClick ? 'cursor-pointer' : ''}`}
                onClick={() => onRowClick && onRowClick(row)}
              >
                {columns.map((col, colIndex) => (
                  <td key={colIndex} className={`px-4 py-3 text-sm ${col.cellClassName || ''}`}>
                    {col.render ? col.render(row) : row[col.key]}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    );

    // ============================================
    // MAIN APPLICATION
    // ============================================

    // Role definitions with permissions
    const ROLES = {
      executive: { label: 'Executive / CEO', icon: 'crown', color: 'text-yellow-500' },
      operations: { label: 'Operations Manager', icon: 'sitemap', color: 'text-blue-500' },
      foreman: { label: 'Foreman', icon: 'helmet-safety', color: 'text-orange-500' },
      field: { label: 'Field Staff', icon: 'user-gear', color: 'text-green-500' },
    };

    const App = ({ currentUser, onLogout }) => {
      const [currentView, setCurrentView] = useState('dashboard');
      const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
      const [selectedJob, setSelectedJob] = useState(null);
      const [showModal, setShowModal] = useState({ type: null, data: null });
      const [currentRole, setCurrentRole] = useState('executive');
      const [showRoleSelector, setShowRoleSelector] = useState(false);
      const [showNotifications, setShowNotifications] = useState(false);
      const [showUserMenu, setShowUserMenu] = useState(false);

      // Sample notifications
      const notifications = [
        { id: 1, type: 'alert', icon: 'triangle-exclamation', color: 'yellow', title: 'Equipment Maintenance Due', message: 'CAT 320 Excavator - Service in 45 hours', time: '10 min ago', unread: true },
        { id: 2, type: 'success', icon: 'check-circle', color: 'green', title: 'Daily Report Submitted', message: 'Highway 42 Expansion - Feb 6 report approved', time: '1 hour ago', unread: true },
        { id: 3, type: 'info', icon: 'cloud-rain', color: 'blue', title: 'Weather Alert', message: 'Rain expected Sunday - consider rescheduling outdoor work', time: '2 hours ago', unread: true },
        { id: 4, type: 'warning', icon: 'id-card', color: 'red', title: 'Certification Expiring', message: 'Mike Rodriguez - CDL expires in 28 days', time: '3 hours ago', unread: false },
        { id: 5, type: 'info', icon: 'file-lines', color: 'brand', title: 'New Bid Request', message: 'Downtown Plaza - RFP received from Anderson Corp', time: '5 hours ago', unread: false },
      ];

      // Data State
      const [jobs, setJobs] = useState(JOBS);
      const [equipment, setEquipment] = useState(EQUIPMENT);
      const [employees, setEmployees] = useState(EMPLOYEES);
      const [workOrders, setWorkOrders] = useState(WORK_ORDERS);
      const [dailyReports, setDailyReports] = useState(DAILY_REPORTS);
      const [timeEntries, setTimeEntries] = useState([]);
      const [scheduleData, setScheduleData] = useState({});

      // Additional State
      const [inventory, setInventory] = useState(INVENTORY);
      const [bids, setBids] = useState(BIDS);
      const [vendors, setVendors] = useState(VENDORS);
      const [trainingData, setTrainingData] = useState(SAFETY_TRAINING);

      // Role-based navigation - what each role can see
      const rolePermissions = {
        executive: ['dashboard', 'messages', 'schedule', 'jobs', 'fleet', 'team', 'inventory', 'maintenance', 'training', 'safety', 'bids', 'vendors', 'reports', 'costing', 'finance', 'marketing', 'integrations', 'documents'],
        operations: ['dashboard', 'messages', 'schedule', 'jobs', 'fleet', 'team', 'inventory', 'maintenance', 'training', 'safety', 'vendors', 'reports', 'marketing', 'integrations', 'documents'],
        foreman: ['dashboard', 'messages', 'schedule', 'jobs', 'fleet', 'team', 'maintenance', 'training', 'safety', 'reports', 'documents'],
        field: ['dashboard', 'messages', 'training', 'safety'],
      };

      // Full Navigation Items with modern icons
      const allNavItems = [
        { id: 'dashboard', icon: 'grid-2', label: 'Dashboard' },
        { id: 'messages', icon: 'comments', label: 'Messages', count: 3 },
        { id: 'schedule', icon: 'calendar-week', label: 'Schedule' },
        { id: 'jobs', icon: 'briefcase', label: 'Jobs', count: jobs.filter(j => j.status === 'active').length },
        { id: 'fleet', icon: 'truck-field', label: 'Fleet', count: equipment.length },
        { id: 'team', icon: 'people-group', label: 'Team', count: employees.length },
        { id: 'inventory', icon: 'warehouse', label: 'Inventory', count: inventory.filter(i => i.qtyOnHand <= i.reorderPoint).length },
        { id: 'maintenance', icon: 'toolbox', label: 'Maintenance', count: workOrders.filter(w => w.status !== 'completed').length },
        { id: 'training', icon: 'chalkboard-user', label: 'Training', count: trainingData.filter(t => t.required && t.completedBy.length < employees.length).length },
        { id: 'safety', icon: 'shield-heart', label: 'Safety' },
        { id: 'bids', icon: 'file-contract', label: 'Bids', count: bids.filter(b => b.status === 'pending').length },
        { id: 'vendors', icon: 'handshake', label: 'Vendors' },
        { id: 'reports', icon: 'chart-mixed', label: 'Reports' },
        { id: 'costing', icon: 'money-check-dollar', label: 'Job Costing' },
        { id: 'finance', icon: 'landmark', label: 'Finance' },
        { id: 'marketing', icon: 'bullhorn', label: 'Marketing' },
        { id: 'integrations', icon: 'plug', label: 'Integrations' },
        { id: 'documents', icon: 'folder-open', label: 'Documents' },
      ];

      // Filter nav items based on role
      const navItems = allNavItems.filter(item => rolePermissions[currentRole].includes(item.id));

      const renderView = () => {
        switch(currentView) {
          case 'dashboard': return <DashboardView jobs={jobs} equipment={equipment} employees={employees} workOrders={workOrders} inventory={inventory} currentRole={currentRole} setCurrentView={setCurrentView} setShowModal={setShowModal} />;
          case 'messages': return <MessagesView employees={employees} />;
          case 'schedule': return <ScheduleView jobs={jobs} equipment={equipment} employees={employees} scheduleData={scheduleData} setScheduleData={setScheduleData} />;
          case 'jobs': return <JobsView jobs={jobs} setJobs={setJobs} equipment={equipment} employees={employees} setSelectedJob={setSelectedJob} setShowModal={setShowModal} />;
          case 'fleet': return <FleetView equipment={equipment} setEquipment={setEquipment} jobs={jobs} workOrders={workOrders} setShowModal={setShowModal} />;
          case 'team': return <TeamView employees={employees} setEmployees={setEmployees} jobs={jobs} setShowModal={setShowModal} />;
          case 'inventory': return <InventoryView inventory={inventory} setInventory={setInventory} jobs={jobs} vendors={vendors} setShowModal={setShowModal} />;
          case 'maintenance': return <MaintenanceView workOrders={workOrders} setWorkOrders={setWorkOrders} equipment={equipment} employees={employees} setShowModal={setShowModal} />;
          case 'training': return <TrainingView trainingData={trainingData} setTrainingData={setTrainingData} employees={employees} setShowModal={setShowModal} />;
          case 'safety': return <SafetyView employees={employees} setShowModal={setShowModal} />;
          case 'bids': return <BidsView bids={bids} setBids={setBids} />;
          case 'vendors': return <VendorsView vendors={vendors} setVendors={setVendors} />;
          case 'reports': return <ReportsView jobs={jobs} equipment={equipment} employees={employees} dailyReports={dailyReports} />;
          case 'costing': return <JobCostingView jobs={jobs} />;
          case 'finance': return <FinanceView jobs={jobs} />;
          case 'marketing': return <MarketingView />;
          case 'integrations': return <IntegrationsView />;
          case 'documents': return <DocumentsView jobs={jobs} />;
          default: return <DashboardView jobs={jobs} equipment={equipment} employees={employees} workOrders={workOrders} inventory={inventory} currentRole={currentRole} setCurrentView={setCurrentView} setShowModal={setShowModal} />;
        }
      };

      return (
        <div className="flex h-screen bg-gray-50">
          {/* Sidebar */}
          <aside className={`${sidebarCollapsed ? 'w-16' : 'w-64'} bg-dark-900 text-white flex flex-col transition-all duration-300`}>
            <div className="p-4 border-b border-dark-700">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-brand-500 rounded-lg flex items-center justify-center">
                  <Icon name="mountain" className="text-white text-lg" />
                </div>
                {!sidebarCollapsed && (
                  <div>
                    <h1 className="font-dozer text-xl tracking-wide">GROUNDWORK</h1>
                    <p className="text-xs text-gray-400 font-dozer tracking-wider">PRO</p>
                  </div>
                )}
              </div>
            </div>

            <nav className="flex-1 p-2 space-y-1 overflow-y-auto scrollbar-thin">
              {navItems.map(item => (
                <button
                  key={item.id}
                  onClick={() => setCurrentView(item.id)}
                  className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${
                    currentView === item.id
                      ? 'bg-brand-500 text-white'
                      : 'text-gray-300 hover:bg-dark-700 hover:text-white'
                  }`}
                >
                  <Icon name={item.icon} className="text-lg w-5" />
                  {!sidebarCollapsed && (
                    <>
                      <span className="flex-1 text-left text-sm">{item.label}</span>
                      {item.count !== undefined && (
                        <span className={`text-xs px-2 py-0.5 rounded-full ${currentView === item.id ? 'bg-brand-600' : 'bg-dark-700'}`}>
                          {item.count}
                        </span>
                      )}
                    </>
                  )}
                </button>
              ))}
            </nav>

            <div className="p-2 border-t border-dark-700">
              <button
                onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
                className="w-full flex items-center justify-center gap-2 px-3 py-2 text-gray-400 hover:text-white hover:bg-dark-700 rounded-lg transition-colors"
              >
                <Icon name={sidebarCollapsed ? 'chevron-right' : 'chevron-left'} />
                {!sidebarCollapsed && <span className="text-sm">Collapse</span>}
              </button>
            </div>
          </aside>

          {/* Main Content */}
          <main className="flex-1 flex flex-col overflow-hidden">
            {/* Header */}
            <header className="bg-white border-b border-gray-200 px-6 py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-xl font-semibold text-gray-900 capitalize">{currentView.replace('-', ' ')}</h1>
                  <p className="text-sm text-gray-500">{new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                <div className="flex items-center gap-3">
                  {/* Role Selector */}
                  <div className="relative">
                    <button
                      onClick={() => setShowRoleSelector(!showRoleSelector)}
                      className="flex items-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                    >
                      <Icon name={ROLES[currentRole].icon} className={ROLES[currentRole].color} />
                      <span className="text-sm font-medium text-gray-700">{ROLES[currentRole].label}</span>
                      <Icon name="chevron-down" className="text-gray-400 text-xs" />
                    </button>
                    {showRoleSelector && (
                      <div className="absolute right-0 top-full mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 py-2 z-50">
                        <div className="px-3 py-2 border-b border-gray-100">
                          <p className="text-xs font-medium text-gray-500 uppercase">Switch Role View</p>
                        </div>
                        {Object.entries(ROLES).map(([key, role]) => (
                          <button
                            key={key}
                            onClick={() => { setCurrentRole(key); setShowRoleSelector(false); setCurrentView('dashboard'); }}
                            className={`w-full flex items-center gap-3 px-3 py-2 hover:bg-gray-50 transition-colors ${currentRole === key ? 'bg-brand-50' : ''}`}
                          >
                            <Icon name={role.icon} className={`${role.color} w-5`} />
                            <span className="text-sm text-gray-700">{role.label}</span>
                            {currentRole === key && <Icon name="check" className="ml-auto text-brand-500" />}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                  <Button variant="secondary" size="sm" onClick={() => setShowModal({ type: 'quick-actions' })}>
                    <Icon name="bolt" className="mr-2" />
                    Quick Actions
                  </Button>
                  {/* Notifications */}
                  <div className="relative">
                    <button
                      onClick={() => setShowNotifications(!showNotifications)}
                      className="relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg"
                    >
                      <Icon name="bell" />
                      {notifications.filter(n => n.unread).length > 0 && (
                        <span className="absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center font-medium">
                          {notifications.filter(n => n.unread).length}
                        </span>
                      )}
                    </button>
                    {showNotifications && (
                      <div className="absolute right-0 top-full mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden">
                        <div className="px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gray-50">
                          <h3 className="font-semibold text-gray-900">Notifications</h3>
                          <button className="text-xs text-brand-600 hover:text-brand-700 font-medium">Mark all read</button>
                        </div>
                        <div className="max-h-96 overflow-y-auto">
                          {notifications.map(notif => (
                            <div key={notif.id} className={`px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${notif.unread ? 'bg-brand-50/30' : ''}`}>
                              <div className="flex gap-3">
                                <div className={`w-10 h-10 rounded-full bg-${notif.color}-100 flex items-center justify-center flex-shrink-0`}>
                                  <Icon name={notif.icon} className={`text-${notif.color}-600`} />
                                </div>
                                <div className="flex-1 min-w-0">
                                  <div className="flex items-center gap-2">
                                    <p className="font-medium text-gray-900 text-sm">{notif.title}</p>
                                    {notif.unread && <span className="w-2 h-2 bg-brand-500 rounded-full"></span>}
                                  </div>
                                  <p className="text-sm text-gray-600 truncate">{notif.message}</p>
                                  <p className="text-xs text-gray-400 mt-1">{notif.time}</p>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                        <div className="px-4 py-3 bg-gray-50 text-center border-t border-gray-100">
                          <button className="text-sm text-brand-600 hover:text-brand-700 font-medium">View all notifications</button>
                        </div>
                      </div>
                    )}
                  </div>
                  {/* User Menu */}
                  <div className="relative pl-3 border-l border-gray-200">
                    <button
                      onClick={() => setShowUserMenu(!showUserMenu)}
                      className="flex items-center gap-2 hover:bg-gray-100 rounded-lg p-1 pr-2 transition-colors"
                    >
                      <div className="w-8 h-8 bg-brand-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                        {currentUser?.name?.split(' ').map(n => n[0]).join('') || 'JD'}
                      </div>
                      <span className="text-sm font-medium text-gray-700">{currentUser?.name || 'John Doe'}</span>
                      <Icon name="chevron-down" className="text-gray-400 text-xs" />
                    </button>
                    {showUserMenu && (
                      <div className="absolute right-0 top-full mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 py-2 z-50">
                        <div className="px-4 py-3 border-b border-gray-100">
                          <p className="font-medium text-gray-900">{currentUser?.name || 'John Doe'}</p>
                          <p className="text-sm text-gray-500">{currentUser?.email || 'john@company.com'}</p>
                          <p className="text-xs text-gray-400 mt-1">{currentUser?.company || 'Demo Company'}</p>
                        </div>
                        <div className="py-1">
                          <button className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <Icon name="user" className="text-gray-400" /> My Profile
                          </button>
                          <button className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <Icon name="gear" className="text-gray-400" /> Account Settings
                          </button>
                          <button className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <Icon name="building" className="text-gray-400" /> Company Settings
                          </button>
                          <button className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <Icon name="credit-card" className="text-gray-400" /> Billing
                          </button>
                        </div>
                        <div className="border-t border-gray-100 pt-1">
                          <button
                            onClick={onLogout}
                            className="w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50"
                          >
                            <Icon name="right-from-bracket" className="text-red-500" /> Sign Out
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </header>

            {/* Content Area */}
            <div className="flex-1 overflow-y-auto p-6">
              {renderView()}
            </div>
          </main>

          {/* Modals */}
          <QuickActionsModal isOpen={showModal.type === 'quick-actions'} onClose={() => setShowModal({ type: null })} setShowModal={setShowModal} />
          <TimeClockModal isOpen={showModal.type === 'time-clock'} onClose={() => setShowModal({ type: null })} employees={employees} jobs={jobs} setTimeEntries={setTimeEntries} />
          <EquipmentCheckInModal isOpen={showModal.type === 'equipment-checkin'} onClose={() => setShowModal({ type: null })} equipment={equipment} setEquipment={setEquipment} employees={employees} jobs={jobs} />
          <DailyReportModal isOpen={showModal.type === 'daily-report'} onClose={() => setShowModal({ type: null })} jobs={jobs} employees={employees} dailyReports={dailyReports} setDailyReports={setDailyReports} />
          <WorkOrderModal isOpen={showModal.type === 'work-order'} onClose={() => setShowModal({ type: null })} equipment={equipment} employees={employees} workOrders={workOrders} setWorkOrders={setWorkOrders} data={showModal.data} />
          <SafetyModal isOpen={showModal.type === 'safety'} onClose={() => setShowModal({ type: null })} employees={employees} jobs={jobs} />
        </div>
      );
    };

    // ============================================
    // LEAFLET MAP COMPONENT
    // ============================================
    const LeafletMap = ({ equipment, jobs }) => {
      const mapRef = useRef(null);
      const mapInstanceRef = useRef(null);

      useEffect(() => {
        if (mapRef.current && !mapInstanceRef.current) {
          // Initialize map centered on Cincinnati
          mapInstanceRef.current = L.map(mapRef.current).setView([39.1031, -84.5120], 10);

          // Add tile layer (OpenStreetMap)
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
          }).addTo(mapInstanceRef.current);

          // Custom orange icon for equipment
          const equipIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #f97316; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>',
            iconSize: [24, 24],
            iconAnchor: [12, 12],
          });

          // Add equipment markers
          equipment.filter(e => e.status === 'active').forEach(eq => {
            const job = jobs.find(j => j.id === eq.jobId);
            L.marker([eq.lat, eq.lng], { icon: equipIcon })
              .addTo(mapInstanceRef.current)
              .bindPopup(`<b>${eq.name}</b><br/>${eq.type}<br/>Job: ${job?.name || 'Unassigned'}<br/>Hours: ${eq.hours.toLocaleString()}`);
          });

          // Add job site markers (blue)
          const jobIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #3b82f6; width: 20px; height: 20px; border-radius: 4px; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>',
            iconSize: [20, 20],
            iconAnchor: [10, 10],
          });

          jobs.filter(j => j.status === 'active').forEach(job => {
            L.marker([job.lat, job.lng], { icon: jobIcon })
              .addTo(mapInstanceRef.current)
              .bindPopup(`<b>${job.name}</b><br/>${job.client}<br/>${job.address}`);
          });
        }

        return () => {
          if (mapInstanceRef.current) {
            mapInstanceRef.current.remove();
            mapInstanceRef.current = null;
          }
        };
      }, [equipment, jobs]);

      return (
        <div className="relative">
          <div ref={mapRef} className="h-64 rounded-lg overflow-hidden" style={{ zIndex: 0 }}></div>
          <div className="absolute bottom-2 left-2 bg-white/95 rounded px-3 py-2 text-xs shadow-lg z-10">
            <div className="flex items-center gap-4">
              <span><span className="inline-block w-3 h-3 rounded-full bg-brand-500 mr-1"></span> Equipment</span>
              <span><span className="inline-block w-3 h-3 rounded bg-blue-500 mr-1"></span> Job Sites</span>
            </div>
          </div>
        </div>
      );
    };

    // ============================================
    // DASHBOARD VIEW
    // ============================================
    const DashboardView = ({ jobs, equipment, employees, workOrders, inventory, setCurrentView, setShowModal }) => {
      const activeJobs = jobs.filter(j => j.status === 'active');
      const activeEquipment = equipment.filter(e => e.status === 'active');
      const clockedInEmployees = employees.filter(e => e.status === 'clocked-in');
      const totalRevenue = jobs.reduce((sum, j) => sum + j.budget, 0);
      const totalSpent = jobs.reduce((sum, j) => sum + j.spent, 0);
      const utilizationRate = Math.round((activeEquipment.length / equipment.length) * 100);

      const upcomingMaintenance = equipment.filter(e => (e.nextService - e.hours) < 150).slice(0, 3);
      const expiringCerts = employees.flatMap(emp =>
        emp.certifications.filter(c => getDaysUntil(c.expires) < 60).map(c => ({ ...c, employee: emp.name }))
      ).slice(0, 4);

      return (
        <div className="space-y-6">
          {/* KPI Cards */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <StatCard icon="briefcase" label="Active Jobs" value={activeJobs.length} subValue={`${formatCurrency(totalRevenue)} total contract value`} color="brand" />
            <StatCard icon="truck-monster" label="Fleet Utilization" value={`${utilizationRate}%`} subValue={`${activeEquipment.length} of ${equipment.length} active`} trend={5} color="green" />
            <StatCard icon="users" label="Crew On-Site" value={clockedInEmployees.length} subValue={`of ${employees.length} total employees`} color="blue" />
            <StatCard icon="dollar-sign" label="Month Revenue" value={formatCurrency(847500)} subValue="vs. budget: +12%" trend={12} color="green" />
          </div>

          {/* Main Content Grid */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Active Jobs */}
            <Card className="lg:col-span-2 p-0 overflow-hidden">
              <div className="p-4 border-b border-gray-200 flex items-center justify-between">
                <h3 className="font-semibold text-gray-900">Active Jobs</h3>
                <Button variant="ghost" size="sm" onClick={() => setCurrentView('jobs')}>
                  View All <Icon name="arrow-right" className="ml-1" />
                </Button>
              </div>
              <div className="divide-y divide-gray-100">
                {activeJobs.map(job => (
                  <div key={job.id} className="p-4 hover:bg-gray-50">
                    <div className="flex items-start justify-between mb-2">
                      <div>
                        <h4 className="font-medium text-gray-900">{job.name}</h4>
                        <p className="text-sm text-gray-500">{job.client}</p>
                      </div>
                      <Badge variant={job.progress > 50 ? 'success' : 'warning'}>{job.progress}% Complete</Badge>
                    </div>
                    <ProgressBar value={job.progress} color="brand" size="sm" />
                    <div className="flex items-center justify-between mt-3 text-sm">
                      <span className="text-gray-500">
                        <Icon name="calendar" className="mr-1" />
                        Due {formatDate(job.endDate)}
                      </span>
                      <span className={job.spent / job.budget > 0.9 ? 'text-red-600 font-medium' : 'text-gray-600'}>
                        {formatCurrency(job.spent)} / {formatCurrency(job.budget)}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </Card>

            {/* Quick Actions + Alerts */}
            <div className="space-y-6">
              {/* Quick Actions */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div className="grid grid-cols-2 gap-2">
                  <Button variant="secondary" size="sm" className="justify-start" onClick={() => setShowModal({ type: 'time-clock' })}>
                    <Icon name="clock" className="mr-2 text-brand-500" /> Time Clock
                  </Button>
                  <Button variant="secondary" size="sm" className="justify-start" onClick={() => setShowModal({ type: 'equipment-checkin' })}>
                    <Icon name="clipboard-check" className="mr-2 text-brand-500" /> Check-In
                  </Button>
                  <Button variant="secondary" size="sm" className="justify-start" onClick={() => setShowModal({ type: 'daily-report' })}>
                    <Icon name="file-lines" className="mr-2 text-brand-500" /> Daily Report
                  </Button>
                  <Button variant="secondary" size="sm" className="justify-start" onClick={() => setShowModal({ type: 'work-order' })}>
                    <Icon name="wrench" className="mr-2 text-brand-500" /> Work Order
                  </Button>
                  <Button variant="secondary" size="sm" className="justify-start col-span-2" onClick={() => setShowModal({ type: 'safety' })}>
                    <Icon name="shield-halved" className="mr-2 text-brand-500" /> Safety Sign-Off
                  </Button>
                </div>
              </Card>

              {/* Alerts */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="triangle-exclamation" className="mr-2 text-yellow-500" />
                  Alerts
                </h3>
                <div className="space-y-3">
                  {upcomingMaintenance.map(eq => (
                    <div key={eq.id} className="flex items-start gap-3 p-2 bg-yellow-50 rounded-lg">
                      <Icon name="wrench" className="text-yellow-600 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium text-gray-900">{eq.name}</p>
                        <p className="text-xs text-gray-600">Service due in {eq.nextService - eq.hours} hours</p>
                      </div>
                    </div>
                  ))}
                  {expiringCerts.map((cert, i) => (
                    <div key={i} className="flex items-start gap-3 p-2 bg-red-50 rounded-lg">
                      <Icon name="id-card" className="text-red-600 mt-0.5" />
                      <div className="flex-1">
                        <p className="text-sm font-medium text-gray-900">{cert.employee}</p>
                        <p className="text-xs text-gray-600">{cert.name} expires {formatDate(cert.expires)}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </Card>

              {/* Weather Widget */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="cloud-sun" className="mr-2 text-blue-500" />
                  Weather - Cincinnati
                </h3>
                <div className="text-center mb-4">
                  <div className="flex items-center justify-center gap-4">
                    <Icon name="sun" className="text-yellow-500 text-4xl" />
                    <div>
                      <p className="text-4xl font-bold text-gray-900">47Â°F</p>
                      <p className="text-sm text-gray-500">Partly Cloudy</p>
                    </div>
                  </div>
                </div>
                <div className="grid grid-cols-4 gap-2 text-center text-xs">
                  {[
                    { day: 'Fri', icon: 'sun', high: 52, low: 38 },
                    { day: 'Sat', icon: 'cloud', high: 48, low: 35 },
                    { day: 'Sun', icon: 'cloud-rain', high: 44, low: 32, alert: true },
                    { day: 'Mon', icon: 'sun', high: 50, low: 36 },
                  ].map((d, i) => (
                    <div key={i} className={`p-2 rounded-lg ${d.alert ? 'bg-blue-50 border border-blue-200' : 'bg-gray-50'}`}>
                      <p className="font-medium text-gray-700">{d.day}</p>
                      <Icon name={d.icon} className={`my-2 ${d.icon === 'cloud-rain' ? 'text-blue-500' : d.icon === 'sun' ? 'text-yellow-500' : 'text-gray-400'}`} />
                      <p className="text-gray-900">{d.high}Â°</p>
                      <p className="text-gray-400">{d.low}Â°</p>
                    </div>
                  ))}
                </div>
                <div className="mt-3 p-2 bg-blue-50 rounded-lg flex items-center gap-2">
                  <Icon name="droplet" className="text-blue-500" />
                  <span className="text-xs text-blue-800">Rain expected Sunday - plan accordingly</span>
                </div>
              </Card>
            </div>
          </div>

          {/* Equipment Map & Status */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Equipment Location Map - Real Leaflet Map */}
            <Card className="p-4">
              <h3 className="font-semibold text-gray-900 mb-4">
                <Icon name="map-location-dot" className="mr-2 text-brand-500" />
                Equipment Locations - Cincinnati Area
              </h3>
              <LeafletMap equipment={equipment} jobs={jobs} />
            </Card>

            {/* Work Orders */}
            <Card className="p-0 overflow-hidden">
              <div className="p-4 border-b border-gray-200 flex items-center justify-between">
                <h3 className="font-semibold text-gray-900">Open Work Orders</h3>
                <Button variant="ghost" size="sm" onClick={() => setCurrentView('maintenance')}>
                  View All <Icon name="arrow-right" className="ml-1" />
                </Button>
              </div>
              <div className="divide-y divide-gray-100">
                {workOrders.filter(w => w.status !== 'completed').slice(0, 4).map(wo => {
                  const eq = equipment.find(e => e.id === wo.equipmentId);
                  const assignee = employees.find(e => e.id === wo.assignedTo);
                  return (
                    <div key={wo.id} className="p-4 hover:bg-gray-50">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center gap-2">
                            <Icon name={wo.priority === 'high' ? 'circle-exclamation' : 'circle'} className={getPriorityColor(wo.priority)} />
                            <span className="font-medium text-gray-900">{wo.title}</span>
                          </div>
                          <p className="text-sm text-gray-500 mt-1">{eq?.name}</p>
                        </div>
                        <Badge className={getStatusColor(wo.status)}>{wo.status}</Badge>
                      </div>
                      <div className="flex items-center justify-between mt-2 text-xs text-gray-500">
                        <span><Icon name="user" className="mr-1" />{assignee?.name}</span>
                        <span>Due {formatDate(wo.dueDate)}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </Card>
          </div>
        </div>
      );
    };

    // ============================================
    // SCHEDULE VIEW (Drag & Drop Calendar)
    // ============================================
    const ScheduleView = ({ jobs, equipment, employees, scheduleData, setScheduleData }) => {
      const [currentWeek, setCurrentWeek] = useState(0);
      const [dragItem, setDragItem] = useState(null);

      const getWeekDates = (offset = 0) => {
        const today = new Date();
        const monday = new Date(today);
        monday.setDate(today.getDate() - today.getDay() + 1 + (offset * 7));
        return Array.from({ length: 7 }, (_, i) => {
          const date = new Date(monday);
          date.setDate(monday.getDate() + i);
          return date;
        });
      };

      const weekDates = getWeekDates(currentWeek);
      const activeJobs = jobs.filter(j => j.status === 'active');

      const handleDragStart = (e, item, type) => {
        setDragItem({ ...item, type });
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleDrop = (e, jobId, date) => {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');
        if (!dragItem) return;

        const dateKey = date.toISOString().split('T')[0];
        const key = `${jobId}-${dateKey}`;

        setScheduleData(prev => ({
          ...prev,
          [key]: [...(prev[key] || []), { ...dragItem, id: Date.now() }]
        }));
        setDragItem(null);
      };

      const handleDragOver = (e) => {
        e.preventDefault();
        e.currentTarget.classList.add('drag-over');
      };

      const handleDragLeave = (e) => {
        e.currentTarget.classList.remove('drag-over');
      };

      const removeFromSchedule = (key, itemId) => {
        setScheduleData(prev => ({
          ...prev,
          [key]: prev[key].filter(item => item.id !== itemId)
        }));
      };

      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Button variant="secondary" size="sm" onClick={() => setCurrentWeek(w => w - 1)}>
                <Icon name="chevron-left" />
              </Button>
              <h2 className="text-lg font-semibold">
                {weekDates[0].toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - {weekDates[6].toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
              </h2>
              <Button variant="secondary" size="sm" onClick={() => setCurrentWeek(w => w + 1)}>
                <Icon name="chevron-right" />
              </Button>
              <Button variant="ghost" size="sm" onClick={() => setCurrentWeek(0)}>Today</Button>
            </div>
          </div>

          <div className="grid grid-cols-4 gap-4">
            {/* Resource Pool */}
            <div className="space-y-4">
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-3">
                  <Icon name="truck-monster" className="mr-2 text-brand-500" />
                  Equipment
                </h3>
                <div className="space-y-2">
                  {equipment.filter(e => e.status !== 'maintenance').map(eq => (
                    <div
                      key={eq.id}
                      draggable
                      onDragStart={(e) => handleDragStart(e, eq, 'equipment')}
                      className="p-2 bg-blue-50 border border-blue-200 rounded cursor-move hover:bg-blue-100 transition-colors"
                    >
                      <div className="flex items-center gap-2">
                        <Icon name="truck-monster" className="text-blue-600 text-sm" />
                        <span className="text-sm font-medium">{eq.name}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </Card>

              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-3">
                  <Icon name="users" className="mr-2 text-brand-500" />
                  Crew
                </h3>
                <div className="space-y-2">
                  {employees.filter(e => e.role !== 'Mechanic').map(emp => (
                    <div
                      key={emp.id}
                      draggable
                      onDragStart={(e) => handleDragStart(e, emp, 'employee')}
                      className="p-2 bg-green-50 border border-green-200 rounded cursor-move hover:bg-green-100 transition-colors"
                    >
                      <div className="flex items-center gap-2">
                        <Icon name="user" className="text-green-600 text-sm" />
                        <div>
                          <span className="text-sm font-medium">{emp.name}</span>
                          <span className="text-xs text-gray-500 ml-2">{emp.role}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </Card>
            </div>

            {/* Schedule Grid */}
            <div className="col-span-3 overflow-x-auto">
              <Card className="p-0 min-w-[700px]">
                {/* Days Header */}
                <div className="grid grid-cols-7 border-b border-gray-200">
                  {weekDates.map((date, i) => {
                    const isToday = date.toDateString() === new Date().toDateString();
                    return (
                      <div key={i} className={`p-3 text-center border-r border-gray-100 last:border-r-0 ${isToday ? 'bg-brand-50' : ''}`}>
                        <div className="text-xs text-gray-500">{date.toLocaleDateString('en-US', { weekday: 'short' })}</div>
                        <div className={`text-lg font-semibold ${isToday ? 'text-brand-600' : 'text-gray-900'}`}>{date.getDate()}</div>
                      </div>
                    );
                  })}
                </div>

                {/* Job Rows */}
                {activeJobs.map(job => (
                  <div key={job.id} className="border-b border-gray-100 last:border-b-0">
                    <div className="grid grid-cols-7">
                      {weekDates.map((date, i) => {
                        const dateKey = date.toISOString().split('T')[0];
                        const key = `${job.id}-${dateKey}`;
                        const assigned = scheduleData[key] || [];

                        return (
                          <div
                            key={i}
                            className="min-h-[100px] p-2 border-r border-gray-100 last:border-r-0 transition-colors"
                            onDrop={(e) => handleDrop(e, job.id, date)}
                            onDragOver={handleDragOver}
                            onDragLeave={handleDragLeave}
                          >
                            {i === 0 && (
                              <div className="text-xs font-medium text-gray-900 mb-2 truncate" title={job.name}>
                                {job.name}
                              </div>
                            )}
                            <div className="space-y-1">
                              {assigned.map(item => (
                                <div
                                  key={item.id}
                                  className={`text-xs p-1 rounded flex items-center justify-between ${
                                    item.type === 'equipment' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'
                                  }`}
                                >
                                  <span className="truncate">{item.name}</span>
                                  <button
                                    onClick={() => removeFromSchedule(key, item.id)}
                                    className="ml-1 hover:text-red-600"
                                  >
                                    <Icon name="xmark" className="text-[10px]" />
                                  </button>
                                </div>
                              ))}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </Card>
            </div>
          </div>

          <p className="text-sm text-gray-500">
            <Icon name="circle-info" className="mr-1" />
            Drag equipment and crew members from the left panel and drop them onto job slots to schedule.
          </p>
        </div>
      );
    };

    // ============================================
    // JOBS VIEW
    // ============================================
    const JobsView = ({ jobs, setJobs, equipment, employees, setSelectedJob, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [search, setSearch] = useState('');
      const [selectedJobId, setSelectedJobId] = useState(null);

      const filteredJobs = jobs.filter(job => {
        if (filter !== 'all' && job.status !== filter) return false;
        if (search && !job.name.toLowerCase().includes(search.toLowerCase()) && !job.client.toLowerCase().includes(search.toLowerCase())) return false;
        return true;
      });

      const selectedJob = jobs.find(j => j.id === selectedJobId);
      const jobEquipment = selectedJob ? equipment.filter(e => e.jobId === selectedJob.id) : [];
      const jobEmployees = selectedJob ? employees.filter(e => e.jobId === selectedJob.id) : [];

      return (
        <div className="space-y-6">
          {/* Filters */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {['all', 'active', 'bidding', 'completed'].map(status => (
                  <button
                    key={status}
                    onClick={() => setFilter(status)}
                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${
                      filter === status ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    {status.charAt(0).toUpperCase() + status.slice(1)}
                  </button>
                ))}
              </div>
              <SearchInput value={search} onChange={setSearch} placeholder="Search jobs..." />
            </div>
            <Button variant="brand">
              <Icon name="plus" className="mr-2" /> New Job
            </Button>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Jobs List */}
            <div className="lg:col-span-2 space-y-4">
              {filteredJobs.map(job => (
                <Card
                  key={job.id}
                  className={`p-4 cursor-pointer transition-all ${selectedJobId === job.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                  onClick={() => setSelectedJobId(job.id)}
                >
                  <div className="flex items-start justify-between mb-3">
                    <div>
                      <h3 className="font-semibold text-gray-900">{job.name}</h3>
                      <p className="text-sm text-gray-500">{job.client}</p>
                    </div>
                    <Badge className={getStatusColor(job.status)}>{job.status}</Badge>
                  </div>

                  <div className="grid grid-cols-3 gap-4 mb-3">
                    <div>
                      <p className="text-xs text-gray-500">Contract Value</p>
                      <p className="font-semibold text-gray-900">{formatCurrency(job.budget)}</p>
                    </div>
                    <div>
                      <p className="text-xs text-gray-500">Spent to Date</p>
                      <p className="font-semibold text-gray-900">{formatCurrency(job.spent)}</p>
                    </div>
                    <div>
                      <p className="text-xs text-gray-500">Margin</p>
                      <p className={`font-semibold ${job.budget - job.spent > 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {formatCurrency(job.budget - job.spent)}
                      </p>
                    </div>
                  </div>

                  <ProgressBar value={job.progress} color="brand" size="sm" />
                  <div className="flex items-center justify-between mt-2 text-xs text-gray-500">
                    <span>{job.progress}% complete</span>
                    <span>{formatDate(job.startDate)} - {formatDate(job.endDate)}</span>
                  </div>
                </Card>
              ))}
            </div>

            {/* Job Detail Panel */}
            {selectedJob ? (
              <Card className="p-4 h-fit sticky top-4">
                <h3 className="font-semibold text-gray-900 mb-4">{selectedJob.name}</h3>

                <div className="space-y-4">
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Address</p>
                    <p className="text-sm text-gray-900">{selectedJob.address}</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-2">Budget vs Spent</p>
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span>Budget</span>
                        <span className="font-medium">{formatCurrency(selectedJob.budget)}</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span>Spent</span>
                        <span className="font-medium">{formatCurrency(selectedJob.spent)}</span>
                      </div>
                      <ProgressBar value={selectedJob.spent} max={selectedJob.budget} color="auto" />
                      <div className="flex justify-between text-sm">
                        <span>Remaining</span>
                        <span className={`font-medium ${selectedJob.budget - selectedJob.spent > 0 ? 'text-green-600' : 'text-red-600'}`}>
                          {formatCurrency(selectedJob.budget - selectedJob.spent)}
                        </span>
                      </div>
                    </div>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-2">Assigned Equipment ({jobEquipment.length})</p>
                    <div className="space-y-1">
                      {jobEquipment.map(eq => (
                        <div key={eq.id} className="flex items-center justify-between text-sm p-2 bg-gray-50 rounded">
                          <span>{eq.name}</span>
                          <Badge variant="success" className="text-xs">Active</Badge>
                        </div>
                      ))}
                      {jobEquipment.length === 0 && <p className="text-sm text-gray-400">No equipment assigned</p>}
                    </div>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-2">Assigned Crew ({jobEmployees.length})</p>
                    <div className="space-y-1">
                      {jobEmployees.map(emp => (
                        <div key={emp.id} className="flex items-center justify-between text-sm p-2 bg-gray-50 rounded">
                          <span>{emp.name}</span>
                          <span className="text-xs text-gray-500">{emp.role}</span>
                        </div>
                      ))}
                      {jobEmployees.length === 0 && <p className="text-sm text-gray-400">No crew assigned</p>}
                    </div>
                  </div>
                </div>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="hand-pointer" className="text-4xl mb-2 text-gray-300" />
                <p>Select a job to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // FLEET VIEW
    // ============================================
    const FleetView = ({ equipment, setEquipment, jobs, workOrders, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [selectedEquipmentId, setSelectedEquipmentId] = useState(null);
      const [viewMode, setViewMode] = useState('grid');

      const filteredEquipment = equipment.filter(eq => filter === 'all' || eq.status === filter);
      const selectedEquipment = equipment.find(e => e.id === selectedEquipmentId);
      const equipmentJob = selectedEquipment ? jobs.find(j => j.id === selectedEquipment.jobId) : null;
      const equipmentWorkOrders = selectedEquipment ? workOrders.filter(w => w.equipmentId === selectedEquipment.id) : [];

      const stats = {
        total: equipment.length,
        active: equipment.filter(e => e.status === 'active').length,
        idle: equipment.filter(e => e.status === 'idle').length,
        maintenance: equipment.filter(e => e.status === 'maintenance').length,
        totalValue: equipment.reduce((sum, e) => sum + (e.purchasePrice || 0), 0),
      };

      return (
        <div className="space-y-6">
          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
            <StatCard icon="truck-monster" label="Total Fleet" value={stats.total} color="brand" />
            <StatCard icon="circle-check" label="Active" value={stats.active} color="green" />
            <StatCard icon="clock" label="Idle" value={stats.idle} color="yellow" />
            <StatCard icon="wrench" label="In Maintenance" value={stats.maintenance} color="red" />
            <StatCard icon="dollar-sign" label="Fleet Value" value={formatCurrency(stats.totalValue)} color="blue" />
          </div>

          {/* Filters & Actions */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {['all', 'active', 'idle', 'maintenance'].map(status => (
                  <button
                    key={status}
                    onClick={() => setFilter(status)}
                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${
                      filter === status ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    {status.charAt(0).toUpperCase() + status.slice(1)}
                  </button>
                ))}
              </div>
              <div className="flex bg-gray-100 rounded-lg p-1">
                <button onClick={() => setViewMode('grid')} className={`p-2 rounded ${viewMode === 'grid' ? 'bg-white shadow' : ''}`}>
                  <Icon name="grip" />
                </button>
                <button onClick={() => setViewMode('list')} className={`p-2 rounded ${viewMode === 'list' ? 'bg-white shadow' : ''}`}>
                  <Icon name="list" />
                </button>
              </div>
            </div>
            <div className="flex gap-2">
              <Button variant="secondary" onClick={() => setShowModal({ type: 'equipment-checkin' })}>
                <Icon name="clipboard-check" className="mr-2" /> Check In/Out
              </Button>
              <Button variant="brand">
                <Icon name="plus" className="mr-2" /> Add Equipment
              </Button>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Equipment Grid/List */}
            <div className={`lg:col-span-2 ${viewMode === 'grid' ? 'grid grid-cols-2 gap-4' : 'space-y-3'}`}>
              {filteredEquipment.map(eq => {
                const job = jobs.find(j => j.id === eq.jobId);
                const hoursToService = eq.nextService - eq.hours;

                return viewMode === 'grid' ? (
                  <Card
                    key={eq.id}
                    className={`p-4 cursor-pointer transition-all ${selectedEquipmentId === eq.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                    onClick={() => setSelectedEquipmentId(eq.id)}
                  >
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                          eq.status === 'active' ? 'bg-green-100' : eq.status === 'idle' ? 'bg-yellow-100' : 'bg-red-100'
                        }`}>
                          <Icon name="truck-monster" className={`${
                            eq.status === 'active' ? 'text-green-600' : eq.status === 'idle' ? 'text-yellow-600' : 'text-red-600'
                          }`} />
                        </div>
                        <div>
                          <h4 className="font-medium text-gray-900">{eq.name}</h4>
                          <p className="text-xs text-gray-500">{eq.type}</p>
                        </div>
                      </div>
                      <Badge className={getStatusColor(eq.status)}>{eq.status}</Badge>
                    </div>

                    <div className="grid grid-cols-2 gap-2 text-sm mb-3">
                      <div>
                        <p className="text-xs text-gray-500">Hours</p>
                        <p className="font-medium">{eq.hours.toLocaleString()}</p>
                      </div>
                      <div>
                        <p className="text-xs text-gray-500">Fuel</p>
                        <div className="flex items-center gap-2">
                          <ProgressBar value={eq.fuelLevel} size="sm" color={eq.fuelLevel < 25 ? 'red' : 'green'} />
                          <span className="text-xs">{eq.fuelLevel}%</span>
                        </div>
                      </div>
                    </div>

                    {job && (
                      <div className="text-xs text-gray-500 flex items-center gap-1">
                        <Icon name="location-dot" />
                        {job.name}
                      </div>
                    )}

                    {hoursToService < 150 && (
                      <div className="mt-2 text-xs text-yellow-600 flex items-center gap-1">
                        <Icon name="triangle-exclamation" />
                        Service in {hoursToService} hrs
                      </div>
                    )}
                  </Card>
                ) : (
                  <Card
                    key={eq.id}
                    className={`p-3 cursor-pointer transition-all ${selectedEquipmentId === eq.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                    onClick={() => setSelectedEquipmentId(eq.id)}
                  >
                    <div className="flex items-center gap-4">
                      <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                        eq.status === 'active' ? 'bg-green-100' : eq.status === 'idle' ? 'bg-yellow-100' : 'bg-red-100'
                      }`}>
                        <Icon name="truck-monster" className={`${
                          eq.status === 'active' ? 'text-green-600' : eq.status === 'idle' ? 'text-yellow-600' : 'text-red-600'
                        }`} />
                      </div>
                      <div className="flex-1">
                        <h4 className="font-medium text-gray-900">{eq.name}</h4>
                        <p className="text-xs text-gray-500">{eq.type} â¢ {eq.hours.toLocaleString()} hrs</p>
                      </div>
                      <div className="text-right">
                        <Badge className={getStatusColor(eq.status)}>{eq.status}</Badge>
                        {job && <p className="text-xs text-gray-500 mt-1">{job.name}</p>}
                      </div>
                    </div>
                  </Card>
                );
              })}
            </div>

            {/* Equipment Detail */}
            {selectedEquipment ? (
              <Card className="p-4 h-fit sticky top-4">
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <h3 className="font-semibold text-gray-900">{selectedEquipment.name}</h3>
                    <p className="text-sm text-gray-500">{selectedEquipment.type}</p>
                  </div>
                  <Badge className={getStatusColor(selectedEquipment.status)}>{selectedEquipment.status}</Badge>
                </div>

                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="text-xs text-gray-500">Total Hours</p>
                      <p className="text-lg font-semibold">{selectedEquipment.hours.toLocaleString()}</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-lg">
                      <p className="text-xs text-gray-500">Next Service</p>
                      <p className="text-lg font-semibold">{selectedEquipment.nextService.toLocaleString()}</p>
                    </div>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-2">Fuel Level</p>
                    <div className="flex items-center gap-3">
                      <div className="flex-1">
                        <ProgressBar value={selectedEquipment.fuelLevel} color={selectedEquipment.fuelLevel < 25 ? 'red' : 'green'} />
                      </div>
                      <span className="font-medium">{selectedEquipment.fuelLevel}%</span>
                    </div>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Current Assignment</p>
                    <p className="text-sm font-medium">{equipmentJob?.name || 'Unassigned'}</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Last Location Update</p>
                    <p className="text-sm">{selectedEquipment.lastUpdate}</p>
                  </div>

                  <div className="pt-4 border-t border-gray-200">
                    <p className="text-xs text-gray-500 mb-1">Daily Rate</p>
                    <p className="text-lg font-semibold text-brand-600">{formatCurrency(selectedEquipment.dailyRate)}/day</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Purchase Info</p>
                    <p className="text-sm">{formatCurrency(selectedEquipment.purchasePrice)} â¢ {formatDate(selectedEquipment.purchaseDate)}</p>
                  </div>

                  {equipmentWorkOrders.length > 0 && (
                    <div className="pt-4 border-t border-gray-200">
                      <p className="text-xs text-gray-500 mb-2">Work Orders</p>
                      {equipmentWorkOrders.map(wo => (
                        <div key={wo.id} className="p-2 bg-gray-50 rounded mb-2">
                          <div className="flex items-center justify-between">
                            <span className="text-sm font-medium">{wo.title}</span>
                            <Badge className={getStatusColor(wo.status)} >{wo.status}</Badge>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  <div className="flex gap-2 pt-4">
                    <Button variant="secondary" size="sm" className="flex-1" onClick={() => setShowModal({ type: 'work-order', data: { equipmentId: selectedEquipment.id } })}>
                      <Icon name="wrench" className="mr-1" /> Create WO
                    </Button>
                    <Button variant="secondary" size="sm" className="flex-1">
                      <Icon name="clock-rotate-left" className="mr-1" /> History
                    </Button>
                  </div>
                </div>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="truck-monster" className="text-4xl mb-2 text-gray-300" />
                <p>Select equipment to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // TEAM VIEW
    // ============================================
    const TeamView = ({ employees, setEmployees, jobs, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [selectedEmployeeId, setSelectedEmployeeId] = useState(null);

      const filteredEmployees = employees.filter(emp => {
        if (filter === 'all') return true;
        if (filter === 'on-site') return emp.status === 'clocked-in';
        if (filter === 'off') return emp.status === 'off';
        return emp.role.toLowerCase().includes(filter.toLowerCase());
      });

      const selectedEmployee = employees.find(e => e.id === selectedEmployeeId);
      const employeeJob = selectedEmployee ? jobs.find(j => j.id === selectedEmployee.jobId) : null;

      const stats = {
        total: employees.length,
        onSite: employees.filter(e => e.status === 'clocked-in').length,
        roles: [...new Set(employees.map(e => e.role))],
      };

      const expiringCerts = selectedEmployee?.certifications.filter(c => getDaysUntil(c.expires) < 90) || [];

      return (
        <div className="space-y-6">
          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="users" label="Total Employees" value={stats.total} color="brand" />
            <StatCard icon="user-check" label="On Site Today" value={stats.onSite} color="green" />
            <StatCard icon="hard-hat" label="Foremen" value={employees.filter(e => e.role === 'Foreman').length} color="blue" />
            <StatCard icon="id-card" label="Expiring Certs" value={employees.flatMap(e => e.certifications.filter(c => getDaysUntil(c.expires) < 60)).length} color="red" />
          </div>

          {/* Filters */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {['all', 'on-site', 'off'].map(status => (
                  <button
                    key={status}
                    onClick={() => setFilter(status)}
                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${
                      filter === status ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    {status === 'on-site' ? 'On Site' : status.charAt(0).toUpperCase() + status.slice(1)}
                  </button>
                ))}
              </div>
            </div>
            <div className="flex gap-2">
              <Button variant="secondary" onClick={() => setShowModal({ type: 'time-clock' })}>
                <Icon name="clock" className="mr-2" /> Time Clock
              </Button>
              <Button variant="brand">
                <Icon name="user-plus" className="mr-2" /> Add Employee
              </Button>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Employee List */}
            <div className="lg:col-span-2 space-y-3">
              {filteredEmployees.map(emp => {
                const job = jobs.find(j => j.id === emp.jobId);
                const expiringSoon = emp.certifications.filter(c => getDaysUntil(c.expires) < 60);

                return (
                  <Card
                    key={emp.id}
                    className={`p-4 cursor-pointer transition-all ${selectedEmployeeId === emp.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                    onClick={() => setSelectedEmployeeId(emp.id)}
                  >
                    <div className="flex items-center gap-4">
                      <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-medium ${
                        emp.status === 'clocked-in' ? 'bg-green-500' : 'bg-gray-400'
                      }`}>
                        {emp.name.split(' ').map(n => n[0]).join('')}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2">
                          <h4 className="font-medium text-gray-900">{emp.name}</h4>
                          {emp.status === 'clocked-in' && (
                            <span className="text-xs text-green-600 flex items-center gap-1">
                              <span className="w-2 h-2 bg-green-500 rounded-full pulse-dot"></span>
                              Since {emp.clockedInAt}
                            </span>
                          )}
                        </div>
                        <p className="text-sm text-gray-500">{emp.role}</p>
                      </div>
                      <div className="text-right">
                        {job && (
                          <p className="text-sm text-gray-600 flex items-center gap-1">
                            <Icon name="location-dot" className="text-brand-500" />
                            {job.name}
                          </p>
                        )}
                        {expiringSoon.length > 0 && (
                          <p className="text-xs text-red-600 flex items-center gap-1 mt-1">
                            <Icon name="triangle-exclamation" />
                            {expiringSoon.length} cert(s) expiring
                          </p>
                        )}
                      </div>
                    </div>
                  </Card>
                );
              })}
            </div>

            {/* Employee Detail */}
            {selectedEmployee ? (
              <Card className="p-4 h-fit sticky top-4">
                <div className="text-center mb-4">
                  <div className={`w-16 h-16 rounded-full flex items-center justify-center text-white text-xl font-medium mx-auto mb-3 ${
                    selectedEmployee.status === 'clocked-in' ? 'bg-green-500' : 'bg-gray-400'
                  }`}>
                    {selectedEmployee.name.split(' ').map(n => n[0]).join('')}
                  </div>
                  <h3 className="font-semibold text-gray-900">{selectedEmployee.name}</h3>
                  <p className="text-sm text-gray-500">{selectedEmployee.role}</p>
                  <Badge className={`mt-2 ${getStatusColor(selectedEmployee.status)}`}>
                    {selectedEmployee.status === 'clocked-in' ? 'On Site' : 'Off'}
                  </Badge>
                </div>

                <div className="space-y-4">
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Contact</p>
                    <p className="text-sm">{selectedEmployee.phone}</p>
                    <p className="text-sm text-gray-600">{selectedEmployee.email}</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Current Assignment</p>
                    <p className="text-sm font-medium">{employeeJob?.name || 'Unassigned'}</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Hourly Rate</p>
                    <p className="text-lg font-semibold text-brand-600">${selectedEmployee.hourlyRate}/hr</p>
                  </div>

                  <div className="pt-4 border-t border-gray-200">
                    <p className="text-xs text-gray-500 mb-2">Certifications</p>
                    <div className="space-y-2">
                      {selectedEmployee.certifications.map((cert, i) => {
                        const daysLeft = getDaysUntil(cert.expires);
                        const isExpiring = daysLeft < 60;
                        const isExpired = daysLeft < 0;

                        return (
                          <div key={i} className={`p-2 rounded-lg ${isExpired ? 'bg-red-50' : isExpiring ? 'bg-yellow-50' : 'bg-gray-50'}`}>
                            <div className="flex items-center justify-between">
                              <span className="text-sm font-medium">{cert.name}</span>
                              <Badge variant={isExpired ? 'danger' : isExpiring ? 'warning' : 'success'}>
                                {isExpired ? 'Expired' : isExpiring ? `${daysLeft}d left` : 'Valid'}
                              </Badge>
                            </div>
                            <p className="text-xs text-gray-500">Expires: {formatDate(cert.expires)}</p>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div className="flex gap-2 pt-4">
                    <Button variant="secondary" size="sm" className="flex-1">
                      <Icon name="clock-rotate-left" className="mr-1" /> Timesheet
                    </Button>
                    <Button variant="secondary" size="sm" className="flex-1">
                      <Icon name="pen-to-square" className="mr-1" /> Edit
                    </Button>
                  </div>
                </div>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="user" className="text-4xl mb-2 text-gray-300" />
                <p>Select an employee to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // MAINTENANCE VIEW
    // ============================================
    const MaintenanceView = ({ workOrders, setWorkOrders, equipment, employees, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [selectedWOId, setSelectedWOId] = useState(null);

      const filteredWOs = workOrders.filter(wo => filter === 'all' || wo.status === filter || wo.type === filter);
      const selectedWO = workOrders.find(w => w.id === selectedWOId);
      const selectedEquipment = selectedWO ? equipment.find(e => e.id === selectedWO.equipmentId) : null;
      const assignee = selectedWO ? employees.find(e => e.id === selectedWO.assignedTo) : null;

      const upcomingPM = equipment.filter(e => (e.nextService - e.hours) < 250);

      return (
        <div className="space-y-6">
          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="clipboard-list" label="Open Work Orders" value={workOrders.filter(w => w.status !== 'completed').length} color="brand" />
            <StatCard icon="circle-exclamation" label="High Priority" value={workOrders.filter(w => w.priority === 'high' && w.status !== 'completed').length} color="red" />
            <StatCard icon="calendar-check" label="Scheduled PM" value={workOrders.filter(w => w.type === 'preventive').length} color="blue" />
            <StatCard icon="triangle-exclamation" label="PM Due Soon" value={upcomingPM.length} color="yellow" />
          </div>

          {/* Filters */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {['all', 'in-progress', 'scheduled', 'repair', 'preventive'].map(f => (
                  <button
                    key={f}
                    onClick={() => setFilter(f)}
                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${
                      filter === f ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    {f.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                  </button>
                ))}
              </div>
            </div>
            <Button variant="brand" onClick={() => setShowModal({ type: 'work-order' })}>
              <Icon name="plus" className="mr-2" /> New Work Order
            </Button>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Work Orders List */}
            <div className="lg:col-span-2 space-y-3">
              {filteredWOs.map(wo => {
                const eq = equipment.find(e => e.id === wo.equipmentId);
                const tech = employees.find(e => e.id === wo.assignedTo);

                return (
                  <Card
                    key={wo.id}
                    className={`p-4 cursor-pointer transition-all ${selectedWOId === wo.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                    onClick={() => setSelectedWOId(wo.id)}
                  >
                    <div className="flex items-start justify-between mb-2">
                      <div className="flex items-start gap-3">
                        <div className={`p-2 rounded-lg ${
                          wo.type === 'repair' ? 'bg-red-100' : wo.type === 'preventive' ? 'bg-blue-100' : 'bg-yellow-100'
                        }`}>
                          <Icon name={wo.type === 'repair' ? 'screwdriver-wrench' : wo.type === 'preventive' ? 'calendar-check' : 'clipboard-check'} className={`${
                            wo.type === 'repair' ? 'text-red-600' : wo.type === 'preventive' ? 'text-blue-600' : 'text-yellow-600'
                          }`} />
                        </div>
                        <div>
                          <div className="flex items-center gap-2">
                            <h4 className="font-medium text-gray-900">{wo.title}</h4>
                            <Icon name="circle" className={`text-xs ${getPriorityColor(wo.priority)}`} />
                          </div>
                          <p className="text-sm text-gray-500">{eq?.name}</p>
                        </div>
                      </div>
                      <Badge className={getStatusColor(wo.status)}>{wo.status}</Badge>
                    </div>
                    <div className="flex items-center justify-between text-xs text-gray-500 mt-3">
                      <span><Icon name="user" className="mr-1" />{tech?.name || 'Unassigned'}</span>
                      <span><Icon name="calendar" className="mr-1" />Due {formatDate(wo.dueDate)}</span>
                    </div>
                  </Card>
                );
              })}

              {/* Upcoming PM Section */}
              <div className="pt-6">
                <h3 className="font-semibold text-gray-900 mb-3">Upcoming Preventive Maintenance</h3>
                <Card className="p-0 overflow-hidden">
                  <table className="w-full">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500">Equipment</th>
                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500">Current Hours</th>
                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500">Service Due</th>
                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500">Hours Until</th>
                        <th className="px-4 py-2 text-right text-xs font-medium text-gray-500">Action</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                      {upcomingPM.map(eq => (
                        <tr key={eq.id} className="hover:bg-gray-50">
                          <td className="px-4 py-3 text-sm font-medium">{eq.name}</td>
                          <td className="px-4 py-3 text-sm">{eq.hours.toLocaleString()}</td>
                          <td className="px-4 py-3 text-sm">{eq.nextService.toLocaleString()}</td>
                          <td className="px-4 py-3">
                            <Badge variant={(eq.nextService - eq.hours) < 100 ? 'danger' : 'warning'}>
                              {eq.nextService - eq.hours} hrs
                            </Badge>
                          </td>
                          <td className="px-4 py-3 text-right">
                            <Button variant="ghost" size="sm" onClick={() => setShowModal({ type: 'work-order', data: { equipmentId: eq.id, type: 'preventive' } })}>
                              Schedule
                            </Button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </Card>
              </div>
            </div>

            {/* Work Order Detail */}
            {selectedWO ? (
              <Card className="p-4 h-fit sticky top-4">
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <Badge className={`mb-2 ${wo => wo.type === 'repair' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}`}>
                      {selectedWO.type}
                    </Badge>
                    <h3 className="font-semibold text-gray-900">{selectedWO.title}</h3>
                  </div>
                  <Badge className={getStatusColor(selectedWO.status)}>{selectedWO.status}</Badge>
                </div>

                <div className="space-y-4">
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Equipment</p>
                    <p className="text-sm font-medium">{selectedEquipment?.name}</p>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Description</p>
                    <p className="text-sm text-gray-700">{selectedWO.description}</p>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Priority</p>
                      <Badge variant={selectedWO.priority === 'high' ? 'danger' : selectedWO.priority === 'medium' ? 'warning' : 'success'}>
                        {selectedWO.priority}
                      </Badge>
                    </div>
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Due Date</p>
                      <p className="text-sm font-medium">{formatDate(selectedWO.dueDate)}</p>
                    </div>
                  </div>

                  <div>
                    <p className="text-xs text-gray-500 mb-1">Assigned To</p>
                    <p className="text-sm font-medium">{assignee?.name || 'Unassigned'}</p>
                  </div>

                  {selectedWO.parts.length > 0 && (
                    <div className="pt-4 border-t border-gray-200">
                      <p className="text-xs text-gray-500 mb-2">Parts Required</p>
                      <div className="space-y-2">
                        {selectedWO.parts.map((part, i) => (
                          <div key={i} className="flex items-center justify-between text-sm p-2 bg-gray-50 rounded">
                            <span>{part.name} x{part.qty}</span>
                            <span className="font-medium">{formatCurrency(part.cost * part.qty)}</span>
                          </div>
                        ))}
                        <div className="flex items-center justify-between text-sm font-medium pt-2 border-t">
                          <span>Total Parts</span>
                          <span>{formatCurrency(selectedWO.parts.reduce((sum, p) => sum + (p.cost * p.qty), 0))}</span>
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="pt-4 border-t border-gray-200">
                    <p className="text-xs text-gray-500 mb-1">Est. Labor Hours</p>
                    <p className="text-sm font-medium">{selectedWO.laborHours} hours</p>
                  </div>

                  <div className="flex gap-2 pt-4">
                    <Button variant="brand" size="sm" className="flex-1">
                      <Icon name="check" className="mr-1" /> Complete
                    </Button>
                    <Button variant="secondary" size="sm" className="flex-1">
                      <Icon name="pen-to-square" className="mr-1" /> Edit
                    </Button>
                  </div>
                </div>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="wrench" className="text-4xl mb-2 text-gray-300" />
                <p>Select a work order to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // REPORTS VIEW (with Charts)
    // ============================================
    const ReportsView = ({ jobs, equipment, employees, dailyReports }) => {
      const chartRef = useRef(null);
      const pieChartRef = useRef(null);
      const [activeTab, setActiveTab] = useState('overview');

      useEffect(() => {
        // Revenue Chart
        if (chartRef.current) {
          const ctx = chartRef.current.getContext('2d');
          const existingChart = Chart.getChart(ctx);
          if (existingChart) existingChart.destroy();

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: jobs.filter(j => j.status !== 'bidding').map(j => j.name.split(' ').slice(0, 2).join(' ')),
              datasets: [
                { label: 'Budget', data: jobs.filter(j => j.status !== 'bidding').map(j => j.budget), backgroundColor: '#e5e7eb' },
                { label: 'Spent', data: jobs.filter(j => j.status !== 'bidding').map(j => j.spent), backgroundColor: '#f97316' },
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { position: 'bottom' } },
              scales: { y: { beginAtZero: true, ticks: { callback: (v) => '$' + (v/1000) + 'k' } } }
            }
          });
        }

        // Equipment Utilization Pie
        if (pieChartRef.current) {
          const ctx = pieChartRef.current.getContext('2d');
          const existingChart = Chart.getChart(ctx);
          if (existingChart) existingChart.destroy();

          new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ['Active', 'Idle', 'Maintenance'],
              datasets: [{
                data: [
                  equipment.filter(e => e.status === 'active').length,
                  equipment.filter(e => e.status === 'idle').length,
                  equipment.filter(e => e.status === 'maintenance').length,
                ],
                backgroundColor: ['#22c55e', '#eab308', '#ef4444'],
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { position: 'bottom' } }
            }
          });
        }
      }, [jobs, equipment]);

      return (
        <div className="space-y-6">
          <Tabs
            tabs={[
              { id: 'overview', label: 'Overview', icon: 'chart-line' },
              { id: 'daily', label: 'Daily Reports', icon: 'file-lines', count: dailyReports.length },
              { id: 'labor', label: 'Labor', icon: 'users' },
              { id: 'equipment', label: 'Equipment', icon: 'truck-monster' },
            ]}
            activeTab={activeTab}
            onChange={setActiveTab}
          />

          {activeTab === 'overview' && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <Card className="p-4">
                  <h3 className="font-semibold text-gray-900 mb-4">Budget vs Spent by Job</h3>
                  <div className="h-64">
                    <canvas ref={chartRef}></canvas>
                  </div>
                </Card>
                <Card className="p-4">
                  <h3 className="font-semibold text-gray-900 mb-4">Fleet Utilization</h3>
                  <div className="h-64">
                    <canvas ref={pieChartRef}></canvas>
                  </div>
                </Card>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <Card className="p-4">
                  <h4 className="text-sm font-medium text-gray-500 mb-2">Total Contract Value</h4>
                  <p className="text-2xl font-bold text-gray-900">{formatCurrency(jobs.reduce((s, j) => s + j.budget, 0))}</p>
                  <p className="text-sm text-green-600 mt-1">+15% from last month</p>
                </Card>
                <Card className="p-4">
                  <h4 className="text-sm font-medium text-gray-500 mb-2">Total Spent YTD</h4>
                  <p className="text-2xl font-bold text-gray-900">{formatCurrency(jobs.reduce((s, j) => s + j.spent, 0))}</p>
                  <p className="text-sm text-gray-500 mt-1">{Math.round(jobs.reduce((s, j) => s + j.spent, 0) / jobs.reduce((s, j) => s + j.budget, 0) * 100)}% of budget</p>
                </Card>
                <Card className="p-4">
                  <h4 className="text-sm font-medium text-gray-500 mb-2">Projected Profit</h4>
                  <p className="text-2xl font-bold text-green-600">{formatCurrency(jobs.reduce((s, j) => s + (j.budget - j.spent), 0))}</p>
                  <p className="text-sm text-gray-500 mt-1">Across {jobs.filter(j => j.status === 'active').length} active jobs</p>
                </Card>
              </div>
            </div>
          )}

          {activeTab === 'daily' && (
            <div className="space-y-4">
              {dailyReports.map(report => {
                const job = jobs.find(j => j.id === report.jobId);
                const submitter = employees.find(e => e.id === report.submittedBy);
                return (
                  <Card key={report.id} className="p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <h4 className="font-medium text-gray-900">{job?.name}</h4>
                        <p className="text-sm text-gray-500">{formatDate(report.date)} â¢ Submitted by {submitter?.name}</p>
                      </div>
                      <div className="text-right text-sm">
                        <p className="text-gray-500">{report.weather} â¢ {report.tempHigh}Â°/{report.tempLow}Â°</p>
                        <p className="text-gray-500">Crew: {report.crewSize}</p>
                      </div>
                    </div>
                    <div className="space-y-3">
                      <div>
                        <p className="text-xs text-gray-500 mb-1">Work Accomplished</p>
                        <p className="text-sm text-gray-700">{report.workAccomplished}</p>
                      </div>
                      {report.materialsUsed.length > 0 && (
                        <div>
                          <p className="text-xs text-gray-500 mb-1">Materials Used</p>
                          <div className="flex flex-wrap gap-2">
                            {report.materialsUsed.map((m, i) => (
                              <Badge key={i} variant="info">{m.item}: {m.qty} {m.unit}</Badge>
                            ))}
                          </div>
                        </div>
                      )}
                      {report.issues && report.issues !== 'None' && (
                        <div>
                          <p className="text-xs text-gray-500 mb-1">Issues</p>
                          <p className="text-sm text-red-600">{report.issues}</p>
                        </div>
                      )}
                    </div>
                  </Card>
                );
              })}
            </div>
          )}

          {activeTab === 'labor' && (
            <Card className="p-4">
              <h3 className="font-semibold text-gray-900 mb-4">Labor Summary</h3>
              <Table
                columns={[
                  { header: 'Employee', render: (row) => <span className="font-medium">{row.name}</span> },
                  { header: 'Role', key: 'role' },
                  { header: 'Rate', render: (row) => `$${row.hourlyRate}/hr` },
                  { header: 'Status', render: (row) => <Badge className={getStatusColor(row.status)}>{row.status}</Badge> },
                  { header: 'Current Job', render: (row) => jobs.find(j => j.id === row.jobId)?.name || '-' },
                ]}
                data={employees}
              />
            </Card>
          )}

          {activeTab === 'equipment' && (
            <Card className="p-4">
              <h3 className="font-semibold text-gray-900 mb-4">Equipment Summary</h3>
              <Table
                columns={[
                  { header: 'Equipment', render: (row) => <span className="font-medium">{row.name}</span> },
                  { header: 'Type', key: 'type' },
                  { header: 'Hours', render: (row) => row.hours.toLocaleString() },
                  { header: 'Status', render: (row) => <Badge className={getStatusColor(row.status)}>{row.status}</Badge> },
                  { header: 'Daily Rate', render: (row) => formatCurrency(row.dailyRate) },
                  { header: 'Assignment', render: (row) => jobs.find(j => j.id === row.jobId)?.name || 'Unassigned' },
                ]}
                data={equipment}
              />
            </Card>
          )}
        </div>
      );
    };

    // ============================================
    // JOB COSTING VIEW
    // ============================================
    const JobCostingView = ({ jobs }) => {
      const [selectedJobId, setSelectedJobId] = useState(jobs.find(j => j.status === 'active')?.id);
      const selectedJob = jobs.find(j => j.id === selectedJobId);

      const costData = COST_CODES.map(cc => ({
        ...cc,
        actual: Math.round(cc.budgeted * (0.3 + Math.random() * 0.8)),
        variance: 0,
      }));
      costData.forEach(c => c.variance = c.budgeted - c.actual);

      const totalBudget = costData.reduce((s, c) => s + c.budgeted, 0);
      const totalActual = costData.reduce((s, c) => s + c.actual, 0);
      const totalVariance = totalBudget - totalActual;

      return (
        <div className="space-y-6">
          {/* Job Selector */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <label className="text-sm font-medium text-gray-700">Select Job:</label>
              <select
                value={selectedJobId || ''}
                onChange={(e) => setSelectedJobId(Number(e.target.value))}
                className="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500"
              >
                {jobs.filter(j => j.status !== 'bidding').map(job => (
                  <option key={job.id} value={job.id}>{job.name}</option>
                ))}
              </select>
            </div>
            <div className="flex gap-2">
              <Button variant="secondary">
                <Icon name="file-export" className="mr-2" /> Export
              </Button>
              <Button variant="brand">
                <Icon name="plus" className="mr-2" /> Add Cost Entry
              </Button>
            </div>
          </div>

          {selectedJob && (
            <>
              {/* Summary Cards */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <Card className="p-4">
                  <p className="text-sm text-gray-500">Contract Value</p>
                  <p className="text-2xl font-bold text-gray-900">{formatCurrency(selectedJob.budget)}</p>
                </Card>
                <Card className="p-4">
                  <p className="text-sm text-gray-500">Total Budget</p>
                  <p className="text-2xl font-bold text-gray-900">{formatCurrency(totalBudget)}</p>
                </Card>
                <Card className="p-4">
                  <p className="text-sm text-gray-500">Actual Cost</p>
                  <p className="text-2xl font-bold text-gray-900">{formatCurrency(totalActual)}</p>
                </Card>
                <Card className="p-4">
                  <p className="text-sm text-gray-500">Variance</p>
                  <p className={`text-2xl font-bold ${totalVariance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                    {totalVariance >= 0 ? '+' : ''}{formatCurrency(totalVariance)}
                  </p>
                </Card>
              </div>

              {/* Cost Code Breakdown */}
              <Card className="p-0 overflow-hidden">
                <div className="p-4 border-b border-gray-200">
                  <h3 className="font-semibold text-gray-900">Cost Code Breakdown</h3>
                </div>
                <table className="w-full">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                      <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Budgeted</th>
                      <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actual</th>
                      <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Variance</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">% Used</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-100">
                    {costData.map((cc, i) => {
                      const pctUsed = Math.round((cc.actual / cc.budgeted) * 100);
                      return (
                        <tr key={i} className="hover:bg-gray-50">
                          <td className="px-4 py-3 text-sm font-mono text-gray-600">{cc.code}</td>
                          <td className="px-4 py-3 text-sm font-medium text-gray-900">{cc.description}</td>
                          <td className="px-4 py-3 text-sm text-right">{formatCurrency(cc.budgeted)}</td>
                          <td className="px-4 py-3 text-sm text-right">{formatCurrency(cc.actual)}</td>
                          <td className={`px-4 py-3 text-sm text-right font-medium ${cc.variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                            {cc.variance >= 0 ? '+' : ''}{formatCurrency(cc.variance)}
                          </td>
                          <td className="px-4 py-3">
                            <div className="flex items-center gap-2">
                              <div className="w-24">
                                <ProgressBar value={pctUsed} color={pctUsed > 100 ? 'red' : pctUsed > 80 ? 'yellow' : 'green'} size="sm" />
                              </div>
                              <span className="text-xs text-gray-500 w-10">{pctUsed}%</span>
                            </div>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                  <tfoot className="bg-gray-50 font-medium">
                    <tr>
                      <td className="px-4 py-3 text-sm" colSpan="2">Total</td>
                      <td className="px-4 py-3 text-sm text-right">{formatCurrency(totalBudget)}</td>
                      <td className="px-4 py-3 text-sm text-right">{formatCurrency(totalActual)}</td>
                      <td className={`px-4 py-3 text-sm text-right ${totalVariance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {totalVariance >= 0 ? '+' : ''}{formatCurrency(totalVariance)}
                      </td>
                      <td className="px-4 py-3 text-sm">{Math.round((totalActual / totalBudget) * 100)}%</td>
                    </tr>
                  </tfoot>
                </table>
              </Card>
            </>
          )}
        </div>
      );
    };

    // ============================================
    // SAFETY VIEW
    // ============================================
    const SafetyView = ({ employees, setShowModal }) => {
      const [safetyLogs] = useState([
        { id: 1, type: 'Toolbox Talk', topic: 'Excavation Safety', date: '2026-02-03', jobId: 1, attendees: 6, conductor: 'Mike Johnson' },
        { id: 2, type: 'JSA', topic: 'Trench Work - Highway 71', date: '2026-02-03', jobId: 1, attendees: 4, conductor: 'Mike Johnson' },
        { id: 3, type: 'Pre-Op Inspection', topic: 'CAT 336 Excavator', date: '2026-02-03', jobId: 1, attendees: 1, conductor: 'Sarah Williams' },
        { id: 4, type: 'Toolbox Talk', topic: 'Heat Illness Prevention', date: '2026-02-02', jobId: 2, attendees: 4, conductor: 'David Chen' },
      ]);

      const expiringCerts = employees.flatMap(emp =>
        emp.certifications.filter(c => getDaysUntil(c.expires) < 90).map(c => ({
          ...c,
          employeeId: emp.id,
          employeeName: emp.name,
          daysLeft: getDaysUntil(c.expires),
        }))
      ).sort((a, b) => a.daysLeft - b.daysLeft);

      return (
        <div className="space-y-6">
          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="shield-halved" label="Safety Logs (30d)" value={safetyLogs.length} color="green" />
            <StatCard icon="clipboard-check" label="Toolbox Talks" value={safetyLogs.filter(s => s.type === 'Toolbox Talk').length} color="blue" />
            <StatCard icon="triangle-exclamation" label="Expiring Certs" value={expiringCerts.length} color="yellow" />
            <StatCard icon="calendar-xmark" label="Expired Certs" value={expiringCerts.filter(c => c.daysLeft < 0).length} color="red" />
          </div>

          <div className="flex justify-end">
            <Button variant="brand" onClick={() => setShowModal({ type: 'safety' })}>
              <Icon name="plus" className="mr-2" /> New Safety Log
            </Button>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Recent Safety Logs */}
            <Card className="p-0 overflow-hidden">
              <div className="p-4 border-b border-gray-200">
                <h3 className="font-semibold text-gray-900">Recent Safety Logs</h3>
              </div>
              <div className="divide-y divide-gray-100">
                {safetyLogs.map(log => (
                  <div key={log.id} className="p-4 hover:bg-gray-50">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-3">
                        <div className={`p-2 rounded-lg ${
                          log.type === 'Toolbox Talk' ? 'bg-blue-100' : log.type === 'JSA' ? 'bg-yellow-100' : 'bg-green-100'
                        }`}>
                          <Icon name={log.type === 'Toolbox Talk' ? 'users' : log.type === 'JSA' ? 'clipboard-list' : 'clipboard-check'} className={`${
                            log.type === 'Toolbox Talk' ? 'text-blue-600' : log.type === 'JSA' ? 'text-yellow-600' : 'text-green-600'
                          }`} />
                        </div>
                        <div>
                          <p className="font-medium text-gray-900">{log.topic}</p>
                          <p className="text-sm text-gray-500">{log.type}</p>
                        </div>
                      </div>
                      <div className="text-right text-sm text-gray-500">
                        <p>{formatDate(log.date)}</p>
                        <p>{log.attendees} attendees</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </Card>

            {/* Certification Alerts */}
            <Card className="p-0 overflow-hidden">
              <div className="p-4 border-b border-gray-200">
                <h3 className="font-semibold text-gray-900">Certification Alerts</h3>
              </div>
              <div className="divide-y divide-gray-100">
                {expiringCerts.map((cert, i) => (
                  <div key={i} className={`p-4 ${cert.daysLeft < 0 ? 'bg-red-50' : cert.daysLeft < 30 ? 'bg-yellow-50' : ''}`}>
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="font-medium text-gray-900">{cert.employeeName}</p>
                        <p className="text-sm text-gray-500">{cert.name}</p>
                      </div>
                      <div className="text-right">
                        <Badge variant={cert.daysLeft < 0 ? 'danger' : cert.daysLeft < 30 ? 'warning' : 'info'}>
                          {cert.daysLeft < 0 ? 'Expired' : `${cert.daysLeft} days left`}
                        </Badge>
                        <p className="text-xs text-gray-500 mt-1">{formatDate(cert.expires)}</p>
                      </div>
                    </div>
                  </div>
                ))}
                {expiringCerts.length === 0 && (
                  <div className="p-8 text-center text-gray-500">
                    <Icon name="circle-check" className="text-3xl text-green-500 mb-2" />
                    <p>All certifications are current!</p>
                  </div>
                )}
              </div>
            </Card>
          </div>
        </div>
      );
    };

    // ============================================
    // DOCUMENTS VIEW
    // ============================================
    const DocumentsView = ({ jobs }) => {
      const [documents] = useState([
        { id: 1, name: 'Highway 71 Contract.pdf', type: 'Contract', jobId: 1, size: '2.4 MB', uploadedAt: '2025-10-15', uploadedBy: 'John Doe' },
        { id: 2, name: 'ODOT Permit #12345.pdf', type: 'Permit', jobId: 1, size: '156 KB', uploadedAt: '2025-10-20', uploadedBy: 'John Doe', expires: '2026-04-15' },
        { id: 3, name: 'Riverside Site Plans.dwg', type: 'Plans', jobId: 2, size: '15.8 MB', uploadedAt: '2025-12-01', uploadedBy: 'Jane Smith' },
        { id: 4, name: 'Insurance Certificate 2026.pdf', type: 'Insurance', jobId: null, size: '892 KB', uploadedAt: '2026-01-05', uploadedBy: 'John Doe', expires: '2027-01-05' },
        { id: 5, name: 'Equipment Lien Waiver - CAT.pdf', type: 'Lien Waiver', jobId: null, size: '245 KB', uploadedAt: '2026-01-15', uploadedBy: 'Accounting' },
      ]);

      const [filter, setFilter] = useState('all');
      const filteredDocs = documents.filter(d => filter === 'all' || d.type.toLowerCase().includes(filter.toLowerCase()));

      const getTypeIcon = (type) => {
        const icons = {
          'Contract': 'file-contract',
          'Permit': 'file-shield',
          'Plans': 'file-lines',
          'Insurance': 'file-invoice',
          'Lien Waiver': 'file-signature',
        };
        return icons[type] || 'file';
      };

      return (
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {['all', 'contract', 'permit', 'insurance'].map(f => (
                  <button
                    key={f}
                    onClick={() => setFilter(f)}
                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${
                      filter === f ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    {f.charAt(0).toUpperCase() + f.slice(1)}
                  </button>
                ))}
              </div>
              <SearchInput placeholder="Search documents..." value="" onChange={() => {}} />
            </div>
            <Button variant="brand">
              <Icon name="cloud-arrow-up" className="mr-2" /> Upload Document
            </Button>
          </div>

          <Card className="p-0 overflow-hidden">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Job</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Size</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Uploaded</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Expires</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                {filteredDocs.map(doc => {
                  const job = jobs.find(j => j.id === doc.jobId);
                  const isExpiring = doc.expires && getDaysUntil(doc.expires) < 60;
                  return (
                    <tr key={doc.id} className="hover:bg-gray-50">
                      <td className="px-4 py-3">
                        <div className="flex items-center gap-3">
                          <Icon name={getTypeIcon(doc.type)} className="text-gray-400" />
                          <span className="text-sm font-medium text-gray-900">{doc.name}</span>
                        </div>
                      </td>
                      <td className="px-4 py-3 text-sm text-gray-600">{doc.type}</td>
                      <td className="px-4 py-3 text-sm text-gray-600">{job?.name || 'General'}</td>
                      <td className="px-4 py-3 text-sm text-gray-500">{doc.size}</td>
                      <td className="px-4 py-3 text-sm text-gray-500">{formatDate(doc.uploadedAt)}</td>
                      <td className="px-4 py-3">
                        {doc.expires ? (
                          <Badge variant={isExpiring ? 'warning' : 'success'}>
                            {formatDate(doc.expires)}
                          </Badge>
                        ) : (
                          <span className="text-sm text-gray-400">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 text-right">
                        <Button variant="ghost" size="sm">
                          <Icon name="download" />
                        </Button>
                        <Button variant="ghost" size="sm">
                          <Icon name="eye" />
                        </Button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>
        </div>
      );
    };

    // ============================================
    // INVENTORY VIEW
    // ============================================
    const InventoryView = ({ inventory, setInventory, jobs, vendors, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [search, setSearch] = useState('');
      const [showAddModal, setShowAddModal] = useState(false);

      const categories = [...new Set(inventory.map(i => i.category))];
      const filteredInventory = inventory.filter(item => {
        if (filter !== 'all' && item.category !== filter) return false;
        if (search && !item.name.toLowerCase().includes(search.toLowerCase())) return false;
        return true;
      });

      const lowStock = inventory.filter(i => i.qtyOnHand <= i.reorderPoint);
      const totalValue = inventory.reduce((sum, i) => sum + (i.qtyOnHand * i.unitCost), 0);

      return (
        <div className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="boxes-stacked" label="Total Items" value={inventory.length} color="brand" />
            <StatCard icon="triangle-exclamation" label="Low Stock Alerts" value={lowStock.length} color="red" />
            <StatCard icon="dollar-sign" label="Inventory Value" value={formatCurrency(totalValue)} color="green" />
            <StatCard icon="truck-ramp-box" label="Reserved Items" value={inventory.filter(i => i.qtyReserved > 0).length} color="blue" />
          </div>

          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <select value={filter} onChange={(e) => setFilter(e.target.value)} className="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                <option value="all">All Categories</option>
                {categories.map(c => <option key={c} value={c}>{c}</option>)}
              </select>
              <SearchInput value={search} onChange={setSearch} placeholder="Search inventory..." />
            </div>
            <div className="flex gap-2">
              <Button variant="secondary"><Icon name="file-export" className="mr-2" />Export</Button>
              <Button variant="brand" onClick={() => setShowAddModal(true)}><Icon name="plus" className="mr-2" />Add Item</Button>
            </div>
          </div>

          {lowStock.length > 0 && (
            <Card className="p-4 bg-red-50 border-red-200">
              <h4 className="font-medium text-red-800 mb-2"><Icon name="triangle-exclamation" className="mr-2" />Low Stock Alert</h4>
              <div className="flex flex-wrap gap-2">
                {lowStock.map(item => (
                  <Badge key={item.id} variant="danger">{item.name}: {item.qtyOnHand} {item.unit} remaining</Badge>
                ))}
              </div>
            </Card>
          )}

          <Card className="p-0 overflow-hidden">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">On Hand</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Reserved</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Available</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Unit Cost</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Job</th>
                  <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                {filteredInventory.map(item => {
                  const job = jobs.find(j => j.id === item.jobId);
                  const isLow = item.qtyOnHand <= item.reorderPoint;
                  return (
                    <tr key={item.id} className={`hover:bg-gray-50 ${isLow ? 'bg-red-50' : ''}`}>
                      <td className="px-4 py-3">
                        <div className="flex items-center gap-2">
                          {isLow && <Icon name="triangle-exclamation" className="text-red-500" />}
                          <span className="font-medium text-gray-900">{item.name}</span>
                        </div>
                      </td>
                      <td className="px-4 py-3 text-sm text-gray-600">{item.category}</td>
                      <td className="px-4 py-3 text-sm text-right font-medium">{item.qtyOnHand} {item.unit}</td>
                      <td className="px-4 py-3 text-sm text-right text-gray-500">{item.qtyReserved} {item.unit}</td>
                      <td className="px-4 py-3 text-sm text-right font-medium text-green-600">{item.qtyOnHand - item.qtyReserved} {item.unit}</td>
                      <td className="px-4 py-3 text-sm text-right">{formatCurrency(item.unitCost)}</td>
                      <td className="px-4 py-3 text-sm text-gray-600">{item.location}</td>
                      <td className="px-4 py-3 text-sm text-gray-600">{job?.name || 'General'}</td>
                      <td className="px-4 py-3 text-right">
                        <Button variant="ghost" size="sm"><Icon name="pen-to-square" /></Button>
                        <Button variant="ghost" size="sm"><Icon name="truck-ramp-box" /></Button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>
        </div>
      );
    };

    // ============================================
    // TRAINING VIEW (with Video Lessons)
    // ============================================
    const TrainingView = ({ trainingData, setTrainingData, employees, setShowModal }) => {
      const [filter, setFilter] = useState('all');
      const [selectedVideo, setSelectedVideo] = useState(null);
      const [showAssignModal, setShowAssignModal] = useState(false);

      const categories = [...new Set(trainingData.map(t => t.category))];
      const filteredTraining = trainingData.filter(t => filter === 'all' || t.category === filter);

      const requiredIncomplete = trainingData.filter(t => t.required && t.completedBy.length < employees.length);
      const totalCompleted = trainingData.reduce((sum, t) => sum + t.completedBy.length, 0);
      const totalRequired = trainingData.filter(t => t.required).length * employees.length;

      return (
        <div className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="graduation-cap" label="Total Courses" value={trainingData.length} color="brand" />
            <StatCard icon="circle-check" label="Completion Rate" value={`${Math.round((totalCompleted / totalRequired) * 100)}%`} color="green" />
            <StatCard icon="clock" label="Required Incomplete" value={requiredIncomplete.length} color="red" />
            <StatCard icon="play-circle" label="Total Watch Time" value={`${trainingData.reduce((sum, t) => sum + parseInt(t.duration), 0)} min`} color="blue" />
          </div>

          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <select value={filter} onChange={(e) => setFilter(e.target.value)} className="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                <option value="all">All Categories</option>
                {categories.map(c => <option key={c} value={c}>{c}</option>)}
              </select>
            </div>
            <div className="flex gap-2">
              <Button variant="secondary" onClick={() => setShowAssignModal(true)}><Icon name="user-plus" className="mr-2" />Assign Training</Button>
              <Button variant="brand"><Icon name="plus" className="mr-2" />Add Course</Button>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Training Cards */}
            <div className="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
              {filteredTraining.map(course => {
                const completionPct = Math.round((course.completedBy.length / employees.length) * 100);
                return (
                  <Card key={course.id} className="overflow-hidden cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setSelectedVideo(course)}>
                    <div className="relative">
                      <img src={course.thumbnail} alt={course.title} className="w-full h-32 object-cover" />
                      <div className="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity">
                        <Icon name="play-circle" className="text-white text-4xl" />
                      </div>
                      <div className="absolute top-2 right-2">
                        {course.required && <Badge variant="danger">Required</Badge>}
                      </div>
                      <div className="absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded">
                        {course.duration}
                      </div>
                    </div>
                    <div className="p-4">
                      <h4 className="font-medium text-gray-900 mb-1">{course.title}</h4>
                      <p className="text-sm text-gray-500 mb-3">{course.category}</p>
                      <div className="flex items-center justify-between">
                        <div className="flex-1 mr-4">
                          <ProgressBar value={completionPct} color={completionPct === 100 ? 'green' : 'brand'} size="sm" />
                        </div>
                        <span className="text-xs text-gray-500">{course.completedBy.length}/{employees.length}</span>
                      </div>
                      {course.dueDate && (
                        <p className={`text-xs mt-2 ${getDaysUntil(course.dueDate) < 14 ? 'text-red-600' : 'text-gray-500'}`}>
                          <Icon name="calendar" className="mr-1" />Due: {formatDate(course.dueDate)}
                        </p>
                      )}
                    </div>
                  </Card>
                );
              })}
            </div>

            {/* Video Player / Details */}
            {selectedVideo ? (
              <Card className="p-4 h-fit sticky top-4">
                <div className="aspect-video mb-4 bg-black rounded-lg overflow-hidden">
                  <iframe
                    src={selectedVideo.videoUrl}
                    className="w-full h-full"
                    frameBorder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowFullScreen
                  ></iframe>
                </div>
                <h3 className="font-semibold text-gray-900 mb-2">{selectedVideo.title}</h3>
                <div className="flex items-center gap-4 text-sm text-gray-500 mb-4">
                  <span><Icon name="clock" className="mr-1" />{selectedVideo.duration}</span>
                  <span><Icon name="folder" className="mr-1" />{selectedVideo.category}</span>
                </div>

                <div className="mb-4">
                  <p className="text-xs text-gray-500 mb-2">Completion Status</p>
                  <ProgressBar value={(selectedVideo.completedBy.length / employees.length) * 100} color="green" />
                  <p className="text-sm mt-1">{selectedVideo.completedBy.length} of {employees.length} employees completed</p>
                </div>

                <div className="mb-4">
                  <p className="text-xs text-gray-500 mb-2">Completed By</p>
                  <div className="flex flex-wrap gap-1">
                    {selectedVideo.completedBy.map(empId => {
                      const emp = employees.find(e => e.id === empId);
                      return emp ? (
                        <Badge key={empId} variant="success">{emp.name}</Badge>
                      ) : null;
                    })}
                  </div>
                </div>

                <div className="mb-4">
                  <p className="text-xs text-gray-500 mb-2">Not Completed</p>
                  <div className="flex flex-wrap gap-1">
                    {employees.filter(e => !selectedVideo.completedBy.includes(e.id)).map(emp => (
                      <Badge key={emp.id} variant="warning">{emp.name}</Badge>
                    ))}
                  </div>
                </div>

                <Button variant="brand" className="w-full">
                  <Icon name="paper-plane" className="mr-2" />Send Reminder
                </Button>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="play-circle" className="text-4xl mb-2 text-gray-300" />
                <p>Select a course to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // BIDS VIEW
    // ============================================
    const BidsView = ({ bids, setBids }) => {
      const [filter, setFilter] = useState('all');

      const filteredBids = bids.filter(b => filter === 'all' || b.status === filter);
      const totalPending = bids.filter(b => b.status === 'pending' || b.status === 'submitted').reduce((sum, b) => sum + b.amount, 0);
      const winRate = Math.round((bids.filter(b => b.status === 'won').length / bids.filter(b => b.status === 'won' || b.status === 'lost').length) * 100) || 0;

      const getStatusIcon = (status) => {
        const icons = { pending: 'clock', submitted: 'paper-plane', won: 'trophy', lost: 'xmark' };
        return icons[status] || 'file';
      };

      return (
        <div className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="file-invoice-dollar" label="Active Bids" value={bids.filter(b => b.status === 'pending' || b.status === 'submitted').length} color="brand" />
            <StatCard icon="dollar-sign" label="Pending Value" value={formatCurrency(totalPending)} color="blue" />
            <StatCard icon="trophy" label="Win Rate" value={`${winRate}%`} color="green" />
            <StatCard icon="chart-line" label="Avg Probability" value={`${Math.round(bids.filter(b => b.status === 'pending').reduce((sum, b) => sum + b.probability, 0) / bids.filter(b => b.status === 'pending').length) || 0}%`} color="yellow" />
          </div>

          <div className="flex items-center justify-between">
            <div className="flex bg-gray-100 rounded-lg p-1">
              {['all', 'pending', 'submitted', 'won', 'lost'].map(status => (
                <button
                  key={status}
                  onClick={() => setFilter(status)}
                  className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${filter === status ? 'bg-white shadow text-gray-900' : 'text-gray-600 hover:text-gray-900'}`}
                >
                  {status.charAt(0).toUpperCase() + status.slice(1)}
                </button>
              ))}
            </div>
            <Button variant="brand"><Icon name="plus" className="mr-2" />New Bid</Button>
          </div>

          <div className="space-y-4">
            {filteredBids.map(bid => (
              <Card key={bid.id} className="p-4">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-4">
                    <div className={`p-3 rounded-lg ${bid.status === 'won' ? 'bg-green-100' : bid.status === 'lost' ? 'bg-red-100' : 'bg-blue-100'}`}>
                      <Icon name={getStatusIcon(bid.status)} className={`text-lg ${bid.status === 'won' ? 'text-green-600' : bid.status === 'lost' ? 'text-red-600' : 'text-blue-600'}`} />
                    </div>
                    <div>
                      <h4 className="font-semibold text-gray-900">{bid.projectName}</h4>
                      <p className="text-sm text-gray-500">{bid.client}</p>
                      <p className="text-xs text-gray-400 mt-1">Bid Date: {formatDate(bid.bidDate)} â¢ Estimator: {bid.estimator}</p>
                    </div>
                  </div>
                  <div className="text-right">
                    <p className="text-xl font-bold text-gray-900">{formatCurrency(bid.amount)}</p>
                    <Badge className={getStatusColor(bid.status)}>{bid.status}</Badge>
                    {bid.status === 'pending' && (
                      <p className="text-sm text-gray-500 mt-1">{bid.probability}% probability</p>
                    )}
                  </div>
                </div>
                {bid.notes && (
                  <div className="mt-3 pt-3 border-t border-gray-100">
                    <p className="text-sm text-gray-600"><Icon name="sticky-note" className="mr-2 text-gray-400" />{bid.notes}</p>
                  </div>
                )}
              </Card>
            ))}
          </div>
        </div>
      );
    };

    // ============================================
    // VENDORS VIEW
    // ============================================
    const VendorsView = ({ vendors, setVendors }) => {
      const [search, setSearch] = useState('');
      const [selectedVendor, setSelectedVendor] = useState(null);

      const categories = [...new Set(vendors.map(v => v.category))];
      const filteredVendors = vendors.filter(v =>
        !search || v.name.toLowerCase().includes(search.toLowerCase()) || v.category.toLowerCase().includes(search.toLowerCase())
      );

      const renderStars = (rating) => (
        <div className="flex gap-0.5">
          {[1,2,3,4,5].map(i => (
            <Icon key={i} name="star" className={`text-sm ${i <= rating ? 'text-yellow-400' : 'text-gray-300'}`} />
          ))}
        </div>
      );

      return (
        <div className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <StatCard icon="building" label="Total Vendors" value={vendors.length} color="brand" />
            <StatCard icon="star" label="Top Rated" value={vendors.filter(v => v.rating === 5).length} color="yellow" />
            <StatCard icon="clipboard-list" label="Active Orders" value={vendors.reduce((sum, v) => sum + v.activeOrders, 0)} color="blue" />
            <StatCard icon="tags" label="Categories" value={categories.length} color="green" />
          </div>

          <div className="flex items-center justify-between">
            <SearchInput value={search} onChange={setSearch} placeholder="Search vendors..." />
            <Button variant="brand"><Icon name="plus" className="mr-2" />Add Vendor</Button>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 space-y-3">
              {filteredVendors.map(vendor => (
                <Card
                  key={vendor.id}
                  className={`p-4 cursor-pointer transition-all ${selectedVendor?.id === vendor.id ? 'ring-2 ring-brand-500' : 'hover:shadow-md'}`}
                  onClick={() => setSelectedVendor(vendor)}
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                        <Icon name="building" className="text-gray-500 text-xl" />
                      </div>
                      <div>
                        <h4 className="font-semibold text-gray-900">{vendor.name}</h4>
                        <p className="text-sm text-gray-500">{vendor.category}</p>
                        {renderStars(vendor.rating)}
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="text-sm text-gray-600">{vendor.contact}</p>
                      <p className="text-sm text-gray-500">{vendor.phone}</p>
                      {vendor.activeOrders > 0 && (
                        <Badge variant="info" className="mt-1">{vendor.activeOrders} active order{vendor.activeOrders > 1 ? 's' : ''}</Badge>
                      )}
                    </div>
                  </div>
                </Card>
              ))}
            </div>

            {selectedVendor ? (
              <Card className="p-4 h-fit sticky top-4">
                <div className="text-center mb-4">
                  <div className="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <Icon name="building" className="text-gray-500 text-2xl" />
                  </div>
                  <h3 className="font-semibold text-gray-900">{selectedVendor.name}</h3>
                  <p className="text-sm text-gray-500">{selectedVendor.category}</p>
                  <div className="flex justify-center mt-2">{renderStars(selectedVendor.rating)}</div>
                </div>
                <div className="space-y-4">
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Contact</p>
                    <p className="text-sm font-medium">{selectedVendor.contact}</p>
                  </div>
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Phone</p>
                    <p className="text-sm">{selectedVendor.phone}</p>
                  </div>
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Email</p>
                    <p className="text-sm text-brand-600">{selectedVendor.email}</p>
                  </div>
                  <div className="flex gap-2 pt-4">
                    <Button variant="secondary" size="sm" className="flex-1"><Icon name="phone" className="mr-1" />Call</Button>
                    <Button variant="secondary" size="sm" className="flex-1"><Icon name="envelope" className="mr-1" />Email</Button>
                  </div>
                  <Button variant="brand" className="w-full"><Icon name="file-invoice" className="mr-2" />New Order</Button>
                </div>
              </Card>
            ) : (
              <Card className="p-8 text-center text-gray-500">
                <Icon name="building" className="text-4xl mb-2 text-gray-300" />
                <p>Select a vendor to view details</p>
              </Card>
            )}
          </div>
        </div>
      );
    };

    // ============================================
    // FINANCE VIEW (QBO Integration Placeholder)
    // ============================================
    const FinanceView = ({ jobs }) => {
      const [connected, setConnected] = useState(false);
      const [syncing, setSyncing] = useState(false);

      const mockFinancials = {
        revenue: { current: 2847500, previous: 2150000, change: 32.4 },
        expenses: { current: 1892000, previous: 1650000, change: 14.7 },
        profit: { current: 955500, previous: 500000, change: 91.1 },
        receivables: { current: 485000, overdue: 125000 },
        payables: { current: 312000, overdue: 45000 },
      };

      const recentTransactions = [
        { id: 1, date: '2026-02-05', description: 'ODOT - Progress Payment #4', type: 'income', amount: 425000, status: 'cleared' },
        { id: 2, date: '2026-02-04', description: 'Martin Marietta - Aggregate', type: 'expense', amount: 28500, status: 'cleared' },
        { id: 3, date: '2026-02-03', description: 'Payroll - Week Ending 2/1', type: 'expense', amount: 86400, status: 'cleared' },
        { id: 4, date: '2026-02-02', description: 'CAT - Parts & Service', type: 'expense', amount: 12850, status: 'pending' },
        { id: 5, date: '2026-02-01', description: 'Kaufman Dev - Invoice #1082', type: 'income', amount: 185000, status: 'pending' },
      ];

      return (
        <div className="space-y-6">
          {/* Connection Status Banner */}
          {!connected ? (
            <Card className="p-6 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center">
                    <Icon name="plug" className="text-3xl" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold">Connect Your Accounting Software</h3>
                    <p className="text-blue-100">Sync with QuickBooks Online, Xero, or Sage to see real-time financials</p>
                  </div>
                </div>
                <div className="flex gap-3">
                  <button onClick={() => setConnected(true)} className="px-6 py-3 bg-white text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition-colors flex items-center gap-2">
                    <Icon name="link" /> Connect QuickBooks
                  </button>
                  <button className="px-6 py-3 bg-white/20 text-white font-semibold rounded-lg hover:bg-white/30 transition-colors">
                    Other Options
                  </button>
                </div>
              </div>
            </Card>
          ) : (
            <Card className="p-4 bg-green-50 border-green-200">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <Icon name="circle-check" className="text-green-500 text-xl" />
                  <div>
                    <p className="font-medium text-green-800">Connected to QuickBooks Online</p>
                    <p className="text-sm text-green-600">Last synced: 5 minutes ago</p>
                  </div>
                </div>
                <Button variant="secondary" size="sm" onClick={() => setSyncing(true)}>
                  <Icon name="rotate" className={`mr-2 ${syncing ? 'animate-spin' : ''}`} /> Sync Now
                </Button>
              </div>
            </Card>
          )}

          {/* Financial KPIs */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Card className="p-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-500">Revenue YTD</span>
                <Badge variant="success">+{mockFinancials.revenue.change}%</Badge>
              </div>
              <p className="text-3xl font-bold text-gray-900">{formatCurrency(mockFinancials.revenue.current)}</p>
              <p className="text-sm text-gray-500">vs {formatCurrency(mockFinancials.revenue.previous)} last year</p>
            </Card>
            <Card className="p-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-500">Expenses YTD</span>
                <Badge variant="warning">+{mockFinancials.expenses.change}%</Badge>
              </div>
              <p className="text-3xl font-bold text-gray-900">{formatCurrency(mockFinancials.expenses.current)}</p>
              <p className="text-sm text-gray-500">vs {formatCurrency(mockFinancials.expenses.previous)} last year</p>
            </Card>
            <Card className="p-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-500">Net Profit YTD</span>
                <Badge variant="success">+{mockFinancials.profit.change}%</Badge>
              </div>
              <p className="text-3xl font-bold text-green-600">{formatCurrency(mockFinancials.profit.current)}</p>
              <p className="text-sm text-gray-500">vs {formatCurrency(mockFinancials.profit.previous)} last year</p>
            </Card>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Receivables & Payables */}
            <Card className="p-4">
              <h3 className="font-semibold text-gray-900 mb-4">
                <Icon name="money-bill-transfer" className="mr-2 text-brand-500" />
                Accounts Overview
              </h3>
              <div className="space-y-4">
                <div className="p-4 bg-green-50 rounded-lg">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-green-800">Accounts Receivable</span>
                    <span className="text-xl font-bold text-green-600">{formatCurrency(mockFinancials.receivables.current)}</span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-green-600">Overdue</span>
                    <span className="font-medium text-red-600">{formatCurrency(mockFinancials.receivables.overdue)}</span>
                  </div>
                </div>
                <div className="p-4 bg-red-50 rounded-lg">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-red-800">Accounts Payable</span>
                    <span className="text-xl font-bold text-red-600">{formatCurrency(mockFinancials.payables.current)}</span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-red-600">Overdue</span>
                    <span className="font-medium text-red-600">{formatCurrency(mockFinancials.payables.overdue)}</span>
                  </div>
                </div>
              </div>
            </Card>

            {/* Recent Transactions */}
            <Card className="p-4">
              <h3 className="font-semibold text-gray-900 mb-4">
                <Icon name="receipt" className="mr-2 text-brand-500" />
                Recent Transactions
              </h3>
              <div className="space-y-3">
                {recentTransactions.map(tx => (
                  <div key={tx.id} className="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${tx.type === 'income' ? 'bg-green-100' : 'bg-red-100'}`}>
                        <Icon name={tx.type === 'income' ? 'arrow-down' : 'arrow-up'} className={tx.type === 'income' ? 'text-green-600' : 'text-red-600'} />
                      </div>
                      <div>
                        <p className="text-sm font-medium text-gray-900">{tx.description}</p>
                        <p className="text-xs text-gray-500">{formatDate(tx.date)}</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <p className={`font-semibold ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                        {tx.type === 'income' ? '+' : '-'}{formatCurrency(tx.amount)}
                      </p>
                      <Badge variant={tx.status === 'cleared' ? 'success' : 'warning'} className="text-xs">{tx.status}</Badge>
                    </div>
                  </div>
                ))}
              </div>
            </Card>
          </div>

          {/* Job Profitability */}
          <Card className="p-4">
            <h3 className="font-semibold text-gray-900 mb-4">
              <Icon name="chart-simple" className="mr-2 text-brand-500" />
              Job Profitability
            </h3>
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Job</th>
                  <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Contract</th>
                  <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Billed</th>
                  <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Costs</th>
                  <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Profit</th>
                  <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Margin</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                {jobs.filter(j => j.status === 'active').map(job => {
                  const billed = job.spent * 1.15;
                  const profit = billed - job.spent;
                  const margin = Math.round((profit / billed) * 100);
                  return (
                    <tr key={job.id} className="hover:bg-gray-50">
                      <td className="px-4 py-3 font-medium text-gray-900">{job.name}</td>
                      <td className="px-4 py-3 text-right">{formatCurrency(job.budget)}</td>
                      <td className="px-4 py-3 text-right">{formatCurrency(billed)}</td>
                      <td className="px-4 py-3 text-right">{formatCurrency(job.spent)}</td>
                      <td className="px-4 py-3 text-right font-medium text-green-600">{formatCurrency(profit)}</td>
                      <td className="px-4 py-3 text-right">
                        <Badge variant={margin > 15 ? 'success' : margin > 10 ? 'warning' : 'danger'}>{margin}%</Badge>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>
        </div>
      );
    };

    // ============================================
    // MESSAGES VIEW - Team Communication Hub
    // ============================================
    const MessagesView = ({ employees }) => {
      const [activeConversation, setActiveConversation] = useState(null);
      const [messageText, setMessageText] = useState('');
      const [searchTerm, setSearchTerm] = useState('');
      const [showNewMessage, setShowNewMessage] = useState(false);
      const [activeTab, setActiveTab] = useState('all');
      const messagesEndRef = React.useRef(null);

      // Current user (simulated)
      const currentUser = { id: 99, name: 'John Doe', initials: 'JD', role: 'Operations Manager', status: 'online' };

      // Channels
      const [channels] = useState([
        { id: 'ch-1', type: 'channel', name: 'general', icon: 'hashtag', description: 'Company-wide announcements', members: 12, unread: 2 },
        { id: 'ch-2', type: 'channel', name: 'field-crew', icon: 'helmet-safety', description: 'Field team coordination', members: 8, unread: 0 },
        { id: 'ch-3', type: 'channel', name: 'equipment-updates', icon: 'truck-field', description: 'Fleet status and issues', members: 6, unread: 1 },
        { id: 'ch-4', type: 'channel', name: 'safety-alerts', icon: 'shield-halved', description: 'Safety notifications', members: 12, unread: 0, important: true },
        { id: 'ch-5', type: 'channel', name: 'project-highway42', icon: 'road', description: 'Highway 42 Expansion team', members: 5, unread: 0 },
      ]);

      // Direct Messages
      const [directMessages] = useState([
        { id: 'dm-1', type: 'dm', recipientId: 1, name: 'Mike Rodriguez', initials: 'MR', role: 'Foreman', status: 'online', unread: 1, lastMessage: 'The CAT 320 is ready for pickup', lastTime: '10:32 AM' },
        { id: 'dm-2', type: 'dm', recipientId: 2, name: 'Sarah Chen', initials: 'SC', role: 'Project Manager', status: 'online', unread: 0, lastMessage: 'Thanks for the update!', lastTime: '9:15 AM' },
        { id: 'dm-3', type: 'dm', recipientId: 3, name: 'Tom Wilson', initials: 'TW', role: 'Equipment Operator', status: 'away', unread: 0, lastMessage: 'Got it, heading there now', lastTime: 'Yesterday' },
        { id: 'dm-4', type: 'dm', recipientId: 4, name: 'Lisa Martinez', initials: 'LM', role: 'Safety Officer', status: 'offline', unread: 2, lastMessage: 'Please review the incident report', lastTime: 'Yesterday' },
        { id: 'dm-5', type: 'dm', recipientId: 5, name: 'James Brown', initials: 'JB', role: 'Mechanic', status: 'online', unread: 0, lastMessage: 'Parts arrived this morning', lastTime: 'Mon' },
      ]);

      // Sample messages for conversations
      const [conversationMessages, setConversationMessages] = useState({
        'ch-1': [
          { id: 1, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'Good morning team! Weather looks clear for the rest of the week.', time: '8:00 AM', date: 'Today', reactions: [{ emoji: 'ð', count: 4 }] },
          { id: 2, senderId: 2, sender: 'Sarah Chen', initials: 'SC', content: 'Great news! We should be able to make up for lost time on Highway 42.', time: '8:15 AM', date: 'Today' },
          { id: 3, senderId: 99, sender: 'John Doe', initials: 'JD', content: 'Agreed. Let\'s push to finish the grading by Friday.', time: '8:22 AM', date: 'Today', isOwn: true },
          { id: 4, senderId: 3, sender: 'Tom Wilson', initials: 'TW', content: 'I can bring the dozer over from Site B if needed.', time: '8:30 AM', date: 'Today' },
          { id: 5, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'That would help. @John can we authorize the move?', time: '8:45 AM', date: 'Today', mention: true },
          { id: 6, senderId: 99, sender: 'John Doe', initials: 'JD', content: 'Yes, go ahead. I\'ll update the schedule.', time: '9:00 AM', date: 'Today', isOwn: true },
        ],
        'ch-3': [
          { id: 1, senderId: 5, sender: 'James Brown', initials: 'JB', content: 'CAT 320 Excavator maintenance complete. Ready for deployment.', time: '7:30 AM', date: 'Today', reactions: [{ emoji: 'â', count: 2 }] },
          { id: 2, senderId: 5, sender: 'James Brown', initials: 'JB', content: 'Also replaced hydraulic lines on Dozer #3. Good for another 500 hours.', time: '7:32 AM', date: 'Today', file: { name: 'maintenance-report-dozer3.pdf', size: '245 KB', type: 'pdf' } },
          { id: 3, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'Perfect timing. We need it at Highway 42 tomorrow.', time: '9:15 AM', date: 'Today' },
        ],
        'dm-1': [
          { id: 1, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'Hey, quick question about the grading specs for lot 4', time: '9:00 AM', date: 'Today' },
          { id: 2, senderId: 99, sender: 'John Doe', initials: 'JD', content: 'Sure, what do you need?', time: '9:05 AM', date: 'Today', isOwn: true },
          { id: 3, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'The plans show 2% grade but the surveyor marked 1.5%. Which one do we follow?', time: '9:08 AM', date: 'Today', file: { name: 'lot4-survey.jpg', size: '1.2 MB', type: 'image' } },
          { id: 4, senderId: 99, sender: 'John Doe', initials: 'JD', content: 'Go with the surveyor marks. I\'ll get the plans updated.', time: '9:15 AM', date: 'Today', isOwn: true },
          { id: 5, senderId: 1, sender: 'Mike Rodriguez', initials: 'MR', content: 'Got it. Also, the CAT 320 is ready for pickup', time: '10:32 AM', date: 'Today' },
        ],
        'dm-4': [
          { id: 1, senderId: 4, sender: 'Lisa Martinez', initials: 'LM', content: 'Hi John, I need you to review the incident report from yesterday', time: '4:30 PM', date: 'Yesterday' },
          { id: 2, senderId: 4, sender: 'Lisa Martinez', initials: 'LM', content: 'Minor injury - Tom scraped his arm on some rebar. Already treated on site.', time: '4:31 PM', date: 'Yesterday', file: { name: 'incident-report-020526.pdf', size: '156 KB', type: 'pdf' } },
          { id: 3, senderId: 99, sender: 'John Doe', initials: 'JD', content: 'Thanks Lisa. I\'ll review and sign off today.', time: '4:45 PM', date: 'Yesterday', isOwn: true },
          { id: 4, senderId: 4, sender: 'Lisa Martinez', initials: 'LM', content: 'Also scheduling a safety refresher for next week. Can you make Tuesday morning work?', time: '5:00 PM', date: 'Yesterday' },
          { id: 5, senderId: 4, sender: 'Lisa Martinez', initials: 'LM', content: 'Just following up on the Tuesday safety refresher - let me know!', time: '9:00 AM', date: 'Today' },
        ],
      });

      const allConversations = [...channels, ...directMessages];

      const filteredConversations = allConversations.filter(conv => {
        const matchesSearch = conv.name.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesTab = activeTab === 'all' ||
                          (activeTab === 'channels' && conv.type === 'channel') ||
                          (activeTab === 'direct' && conv.type === 'dm') ||
                          (activeTab === 'unread' && conv.unread > 0);
        return matchesSearch && matchesTab;
      });

      const totalUnread = allConversations.reduce((sum, c) => sum + (c.unread || 0), 0);

      const getStatusColor = (status) => {
        switch(status) {
          case 'online': return 'bg-green-500';
          case 'away': return 'bg-yellow-500';
          default: return 'bg-gray-400';
        }
      };

      const sendMessage = () => {
        if (!messageText.trim() || !activeConversation) return;

        const newMessage = {
          id: Date.now(),
          senderId: 99,
          sender: 'John Doe',
          initials: 'JD',
          content: messageText,
          time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
          date: 'Today',
          isOwn: true,
        };

        setConversationMessages(prev => ({
          ...prev,
          [activeConversation.id]: [...(prev[activeConversation.id] || []), newMessage]
        }));
        setMessageText('');
      };

      const currentMessages = activeConversation ? (conversationMessages[activeConversation.id] || []) : [];

      return (
        <div className="flex h-[calc(100vh-140px)] bg-white rounded-lg border border-gray-200 overflow-hidden">
          {/* Sidebar - Conversations List */}
          <div className="w-80 border-r border-gray-200 flex flex-col">
            {/* Header */}
            <div className="p-4 border-b border-gray-200">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-bold text-gray-900">Messages</h2>
                <button
                  onClick={() => setShowNewMessage(true)}
                  className="p-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors"
                >
                  <Icon name="pen-to-square" />
                </button>
              </div>
              <div className="relative">
                <Icon name="magnifying-glass" className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
                <input
                  type="text"
                  placeholder="Search conversations..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-2 bg-gray-100 border-0 rounded-lg text-sm focus:ring-2 focus:ring-brand-500"
                />
              </div>
            </div>

            {/* Tabs */}
            <div className="flex border-b border-gray-200 px-2">
              {[
                { id: 'all', label: 'All' },
                { id: 'channels', label: 'Channels' },
                { id: 'direct', label: 'Direct' },
                { id: 'unread', label: `Unread (${totalUnread})` },
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex-1 py-2 text-sm font-medium transition-colors ${
                    activeTab === tab.id
                      ? 'text-brand-600 border-b-2 border-brand-500'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  {tab.label}
                </button>
              ))}
            </div>

            {/* Conversations List */}
            <div className="flex-1 overflow-y-auto">
              {/* Channels Section */}
              {(activeTab === 'all' || activeTab === 'channels') && (
                <div className="py-2">
                  {activeTab === 'all' && (
                    <p className="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Channels</p>
                  )}
                  {filteredConversations.filter(c => c.type === 'channel').map(channel => (
                    <button
                      key={channel.id}
                      onClick={() => setActiveConversation(channel)}
                      className={`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors ${
                        activeConversation?.id === channel.id ? 'bg-brand-50' : ''
                      }`}
                    >
                      <div className={`w-9 h-9 rounded-lg flex items-center justify-center ${channel.important ? 'bg-red-100' : 'bg-gray-100'}`}>
                        <Icon name={channel.icon} className={channel.important ? 'text-red-600' : 'text-gray-600'} />
                      </div>
                      <div className="flex-1 text-left">
                        <div className="flex items-center gap-2">
                          <span className="font-medium text-gray-900 text-sm"># {channel.name}</span>
                          {channel.unread > 0 && (
                            <span className="px-1.5 py-0.5 bg-brand-500 text-white text-xs rounded-full">{channel.unread}</span>
                          )}
                        </div>
                        <p className="text-xs text-gray-500 truncate">{channel.members} members</p>
                      </div>
                    </button>
                  ))}
                </div>
              )}

              {/* Direct Messages Section */}
              {(activeTab === 'all' || activeTab === 'direct' || activeTab === 'unread') && (
                <div className="py-2">
                  {activeTab === 'all' && (
                    <p className="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Direct Messages</p>
                  )}
                  {filteredConversations.filter(c => c.type === 'dm').map(dm => (
                    <button
                      key={dm.id}
                      onClick={() => setActiveConversation(dm)}
                      className={`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors ${
                        activeConversation?.id === dm.id ? 'bg-brand-50' : ''
                      }`}
                    >
                      <div className="relative">
                        <div className="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700">
                          {dm.initials}
                        </div>
                        <span className={`absolute bottom-0 right-0 w-3 h-3 ${getStatusColor(dm.status)} rounded-full border-2 border-white`}></span>
                      </div>
                      <div className="flex-1 text-left min-w-0">
                        <div className="flex items-center justify-between">
                          <span className="font-medium text-gray-900 text-sm">{dm.name}</span>
                          <span className="text-xs text-gray-400">{dm.lastTime}</span>
                        </div>
                        <div className="flex items-center justify-between">
                          <p className="text-xs text-gray-500 truncate pr-2">{dm.lastMessage}</p>
                          {dm.unread > 0 && (
                            <span className="px-1.5 py-0.5 bg-brand-500 text-white text-xs rounded-full flex-shrink-0">{dm.unread}</span>
                          )}
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Main Chat Area */}
          {activeConversation ? (
            <div className="flex-1 flex flex-col">
              {/* Chat Header */}
              <div className="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  {activeConversation.type === 'channel' ? (
                    <div className="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center">
                      <Icon name={activeConversation.icon} className="text-gray-600" />
                    </div>
                  ) : (
                    <div className="relative">
                      <div className="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-medium text-gray-700">
                        {activeConversation.initials}
                      </div>
                      <span className={`absolute bottom-0 right-0 w-3 h-3 ${getStatusColor(activeConversation.status)} rounded-full border-2 border-white`}></span>
                    </div>
                  )}
                  <div>
                    <h3 className="font-semibold text-gray-900">
                      {activeConversation.type === 'channel' ? `# ${activeConversation.name}` : activeConversation.name}
                    </h3>
                    <p className="text-xs text-gray-500">
                      {activeConversation.type === 'channel'
                        ? `${activeConversation.members} members`
                        : `${activeConversation.role} â¢ ${activeConversation.status}`
                      }
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                    <Icon name="phone" />
                  </button>
                  <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                    <Icon name="video" />
                  </button>
                  <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                    <Icon name="circle-info" />
                  </button>
                </div>
              </div>

              {/* Messages */}
              <div className="flex-1 overflow-y-auto p-6 space-y-4">
                {currentMessages.map((msg, idx) => {
                  const showDate = idx === 0 || currentMessages[idx - 1]?.date !== msg.date;
                  return (
                    <React.Fragment key={msg.id}>
                      {showDate && (
                        <div className="flex items-center gap-4 my-4">
                          <div className="flex-1 h-px bg-gray-200"></div>
                          <span className="text-xs text-gray-500 font-medium">{msg.date}</span>
                          <div className="flex-1 h-px bg-gray-200"></div>
                        </div>
                      )}
                      <div className={`flex gap-3 ${msg.isOwn ? 'flex-row-reverse' : ''}`}>
                        {!msg.isOwn && (
                          <div className="w-9 h-9 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700 flex-shrink-0">
                            {msg.initials}
                          </div>
                        )}
                        <div className={`max-w-[70%] ${msg.isOwn ? 'items-end' : ''}`}>
                          {!msg.isOwn && (
                            <div className="flex items-center gap-2 mb-1">
                              <span className="text-sm font-medium text-gray-900">{msg.sender}</span>
                              <span className="text-xs text-gray-400">{msg.time}</span>
                            </div>
                          )}
                          <div className={`rounded-2xl px-4 py-2 ${
                            msg.isOwn
                              ? 'bg-brand-500 text-white rounded-br-md'
                              : msg.mention
                                ? 'bg-yellow-50 border border-yellow-200 rounded-bl-md'
                                : 'bg-gray-100 text-gray-900 rounded-bl-md'
                          }`}>
                            <p className="text-sm">{msg.content}</p>
                          </div>
                          {msg.file && (
                            <div className="mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg flex items-center gap-3 max-w-xs">
                              <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                                msg.file.type === 'pdf' ? 'bg-red-100' : 'bg-blue-100'
                              }`}>
                                <Icon name={msg.file.type === 'pdf' ? 'file-pdf' : 'file-image'} className={
                                  msg.file.type === 'pdf' ? 'text-red-600' : 'text-blue-600'
                                } />
                              </div>
                              <div className="flex-1 min-w-0">
                                <p className="text-sm font-medium text-gray-900 truncate">{msg.file.name}</p>
                                <p className="text-xs text-gray-500">{msg.file.size}</p>
                              </div>
                              <button className="p-2 text-gray-400 hover:text-gray-600">
                                <Icon name="download" />
                              </button>
                            </div>
                          )}
                          {msg.reactions && msg.reactions.length > 0 && (
                            <div className="flex gap-1 mt-1">
                              {msg.reactions.map((r, i) => (
                                <span key={i} className="px-2 py-0.5 bg-gray-100 rounded-full text-xs">
                                  {r.emoji} {r.count}
                                </span>
                              ))}
                            </div>
                          )}
                          {msg.isOwn && (
                            <p className="text-xs text-gray-400 text-right mt-1">{msg.time}</p>
                          )}
                        </div>
                      </div>
                    </React.Fragment>
                  );
                })}
                <div ref={messagesEndRef} />
              </div>

              {/* Message Input */}
              <div className="px-6 py-4 border-t border-gray-200">
                <div className="flex items-end gap-3">
                  <div className="flex gap-1">
                    <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                      <Icon name="paperclip" />
                    </button>
                    <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                      <Icon name="image" />
                    </button>
                  </div>
                  <div className="flex-1 relative">
                    <textarea
                      value={messageText}
                      onChange={(e) => setMessageText(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                          e.preventDefault();
                          sendMessage();
                        }
                      }}
                      placeholder={`Message ${activeConversation.type === 'channel' ? '#' + activeConversation.name : activeConversation.name}`}
                      className="w-full px-4 py-3 bg-gray-100 border-0 rounded-xl text-sm resize-none focus:ring-2 focus:ring-brand-500"
                      rows="1"
                    />
                  </div>
                  <div className="flex gap-1">
                    <button className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">
                      <Icon name="face-smile" />
                    </button>
                    <button
                      onClick={sendMessage}
                      disabled={!messageText.trim()}
                      className="p-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <Icon name="paper-plane" />
                    </button>
                  </div>
                </div>
                <p className="text-xs text-gray-400 mt-2">Press Enter to send, Shift + Enter for new line</p>
              </div>
            </div>
          ) : (
            /* No Conversation Selected */
            <div className="flex-1 flex items-center justify-center bg-gray-50">
              <div className="text-center">
                <div className="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Icon name="comments" className="text-3xl text-gray-400" />
                </div>
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Your Messages</h3>
                <p className="text-gray-500 mb-6 max-w-sm">Select a conversation to start messaging or create a new one.</p>
                <Button variant="brand" onClick={() => setShowNewMessage(true)}>
                  <Icon name="pen-to-square" className="mr-2" /> New Message
                </Button>
              </div>
            </div>
          )}

          {/* New Message Modal */}
          {showNewMessage && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-white rounded-xl w-full max-w-md mx-4 overflow-hidden">
                <div className="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                  <h3 className="font-semibold text-gray-900">New Message</h3>
                  <button onClick={() => setShowNewMessage(false)} className="p-1 text-gray-400 hover:text-gray-600">
                    <Icon name="xmark" />
                  </button>
                </div>
                <div className="p-6">
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">To:</label>
                    <input
                      type="text"
                      placeholder="Search people or channels..."
                      className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                    />
                  </div>
                  <div className="space-y-2 max-h-64 overflow-y-auto">
                    <p className="text-xs font-semibold text-gray-500 uppercase mb-2">Suggested</p>
                    {employees.slice(0, 5).map(emp => (
                      <button
                        key={emp.id}
                        onClick={() => {
                          const existingDm = directMessages.find(dm => dm.recipientId === emp.id);
                          if (existingDm) {
                            setActiveConversation(existingDm);
                          }
                          setShowNewMessage(false);
                        }}
                        className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors"
                      >
                        <div className="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700">
                          {emp.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div className="text-left">
                          <p className="font-medium text-gray-900">{emp.name}</p>
                          <p className="text-xs text-gray-500">{emp.role}</p>
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ============================================
    // INTEGRATIONS VIEW
    // ============================================
    const IntegrationsView = () => {
      const [searchTerm, setSearchTerm] = useState('');
      const [activeCategory, setActiveCategory] = useState('all');
      const [connectedIntegrations, setConnectedIntegrations] = useState(['quickbooks', 'samsara', 'clockshark', 'dropbox', 'twilio']);

      const integrations = [
        // Financial & Accounting
        { id: 'quickbooks', name: 'QuickBooks Online', category: 'financial', icon: 'calculator', description: 'Sync invoices, expenses, and payroll data automatically', popular: true },
        { id: 'xero', name: 'Xero', category: 'financial', icon: 'coins', description: 'Cloud accounting with real-time financial data' },
        { id: 'stripe', name: 'Stripe', category: 'financial', icon: 'credit-card', description: 'Accept payments and process deposits online' },
        { id: 'square', name: 'Square', category: 'financial', icon: 'square', description: 'Point-of-sale and payment processing' },
        { id: 'expensify', name: 'Expensify', category: 'financial', icon: 'receipt', description: 'Receipt capture and expense report automation' },

        // Fleet & GPS
        { id: 'samsara', name: 'Samsara', category: 'fleet', icon: 'satellite-dish', description: 'Real-time GPS tracking, telematics, and driver safety', popular: true },
        { id: 'verizon-connect', name: 'Verizon Connect', category: 'fleet', icon: 'location-crosshairs', description: 'Fleet tracking and workforce management' },
        { id: 'geotab', name: 'Geotab', category: 'fleet', icon: 'map-pin', description: 'Telematics and fleet optimization platform' },
        { id: 'fleetio', name: 'Fleetio', category: 'fleet', icon: 'truck', description: 'Fleet maintenance and fuel management' },

        // Time & Payroll
        { id: 'clockshark', name: 'ClockShark', category: 'time', icon: 'clock', description: 'GPS time tracking built for field crews', popular: true },
        { id: 'busybusy', name: 'busybusy', category: 'time', icon: 'stopwatch', description: 'Construction time tracking and job costing' },
        { id: 'gusto', name: 'Gusto', category: 'time', icon: 'money-bill-wave', description: 'Full-service payroll, benefits, and HR' },
        { id: 'adp', name: 'ADP', category: 'time', icon: 'building', description: 'Enterprise payroll and workforce management' },
        { id: 'quickbooks-time', name: 'QuickBooks Time', category: 'time', icon: 'user-clock', description: 'Time tracking synced with QuickBooks' },

        // Project & Construction
        { id: 'procore', name: 'Procore', category: 'project', icon: 'helmet-safety', description: 'Industry-leading construction management platform', popular: true },
        { id: 'plangrid', name: 'PlanGrid', category: 'project', icon: 'drafting-compass', description: 'Blueprints, punch lists, and field reports' },
        { id: 'buildertrend', name: 'Buildertrend', category: 'project', icon: 'house-chimney', description: 'Project management and client portal' },
        { id: 'hcss', name: 'HCSS HeavyBid', category: 'project', icon: 'calculator', description: 'Heavy civil estimating and bidding' },

        // Communication
        { id: 'twilio', name: 'Twilio', category: 'communication', icon: 'comment-sms', description: 'SMS alerts for weather, schedules, and emergencies', popular: true },
        { id: 'slack', name: 'Slack', category: 'communication', icon: 'hashtag', description: 'Team messaging and channel-based communication' },
        { id: 'teams', name: 'Microsoft Teams', category: 'communication', icon: 'users', description: 'Chat, meetings, and file collaboration' },
        { id: 'calendly', name: 'Calendly', category: 'communication', icon: 'calendar-check', description: 'Easy scheduling for client meetings' },

        // Documents & Contracts
        { id: 'docusign', name: 'DocuSign', category: 'documents', icon: 'file-signature', description: 'Digital signatures for contracts and change orders', popular: true },
        { id: 'dropbox', name: 'Dropbox', category: 'documents', icon: 'box', description: 'Cloud file storage and sharing' },
        { id: 'google-drive', name: 'Google Drive', category: 'documents', icon: 'google-drive', description: 'Cloud storage with docs, sheets, and slides' },
        { id: 'box', name: 'Box', category: 'documents', icon: 'box-archive', description: 'Secure enterprise content management' },

        // Weather
        { id: 'tomorrow-io', name: 'Tomorrow.io', category: 'weather', icon: 'cloud-sun', description: 'Hyperlocal weather forecasting and alerts' },
        { id: 'openweather', name: 'OpenWeatherMap', category: 'weather', icon: 'temperature-half', description: 'Weather data API for job site conditions' },
        { id: 'dtn', name: 'DTN', category: 'weather', icon: 'cloud-bolt', description: 'Agriculture and construction-grade weather data' },

        // Fuel & Purchasing
        { id: 'wex', name: 'WEX', category: 'fuel', icon: 'gas-pump', description: 'Fleet fuel cards and spend management' },
        { id: 'fleetcor', name: 'Fleetcor', category: 'fuel', icon: 'credit-card', description: 'Fuel cards and workforce payments' },
        { id: 'grainger', name: 'Grainger', category: 'fuel', icon: 'screwdriver-wrench', description: 'Industrial supplies and parts ordering' },

        // Compliance & Safety
        { id: 'safetyculture', name: 'SafetyCulture', category: 'compliance', icon: 'clipboard-check', description: 'Digital inspections and safety checklists' },
        { id: 'isnetworld', name: 'ISNetworld', category: 'compliance', icon: 'shield-halved', description: 'Contractor safety management network' },
        { id: 'avetta', name: 'Avetta', category: 'compliance', icon: 'certificate', description: 'Supply chain risk management' },

        // CRM & Sales
        { id: 'hubspot', name: 'HubSpot', category: 'crm', icon: 'chart-line', description: 'CRM, marketing, and sales automation' },
        { id: 'salesforce', name: 'Salesforce', category: 'crm', icon: 'cloud', description: 'Enterprise CRM and customer platform' },
        { id: 'pipedrive', name: 'Pipedrive', category: 'crm', icon: 'filter', description: 'Sales pipeline and deal tracking' },
      ];

      const categories = [
        { id: 'all', label: 'All Integrations', icon: 'grid-2' },
        { id: 'financial', label: 'Financial', icon: 'landmark' },
        { id: 'fleet', label: 'Fleet & GPS', icon: 'satellite-dish' },
        { id: 'time', label: 'Time & Payroll', icon: 'clock' },
        { id: 'project', label: 'Project Management', icon: 'helmet-safety' },
        { id: 'communication', label: 'Communication', icon: 'comment-sms' },
        { id: 'documents', label: 'Documents', icon: 'file-signature' },
        { id: 'weather', label: 'Weather', icon: 'cloud-sun' },
        { id: 'fuel', label: 'Fuel & Purchasing', icon: 'gas-pump' },
        { id: 'compliance', label: 'Compliance', icon: 'shield-halved' },
        { id: 'crm', label: 'CRM & Sales', icon: 'chart-line' },
      ];

      const filteredIntegrations = integrations.filter(int => {
        const matchesSearch = int.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                              int.description.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesCategory = activeCategory === 'all' || int.category === activeCategory;
        return matchesSearch && matchesCategory;
      });

      const toggleConnection = (id) => {
        setConnectedIntegrations(prev =>
          prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
        );
      };

      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-xl font-bold text-gray-900">Integrations</h2>
              <p className="text-sm text-gray-500">Connect your favorite tools to streamline operations</p>
            </div>
            <div className="flex items-center gap-2">
              <Badge variant="success" className="text-sm">
                <Icon name="plug" className="mr-1" />
                {connectedIntegrations.length} Connected
              </Badge>
            </div>
          </div>

          {/* Search and Stats */}
          <div className="flex items-center gap-4">
            <div className="relative flex-1 max-w-md">
              <Icon name="magnifying-glass" className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
              <input
                type="text"
                placeholder="Search integrations..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
              />
            </div>
          </div>

          <div className="flex gap-6">
            {/* Categories Sidebar */}
            <div className="w-56 flex-shrink-0">
              <Card className="p-2">
                <nav className="space-y-1">
                  {categories.map(cat => (
                    <button
                      key={cat.id}
                      onClick={() => setActiveCategory(cat.id)}
                      className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left text-sm transition-colors ${
                        activeCategory === cat.id
                          ? 'bg-brand-50 text-brand-700 font-medium'
                          : 'text-gray-600 hover:bg-gray-50'
                      }`}
                    >
                      <Icon name={cat.icon} className={activeCategory === cat.id ? 'text-brand-500' : 'text-gray-400'} />
                      {cat.label}
                      <span className={`ml-auto text-xs ${activeCategory === cat.id ? 'text-brand-500' : 'text-gray-400'}`}>
                        {cat.id === 'all' ? integrations.length : integrations.filter(i => i.category === cat.id).length}
                      </span>
                    </button>
                  ))}
                </nav>
              </Card>
            </div>

            {/* Integrations Grid */}
            <div className="flex-1">
              <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                {filteredIntegrations.map(integration => {
                  const isConnected = connectedIntegrations.includes(integration.id);
                  return (
                    <Card key={integration.id} className={`p-4 transition-all ${isConnected ? 'ring-2 ring-green-500 bg-green-50/30' : 'hover:shadow-md'}`}>
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex items-center gap-3">
                          <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${isConnected ? 'bg-green-100' : 'bg-gray-100'}`}>
                            <Icon name={integration.icon} className={`text-xl ${isConnected ? 'text-green-600' : 'text-gray-600'}`} />
                          </div>
                          <div>
                            <div className="flex items-center gap-2">
                              <h4 className="font-semibold text-gray-900">{integration.name}</h4>
                              {integration.popular && (
                                <Badge className="bg-brand-100 text-brand-700 text-xs">Popular</Badge>
                              )}
                            </div>
                            <p className="text-xs text-gray-500 capitalize">{integration.category.replace('-', ' ')}</p>
                          </div>
                        </div>
                      </div>
                      <p className="text-sm text-gray-600 mb-4">{integration.description}</p>
                      <div className="flex items-center justify-between">
                        {isConnected ? (
                          <>
                            <span className="flex items-center gap-1 text-sm text-green-600 font-medium">
                              <Icon name="check-circle" /> Connected
                            </span>
                            <div className="flex gap-2">
                              <Button variant="ghost" size="sm">
                                <Icon name="gear" />
                              </Button>
                              <Button
                                variant="secondary"
                                size="sm"
                                onClick={() => toggleConnection(integration.id)}
                              >
                                Disconnect
                              </Button>
                            </div>
                          </>
                        ) : (
                          <>
                            <span className="text-sm text-gray-400">Not connected</span>
                            <Button
                              variant="brand"
                              size="sm"
                              onClick={() => toggleConnection(integration.id)}
                            >
                              <Icon name="plug" className="mr-1" /> Connect
                            </Button>
                          </>
                        )}
                      </div>
                    </Card>
                  );
                })}
              </div>

              {filteredIntegrations.length === 0 && (
                <Card className="p-12 text-center">
                  <Icon name="plug-circle-xmark" className="text-4xl text-gray-300 mb-4" />
                  <h3 className="text-lg font-medium text-gray-900 mb-2">No integrations found</h3>
                  <p className="text-gray-500">Try adjusting your search or category filter</p>
                </Card>
              )}
            </div>
          </div>

          {/* Integration Requests */}
          <Card className="p-6 bg-gradient-to-r from-gray-50 to-gray-100">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="font-semibold text-gray-900 mb-1">Don't see what you need?</h3>
                <p className="text-sm text-gray-600">We're always adding new integrations. Let us know what tools you'd like to connect.</p>
              </div>
              <Button variant="secondary">
                <Icon name="paper-plane" className="mr-2" /> Request Integration
              </Button>
            </div>
          </Card>
        </div>
      );
    };

    // ============================================
    // MARKETING VIEW - Refined Marketing Co. Partnership
    // ============================================
    const MarketingView = () => {
      const [isConnected, setIsConnected] = useState(false);
      const [activeTab, setActiveTab] = useState('branding');

      // Current Plan Data
      const currentPlan = {
        name: 'Growth Partner',
        price: '$2,500/mo',
        features: ['Full Brand Management', 'Website Design & Hosting', 'Social Media Management', 'SEO & Content Strategy', 'Monthly Analytics Report', 'Dedicated Account Manager'],
        nextBilling: '2026-03-01',
        status: 'active'
      };

      // Branding Kit Assets
      const brandAssets = {
        logos: [
          { id: 1, name: 'Primary Logo (Full Color)', format: 'SVG, PNG, PDF', size: '2.4 MB' },
          { id: 2, name: 'Logo Mark (Icon Only)', format: 'SVG, PNG', size: '856 KB' },
          { id: 3, name: 'White Logo (Dark Backgrounds)', format: 'SVG, PNG, PDF', size: '2.1 MB' },
          { id: 4, name: 'Horizontal Logo', format: 'SVG, PNG', size: '1.8 MB' },
        ],
        colors: [
          { name: 'Primary Orange', hex: '#F97316', rgb: '249, 115, 22' },
          { name: 'Dark Gray', hex: '#151515', rgb: '21, 21, 21' },
          { name: 'Light Gray', hex: '#F3F4F6', rgb: '243, 244, 246' },
          { name: 'Accent Blue', hex: '#3B82F6', rgb: '59, 130, 246' },
        ],
        fonts: [
          { name: 'Inter', usage: 'Headlines & Body', weights: 'Regular, Medium, Bold' },
          { name: 'Roboto Mono', usage: 'Data & Numbers', weights: 'Regular, Medium' },
        ]
      };

      // Creative Assets
      const creativeAssets = [
        { id: 1, name: 'Social Media Templates', type: 'Canva', items: 24, updated: '2026-02-01' },
        { id: 2, name: 'Email Signatures', type: 'HTML', items: 8, updated: '2026-01-15' },
        { id: 3, name: 'Letterhead & Documents', type: 'Word/PDF', items: 6, updated: '2026-01-20' },
        { id: 4, name: 'Business Cards', type: 'Print-Ready', items: 3, updated: '2025-12-10' },
        { id: 5, name: 'Vehicle Wraps', type: 'AI/PDF', items: 4, updated: '2025-11-15' },
        { id: 6, name: 'Trade Show Materials', type: 'Print-Ready', items: 12, updated: '2026-01-28' },
        { id: 7, name: 'Proposal Templates', type: 'PowerPoint', items: 3, updated: '2026-02-03' },
        { id: 8, name: 'Photo Library', type: 'JPG/PNG', items: 156, updated: '2026-02-05' },
      ];

      // Landing Page (Not Connected)
      if (!isConnected) {
        return (
          <div className="min-h-[80vh] flex items-center justify-center">
            <div className="max-w-2xl text-center">
              {/* Partner Logo */}
              <div className="mb-8">
                <div className="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl shadow-lg">
                  <Icon name="palette" className="text-white text-2xl" />
                  <span className="text-2xl font-bold text-white tracking-tight">Refined Marketing Co.</span>
                </div>
              </div>

              {/* Partnership Badge */}
              <div className="inline-flex items-center gap-2 px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium mb-6">
                <Icon name="handshake" />
                Official Marketing Partner
              </div>

              <h1 className="text-4xl font-bold text-gray-900 mb-4">
                We've Partnered with Refined Marketing Co.
              </h1>

              <p className="text-xl text-gray-600 mb-8 leading-relaxed">
                Refined Marketing Co. is a full-service creative agency specializing in construction and heavy equipment industries. They handle everything from brand identity and website design to social media management and lead generationâso you can focus on what you do best: moving dirt.
              </p>

              {/* Services Grid */}
              <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-10">
                {[
                  { icon: 'palette', label: 'Brand Identity' },
                  { icon: 'globe', label: 'Website Design' },
                  { icon: 'hashtag', label: 'Social Media' },
                  { icon: 'magnifying-glass', label: 'SEO Strategy' },
                  { icon: 'camera', label: 'Photography' },
                  { icon: 'bullhorn', label: 'Advertising' },
                ].map((service, i) => (
                  <div key={i} className="flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-200">
                    <div className="p-2 bg-orange-100 rounded-lg">
                      <Icon name={service.icon} className="text-orange-600" />
                    </div>
                    <span className="font-medium text-gray-700">{service.label}</span>
                  </div>
                ))}
              </div>

              {/* CTA Button */}
              <button
                onClick={() => setIsConnected(true)}
                className="inline-flex items-center gap-3 px-8 py-4 bg-dark-900 hover:bg-dark-800 text-white font-semibold rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg"
              >
                <Icon name="rocket" />
                Get Started
                <Icon name="arrow-right" />
              </button>

              <p className="mt-6 text-sm text-gray-500">
                Already a Refined Marketing client? Click above to access your brand assets.
              </p>
            </div>
          </div>
        );
      }

      // Connected Dashboard
      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="p-3 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl">
                <Icon name="palette" className="text-white text-xl" />
              </div>
              <div>
                <h2 className="text-xl font-bold text-gray-900">Refined Marketing Co.</h2>
                <p className="text-sm text-gray-500">Your marketing assets and brand resources</p>
              </div>
            </div>
            <a href="https://refinedmarketingco.com" target="_blank" className="flex items-center gap-2 text-brand-600 hover:text-brand-700 font-medium">
              <Icon name="external-link" /> Visit Refined Marketing
            </a>
          </div>

          {/* Current Plan Card */}
          <Card className="p-6 bg-gradient-to-r from-dark-900 to-dark-800 text-white">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-400 text-sm mb-1">Your Current Plan</p>
                <h3 className="text-2xl font-bold mb-2">{currentPlan.name}</h3>
                <div className="flex items-center gap-4">
                  <span className="text-3xl font-bold text-brand-400">{currentPlan.price}</span>
                  <Badge className="bg-green-500/20 text-green-400 border border-green-500/30">Active</Badge>
                </div>
              </div>
              <div className="text-right">
                <p className="text-gray-400 text-sm mb-2">Plan includes:</p>
                <div className="space-y-1">
                  {currentPlan.features.slice(0, 3).map((feature, i) => (
                    <div key={i} className="flex items-center gap-2 text-sm text-gray-300">
                      <Icon name="check" className="text-green-400" />
                      {feature}
                    </div>
                  ))}
                  <p className="text-gray-500 text-sm">+{currentPlan.features.length - 3} more</p>
                </div>
              </div>
            </div>
            <div className="mt-4 pt-4 border-t border-gray-700 flex items-center justify-between">
              <span className="text-sm text-gray-400">Next billing: {formatDate(currentPlan.nextBilling)}</span>
              <Button variant="secondary" size="sm">Manage Plan</Button>
            </div>
          </Card>

          {/* Tabs */}
          <div className="border-b border-gray-200">
            <nav className="flex gap-6">
              {[
                { id: 'branding', label: 'Branding Kit', icon: 'palette' },
                { id: 'creative', label: 'Creative Assets', icon: 'images' },
                { id: 'video', label: 'Video Production', icon: 'video' },
                { id: 'guidelines', label: 'Brand Guidelines', icon: 'book' },
                { id: 'support', label: 'Support', icon: 'headset' },
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${
                    activeTab === tab.id
                      ? 'border-brand-500 text-brand-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700'
                  }`}
                >
                  <Icon name={tab.icon} />
                  {tab.label}
                </button>
              ))}
            </nav>
          </div>

          {/* Branding Kit Tab */}
          {activeTab === 'branding' && (
            <div className="space-y-6">
              {/* Logos */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="shapes" className="mr-2 text-brand-500" />
                  Logo Files
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {brandAssets.logos.map(logo => (
                    <div key={logo.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                      <div className="flex items-center gap-4">
                        <div className="w-16 h-16 bg-white rounded-lg border border-gray-200 flex items-center justify-center">
                          <Icon name="image" className="text-2xl text-gray-400" />
                        </div>
                        <div>
                          <p className="font-medium text-gray-900">{logo.name}</p>
                          <p className="text-sm text-gray-500">{logo.format} â¢ {logo.size}</p>
                        </div>
                      </div>
                      <Button variant="secondary" size="sm">
                        <Icon name="download" className="mr-1" /> Download
                      </Button>
                    </div>
                  ))}
                </div>
              </Card>

              {/* Colors */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="droplet" className="mr-2 text-brand-500" />
                  Brand Colors
                </h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  {brandAssets.colors.map((color, i) => (
                    <div key={i} className="text-center">
                      <div className="w-full h-24 rounded-lg mb-3 shadow-inner" style={{ backgroundColor: color.hex }}></div>
                      <p className="font-medium text-gray-900">{color.name}</p>
                      <p className="text-sm text-gray-500">{color.hex}</p>
                      <p className="text-xs text-gray-400">RGB: {color.rgb}</p>
                    </div>
                  ))}
                </div>
              </Card>

              {/* Fonts */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="font" className="mr-2 text-brand-500" />
                  Typography
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {brandAssets.fonts.map((font, i) => (
                    <div key={i} className="p-4 bg-gray-50 rounded-lg">
                      <p className="text-2xl font-bold text-gray-900 mb-2" style={{ fontFamily: font.name }}>{font.name}</p>
                      <p className="text-sm text-gray-600">Usage: {font.usage}</p>
                      <p className="text-sm text-gray-500">Weights: {font.weights}</p>
                    </div>
                  ))}
                </div>
              </Card>
            </div>
          )}

          {/* Creative Assets Tab */}
          {activeTab === 'creative' && (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              {creativeAssets.map(asset => (
                <Card key={asset.id} className="p-4 hover:shadow-lg transition-shadow cursor-pointer">
                  <div className="w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center mb-4">
                    <Icon name={
                      asset.type.includes('Canva') ? 'pen-ruler' :
                      asset.type.includes('HTML') ? 'code' :
                      asset.type.includes('Word') ? 'file-word' :
                      asset.type.includes('Print') ? 'print' :
                      asset.type.includes('AI') ? 'bezier-curve' :
                      asset.type.includes('PowerPoint') ? 'file-powerpoint' :
                      'images'
                    } className="text-brand-600 text-xl" />
                  </div>
                  <h4 className="font-semibold text-gray-900 mb-1">{asset.name}</h4>
                  <p className="text-sm text-gray-500 mb-3">{asset.type} â¢ {asset.items} items</p>
                  <div className="flex items-center justify-between">
                    <span className="text-xs text-gray-400">Updated {formatDate(asset.updated)}</span>
                    <Button variant="ghost" size="sm"><Icon name="folder-open" /></Button>
                  </div>
                </Card>
              ))}
            </div>
          )}

          {/* Video Production Tab */}
          {activeTab === 'video' && (
            <div className="space-y-6">
              {/* Video Services Overview */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {[
                  { icon: 'helicopter', label: 'Drone Footage', desc: 'Aerial shots of job sites and completed projects', color: 'blue' },
                  { icon: 'video', label: 'Project Videos', desc: 'Time-lapses, before/after, and progress updates', color: 'brand' },
                  { icon: 'microphone', label: 'Testimonials', desc: 'Professional client testimonial videos', color: 'green' },
                ].map((service, i) => (
                  <Card key={i} className="p-5">
                    <div className={`w-12 h-12 bg-${service.color}-100 rounded-xl flex items-center justify-center mb-3`}>
                      <Icon name={service.icon} className={`text-${service.color}-600 text-xl`} />
                    </div>
                    <h4 className="font-semibold text-gray-900 mb-1">{service.label}</h4>
                    <p className="text-sm text-gray-500">{service.desc}</p>
                  </Card>
                ))}
              </div>

              {/* Video Library */}
              <Card className="p-4">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-semibold text-gray-900">
                    <Icon name="film" className="mr-2 text-brand-500" />
                    Your Video Library
                  </h3>
                  <Button variant="brand" size="sm">
                    <Icon name="plus" className="mr-1" /> Request New Video
                  </Button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {[
                    { id: 1, title: 'Highway 42 Project Time-lapse', type: 'Project Video', duration: '2:34', date: '2026-01-28', status: 'Ready', thumbnail: 'road' },
                    { id: 2, title: 'Aerial Site Survey - Commercial Park', type: 'Drone Footage', duration: '4:12', date: '2026-01-15', status: 'Ready', thumbnail: 'building' },
                    { id: 3, title: 'Smith Residence Testimonial', type: 'Testimonial', duration: '1:45', date: '2026-01-20', status: 'Ready', thumbnail: 'user' },
                    { id: 4, title: 'Equipment Fleet Overview', type: 'Company Video', duration: '3:22', date: '2025-12-10', status: 'Ready', thumbnail: 'truck' },
                    { id: 5, title: 'Downtown Excavation Progress', type: 'Project Video', duration: '0:00', date: '2026-02-05', status: 'In Production', thumbnail: 'hard-hat' },
                    { id: 6, title: 'Safety Training Recap', type: 'Internal', duration: '5:30', date: '2025-11-20', status: 'Ready', thumbnail: 'shield' },
                  ].map(video => (
                    <div key={video.id} className="bg-gray-50 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                      <div className="aspect-video bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center relative">
                        <Icon name={video.thumbnail} className="text-gray-500 text-4xl" />
                        {video.status === 'Ready' && (
                          <div className="absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity cursor-pointer">
                            <div className="w-14 h-14 bg-white/90 rounded-full flex items-center justify-center">
                              <Icon name="play" className="text-gray-900 text-xl ml-1" />
                            </div>
                          </div>
                        )}
                        {video.status === 'In Production' && (
                          <div className="absolute top-2 right-2">
                            <Badge className="bg-yellow-500 text-white">In Production</Badge>
                          </div>
                        )}
                        {video.duration !== '0:00' && (
                          <span className="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">{video.duration}</span>
                        )}
                      </div>
                      <div className="p-3">
                        <h4 className="font-medium text-gray-900 text-sm mb-1 truncate">{video.title}</h4>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">{video.type}</span>
                          <span className="text-xs text-gray-400">{formatDate(video.date)}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </Card>

              {/* Upcoming Shoots */}
              <Card className="p-4">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="calendar-days" className="mr-2 text-brand-500" />
                  Upcoming Video Shoots
                </h3>
                <div className="space-y-3">
                  {[
                    { date: '2026-02-12', title: 'Industrial Park Drone Shoot', location: '4500 Commerce Dr', crew: 'Refined Video Team' },
                    { date: '2026-02-18', title: 'Client Testimonial Recording', location: 'Office / Remote', crew: 'Jordan M.' },
                    { date: '2026-02-25', title: 'Spring Equipment Showcase', location: 'Equipment Yard', crew: 'Refined Video Team' },
                  ].map((shoot, i) => (
                    <div key={i} className="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">
                      <div className="text-center min-w-[60px]">
                        <p className="text-xs text-gray-500 uppercase">{new Date(shoot.date).toLocaleDateString('en-US', { month: 'short' })}</p>
                        <p className="text-2xl font-bold text-gray-900">{new Date(shoot.date).getDate()}</p>
                      </div>
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">{shoot.title}</p>
                        <p className="text-sm text-gray-500">
                          <Icon name="location-dot" className="mr-1" />{shoot.location}
                          <span className="mx-2">â¢</span>
                          <Icon name="user" className="mr-1" />{shoot.crew}
                        </p>
                      </div>
                      <Button variant="secondary" size="sm">Details</Button>
                    </div>
                  ))}
                </div>
              </Card>
            </div>
          )}

          {/* Brand Guidelines Tab */}
          {activeTab === 'guidelines' && (
            <Card className="p-8 text-center">
              <div className="w-20 h-20 bg-brand-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <Icon name="book-open" className="text-brand-600 text-3xl" />
              </div>
              <h3 className="text-xl font-bold text-gray-900 mb-2">Brand Guidelines Document</h3>
              <p className="text-gray-600 mb-6 max-w-md mx-auto">
                Your complete brand guidelines including logo usage, color specifications, typography rules, and brand voice.
              </p>
              <Button variant="brand" size="lg">
                <Icon name="download" className="mr-2" /> Download Brand Guidelines (PDF)
              </Button>
            </Card>
          )}

          {/* Support Tab */}
          {activeTab === 'support' && (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <Card className="p-6">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="user-tie" className="mr-2 text-brand-500" />
                  Your Account Manager
                </h3>
                <div className="flex items-center gap-4 mb-4">
                  <div className="w-16 h-16 bg-brand-500 rounded-full flex items-center justify-center text-white text-xl font-bold">
                    JM
                  </div>
                  <div>
                    <p className="font-semibold text-gray-900">Jordan Mitchell</p>
                    <p className="text-sm text-gray-500">Senior Account Manager</p>
                    <p className="text-sm text-brand-600">jordan@refinedmarketingco.com</p>
                  </div>
                </div>
                <div className="flex gap-2">
                  <Button variant="secondary" className="flex-1"><Icon name="envelope" className="mr-2" />Email</Button>
                  <Button variant="secondary" className="flex-1"><Icon name="calendar" className="mr-2" />Schedule Call</Button>
                </div>
              </Card>

              <Card className="p-6">
                <h3 className="font-semibold text-gray-900 mb-4">
                  <Icon name="circle-question" className="mr-2 text-brand-500" />
                  Need Help?
                </h3>
                <div className="space-y-3">
                  <a href="#" className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <Icon name="message" className="text-brand-500" />
                    <span className="text-sm font-medium text-gray-700">Request a Design Update</span>
                    <Icon name="arrow-right" className="ml-auto text-gray-400" />
                  </a>
                  <a href="#" className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <Icon name="lightbulb" className="text-brand-500" />
                    <span className="text-sm font-medium text-gray-700">Submit a Creative Request</span>
                    <Icon name="arrow-right" className="ml-auto text-gray-400" />
                  </a>
                  <a href="#" className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <Icon name="chart-line" className="text-brand-500" />
                    <span className="text-sm font-medium text-gray-700">View Monthly Report</span>
                    <Icon name="arrow-right" className="ml-auto text-gray-400" />
                  </a>
                </div>
              </Card>
            </div>
          )}
        </div>
      );
    };

    // ============================================
    // MODALS
    // ============================================

    const QuickActionsModal = ({ isOpen, onClose, setShowModal }) => (
      <Modal isOpen={isOpen} onClose={onClose} title="Quick Actions" size="sm">
        <div className="grid grid-cols-2 gap-3">
          {[
            { icon: 'clock', label: 'Time Clock', action: 'time-clock', color: 'blue' },
            { icon: 'clipboard-check', label: 'Equipment Check-In', action: 'equipment-checkin', color: 'green' },
            { icon: 'file-lines', label: 'Daily Report', action: 'daily-report', color: 'brand' },
            { icon: 'wrench', label: 'Work Order', action: 'work-order', color: 'yellow' },
            { icon: 'shield-halved', label: 'Safety Sign-Off', action: 'safety', color: 'red' },
            { icon: 'camera', label: 'Photo Upload', action: 'photo', color: 'purple' },
          ].map(item => (
            <button
              key={item.action}
              onClick={() => { onClose(); setShowModal({ type: item.action }); }}
              className="flex flex-col items-center gap-2 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors"
            >
              <div className={`p-3 rounded-full bg-${item.color}-100`}>
                <Icon name={item.icon} className={`text-${item.color}-600 text-lg`} />
              </div>
              <span className="text-sm font-medium text-gray-700">{item.label}</span>
            </button>
          ))}
        </div>
      </Modal>
    );

    const TimeClockModal = ({ isOpen, onClose, employees, jobs, setTimeEntries }) => {
      const [selectedEmployee, setSelectedEmployee] = useState('');
      const [selectedJob, setSelectedJob] = useState('');
      const [action, setAction] = useState('in');
      const [notes, setNotes] = useState('');

      const handleSubmit = () => {
        if (!selectedEmployee || !selectedJob) return;
        setTimeEntries(prev => [...prev, {
          id: Date.now(),
          employeeId: Number(selectedEmployee),
          jobId: Number(selectedJob),
          action,
          time: new Date().toISOString(),
          notes,
        }]);
        onClose();
      };

      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Time Clock" size="md">
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Employee</label>
              <select value={selectedEmployee} onChange={(e) => setSelectedEmployee(e.target.value)} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Employee</option>
                {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name} - {emp.role}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Job Site</label>
              <select value={selectedJob} onChange={(e) => setSelectedJob(e.target.value)} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Job</option>
                {jobs.filter(j => j.status === 'active').map(job => <option key={job.id} value={job.id}>{job.name}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Action</label>
              <div className="flex gap-4">
                <label className="flex items-center gap-2">
                  <input type="radio" name="action" value="in" checked={action === 'in'} onChange={(e) => setAction(e.target.value)} className="text-brand-500" />
                  <span>Clock In</span>
                </label>
                <label className="flex items-center gap-2">
                  <input type="radio" name="action" value="out" checked={action === 'out'} onChange={(e) => setAction(e.target.value)} className="text-brand-500" />
                  <span>Clock Out</span>
                </label>
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
              <textarea value={notes} onChange={(e) => setNotes(e.target.value)} rows={2} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Optional notes..." />
            </div>
            <div className="p-3 bg-gray-50 rounded-lg text-sm">
              <p><strong>Time:</strong> {formatTime(new Date())}</p>
              <p><strong>Location:</strong> GPS coordinates will be captured</p>
            </div>
            <div className="flex justify-end gap-3">
              <Button variant="secondary" onClick={onClose}>Cancel</Button>
              <Button variant="brand" onClick={handleSubmit}>Submit</Button>
            </div>
          </div>
        </Modal>
      );
    };

    const EquipmentCheckInModal = ({ isOpen, onClose, equipment, setEquipment, employees, jobs }) => {
      const [form, setForm] = useState({ equipmentId: '', jobId: '', hoursWorked: '', meterReading: '', fuelLevel: '', condition: 'good', operator: '', notes: '' });

      const handleSubmit = () => {
        if (!form.equipmentId) return;
        setEquipment(prev => prev.map(eq =>
          eq.id === Number(form.equipmentId)
            ? { ...eq, hours: Number(form.meterReading) || eq.hours, fuelLevel: Number(form.fuelLevel) || eq.fuelLevel, jobId: Number(form.jobId) || eq.jobId }
            : eq
        ));
        onClose();
      };

      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Equipment Check-In" size="md">
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Equipment</label>
              <select value={form.equipmentId} onChange={(e) => setForm({ ...form, equipmentId: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Equipment</option>
                {equipment.map(eq => <option key={eq.id} value={eq.id}>{eq.name}</option>)}
              </select>
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Job Site</label>
                <select value={form.jobId} onChange={(e) => setForm({ ...form, jobId: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="">Select Job</option>
                  {jobs.filter(j => j.status === 'active').map(job => <option key={job.id} value={job.id}>{job.name}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Operator</label>
                <select value={form.operator} onChange={(e) => setForm({ ...form, operator: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="">Select Operator</option>
                  {employees.filter(e => e.role === 'Equipment Operator').map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                </select>
              </div>
            </div>
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Hours Worked</label>
                <input type="number" value={form.hoursWorked} onChange={(e) => setForm({ ...form, hoursWorked: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="8" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Meter Reading</label>
                <input type="number" value={form.meterReading} onChange={(e) => setForm({ ...form, meterReading: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="4521" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Fuel Level %</label>
                <input type="number" value={form.fuelLevel} onChange={(e) => setForm({ ...form, fuelLevel: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="75" />
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Condition</label>
              <div className="flex gap-4">
                {['good', 'fair', 'needs_attention'].map(c => (
                  <label key={c} className="flex items-center gap-2">
                    <input type="radio" name="condition" value={c} checked={form.condition === c} onChange={(e) => setForm({ ...form, condition: e.target.value })} />
                    <span className="capitalize">{c.replace('_', ' ')}</span>
                  </label>
                ))}
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Notes / Issues</label>
              <textarea value={form.notes} onChange={(e) => setForm({ ...form, notes: e.target.value })} rows={2} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Any issues or notes..." />
            </div>
            <div className="flex justify-end gap-3">
              <Button variant="secondary" onClick={onClose}>Cancel</Button>
              <Button variant="brand" onClick={handleSubmit}>Submit Check-In</Button>
            </div>
          </div>
        </Modal>
      );
    };

    const DailyReportModal = ({ isOpen, onClose, jobs, employees, dailyReports, setDailyReports }) => {
      const [form, setForm] = useState({ jobId: '', weather: '', tempHigh: '', tempLow: '', crewSize: '', workAccomplished: '', issues: '', tomorrowPlan: '' });
      const [materials, setMaterials] = useState([{ item: '', qty: '', unit: 'CY' }]);

      const handleSubmit = () => {
        setDailyReports(prev => [...prev, {
          id: Date.now(),
          ...form,
          jobId: Number(form.jobId),
          date: new Date().toISOString().split('T')[0],
          submittedBy: 1,
          materialsUsed: materials.filter(m => m.item),
        }]);
        onClose();
      };

      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Daily Report" size="lg">
          <div className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Job Site</label>
                <select value={form.jobId} onChange={(e) => setForm({ ...form, jobId: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="">Select Job</option>
                  {jobs.filter(j => j.status === 'active').map(job => <option key={job.id} value={job.id}>{job.name}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Crew Size</label>
                <input type="number" value={form.crewSize} onChange={(e) => setForm({ ...form, crewSize: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" />
              </div>
            </div>
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Weather</label>
                <select value={form.weather} onChange={(e) => setForm({ ...form, weather: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="">Select</option>
                  {['Sunny', 'Partly Cloudy', 'Cloudy', 'Rain', 'Snow'].map(w => <option key={w} value={w}>{w}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">High Temp Â°F</label>
                <input type="number" value={form.tempHigh} onChange={(e) => setForm({ ...form, tempHigh: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Low Temp Â°F</label>
                <input type="number" value={form.tempLow} onChange={(e) => setForm({ ...form, tempLow: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" />
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Work Accomplished</label>
              <textarea value={form.workAccomplished} onChange={(e) => setForm({ ...form, workAccomplished: e.target.value })} rows={3} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Describe work completed today..." />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Materials Used</label>
              {materials.map((m, i) => (
                <div key={i} className="flex gap-2 mb-2">
                  <input type="text" value={m.item} onChange={(e) => setMaterials(prev => prev.map((p, j) => j === i ? { ...p, item: e.target.value } : p))} placeholder="Material" className="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm" />
                  <input type="number" value={m.qty} onChange={(e) => setMaterials(prev => prev.map((p, j) => j === i ? { ...p, qty: e.target.value } : p))} placeholder="Qty" className="w-20 border border-gray-300 rounded-lg px-3 py-2 text-sm" />
                  <select value={m.unit} onChange={(e) => setMaterials(prev => prev.map((p, j) => j === i ? { ...p, unit: e.target.value } : p))} className="w-20 border border-gray-300 rounded-lg px-2 py-2 text-sm">
                    {['CY', 'TN', 'LF', 'EA', 'GAL', 'SF'].map(u => <option key={u} value={u}>{u}</option>)}
                  </select>
                </div>
              ))}
              <Button variant="ghost" size="sm" onClick={() => setMaterials(prev => [...prev, { item: '', qty: '', unit: 'CY' }])}>
                <Icon name="plus" className="mr-1" /> Add Material
              </Button>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Issues / Delays</label>
              <textarea value={form.issues} onChange={(e) => setForm({ ...form, issues: e.target.value })} rows={2} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Any issues or delays encountered..." />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Tomorrow's Plan</label>
              <textarea value={form.tomorrowPlan} onChange={(e) => setForm({ ...form, tomorrowPlan: e.target.value })} rows={2} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Planned work for tomorrow..." />
            </div>
            <div className="flex justify-end gap-3">
              <Button variant="secondary" onClick={onClose}>Cancel</Button>
              <Button variant="brand" onClick={handleSubmit}>Submit Report</Button>
            </div>
          </div>
        </Modal>
      );
    };

    const WorkOrderModal = ({ isOpen, onClose, equipment, employees, workOrders, setWorkOrders, data }) => {
      const [form, setForm] = useState({
        equipmentId: data?.equipmentId || '',
        type: data?.type || 'repair',
        priority: 'medium',
        title: '',
        description: '',
        assignedTo: '',
        dueDate: '',
      });

      const handleSubmit = () => {
        setWorkOrders(prev => [...prev, {
          id: Date.now(),
          ...form,
          equipmentId: Number(form.equipmentId),
          assignedTo: Number(form.assignedTo),
          status: 'scheduled',
          createdAt: new Date().toISOString().split('T')[0],
          parts: [],
          laborHours: 0,
        }]);
        onClose();
      };

      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Create Work Order" size="md">
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Equipment</label>
              <select value={form.equipmentId} onChange={(e) => setForm({ ...form, equipmentId: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Equipment</option>
                {equipment.map(eq => <option key={eq.id} value={eq.id}>{eq.name}</option>)}
              </select>
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                <select value={form.type} onChange={(e) => setForm({ ...form, type: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="repair">Repair</option>
                  <option value="preventive">Preventive Maintenance</option>
                  <option value="inspection">Inspection</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                <select value={form.priority} onChange={(e) => setForm({ ...form, priority: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Title</label>
              <input type="text" value={form.title} onChange={(e) => setForm({ ...form, title: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Brief description of the issue..." />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea value={form.description} onChange={(e) => setForm({ ...form, description: e.target.value })} rows={3} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Detailed description..." />
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Assign To</label>
                <select value={form.assignedTo} onChange={(e) => setForm({ ...form, assignedTo: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                  <option value="">Select Technician</option>
                  {employees.filter(e => e.role === 'Mechanic').map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                <input type="date" value={form.dueDate} onChange={(e) => setForm({ ...form, dueDate: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2" />
              </div>
            </div>
            <div className="flex justify-end gap-3">
              <Button variant="secondary" onClick={onClose}>Cancel</Button>
              <Button variant="brand" onClick={handleSubmit}>Create Work Order</Button>
            </div>
          </div>
        </Modal>
      );
    };

    const SafetyModal = ({ isOpen, onClose, employees, jobs }) => {
      const [form, setForm] = useState({ type: 'toolbox', topic: '', jobId: '', notes: '' });
      const [attendees, setAttendees] = useState([]);

      const topics = {
        toolbox: ['Excavation Safety', 'Fall Protection', 'Heat Illness Prevention', 'Electrical Safety', 'PPE Requirements', 'Housekeeping'],
        preop: ['Excavator Inspection', 'Dozer Inspection', 'Loader Inspection', 'Truck Inspection'],
        jsa: ['Trench Work', 'Overhead Utilities', 'Confined Space', 'Heavy Lifting', 'Working Near Traffic'],
      };

      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Safety Sign-Off" size="md">
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Type</label>
              <div className="flex gap-4">
                {[{ id: 'toolbox', label: 'Toolbox Talk' }, { id: 'preop', label: 'Pre-Op Inspection' }, { id: 'jsa', label: 'JSA' }].map(t => (
                  <label key={t.id} className="flex items-center gap-2">
                    <input type="radio" name="type" value={t.id} checked={form.type === t.id} onChange={(e) => setForm({ ...form, type: e.target.value, topic: '' })} />
                    <span>{t.label}</span>
                  </label>
                ))}
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Topic</label>
              <select value={form.topic} onChange={(e) => setForm({ ...form, topic: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Topic</option>
                {topics[form.type]?.map(t => <option key={t} value={t}>{t}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Job Site</label>
              <select value={form.jobId} onChange={(e) => setForm({ ...form, jobId: e.target.value })} className="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">Select Job</option>
                {jobs.filter(j => j.status === 'active').map(job => <option key={job.id} value={job.id}>{job.name}</option>)}
              </select>
            </div>
            {form.type !== 'preop' && (
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Attendees</label>
                <div className="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-2 border border-gray-200 rounded-lg">
                  {employees.filter(e => e.status === 'clocked-in').map(emp => (
                    <label key={emp.id} className="flex items-center gap-2 text-sm">
                      <input type="checkbox" checked={attendees.includes(emp.id)} onChange={(e) => {
                        if (e.target.checked) setAttendees(prev => [...prev, emp.id]);
                        else setAttendees(prev => prev.filter(id => id !== emp.id));
                      }} />
                      {emp.name}
                    </label>
                  ))}
                </div>
              </div>
            )}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
              <textarea value={form.notes} onChange={(e) => setForm({ ...form, notes: e.target.value })} rows={2} className="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Additional notes..." />
            </div>
            <div className="flex justify-end gap-3">
              <Button variant="secondary" onClick={onClose}>Cancel</Button>
              <Button variant="brand" onClick={onClose}>Submit Sign-Off</Button>
            </div>
          </div>
        </Modal>
      );
    };

    // ============================================
    // LANDING PAGE
    // ============================================
    const LandingPage = ({ onLogin, onSignup }) => {
      const [showAuthModal, setShowAuthModal] = useState(false);
      const [authMode, setAuthMode] = useState('login');
      const [formData, setFormData] = useState({ name: '', email: '', password: '', company: '' });

      // =====================================================
      // IMAGE CONFIGURATION - UPDATE THESE WITH YOUR PHOTOS
      // =====================================================
      // Upload your photos to GitHub, Imgur, or your server
      // Then replace these placeholder URLs with your actual URLs
      const IMAGES = {
        // Hero background - Volvo excavator on dirt mound
        hero: 'YOUR_HERO_IMAGE_URL',
        // CTA section background
        ctaBg: 'YOUR_CTA_BG_URL',
        // Gallery images (8 total)
        gallery: [
          'YOUR_GALLERY_IMAGE_1_URL', // Large - Volvo EC220D on mound
          'YOUR_GALLERY_IMAGE_2_URL', // Aerial trenching shot
          'YOUR_GALLERY_IMAGE_3_URL', // CAT D6M dozer
          'YOUR_GALLERY_IMAGE_4_URL', // Operator in cab
          'YOUR_GALLERY_IMAGE_5_URL', // Wheel loader
          'YOUR_GALLERY_IMAGE_6_URL', // Large - Excavator
          'YOUR_GALLERY_IMAGE_7_URL', // Dozer on pile
          'YOUR_GALLERY_IMAGE_8_URL', // Dozer in woods
        ],
      };

      const features = [
        { icon: 'grid-2', title: 'Unified Dashboard', desc: 'Real-time overview of all operations, jobs, and equipment in one place.' },
        { icon: 'truck-field', title: 'Fleet Management', desc: 'Track equipment location, hours, maintenance schedules, and utilization.' },
        { icon: 'calendar-week', title: 'Smart Scheduling', desc: 'Drag-and-drop crew and equipment scheduling with conflict detection.' },
        { icon: 'comments', title: 'Team Messaging', desc: 'Built-in communication with channels, DMs, and file sharing.' },
        { icon: 'money-check-dollar', title: 'Job Costing', desc: 'Track costs, budgets, and profitability for every project in real-time.' },
        { icon: 'shield-heart', title: 'Safety & Compliance', desc: 'Digital safety sign-offs, incident tracking, and certification management.' },
        { icon: 'chart-mixed', title: 'Advanced Reports', desc: 'Generate insights on productivity, costs, and equipment performance.' },
        { icon: 'plug', title: '40+ Integrations', desc: 'Connect QuickBooks, Samsara, Procore, and all your favorite tools.' },
      ];

      const testimonials = [
        { name: 'Marcus Johnson', role: 'Owner, Johnson Excavating', quote: 'Groundwork Pro cut our admin time in half. The scheduling alone saves us 10 hours a week.', avatar: 'MJ' },
        { name: 'Sarah Williams', role: 'Operations Manager, Williams Grading', quote: 'Finally, software built for excavation. The equipment tracking and job costing features are game-changers.', avatar: 'SW' },
        { name: 'Robert Chen', role: 'CEO, Pacific Earthworks', quote: 'We went from spreadsheets to Groundwork Pro and never looked back. ROI in the first month.', avatar: 'RC' },
      ];

      const plans = [
        { name: 'Starter', price: 49, period: '/user/mo', desc: 'For small crews getting started', features: ['All core features', 'Basic scheduling', 'Equipment tracking', 'Mobile app access', 'Email support'], cta: 'Start Free Trial' },
        { name: 'Professional', price: 79, period: '/user/mo', desc: 'For growing excavation companies', features: ['Everything in Starter', 'Advanced scheduling', 'Job costing & budgets', 'Team messaging', 'Integrations', 'Priority support'], cta: 'Start Free Trial', popular: true },
        { name: 'Enterprise', price: 'Custom', period: '', desc: 'For large operations', features: ['Everything in Pro', 'Custom integrations', 'Dedicated account manager', 'On-site training', 'SLA guarantee', 'API access'], cta: 'Contact Sales' },
      ];

      const handleSubmit = (e) => {
        e.preventDefault();
        if (authMode === 'login') {
          onLogin(formData);
        } else {
          onSignup(formData);
        }
      };

      return (
        <div className="min-h-screen bg-white">
          {/* Navigation */}
          <nav className="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md z-50 border-b border-gray-100">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-brand-500 rounded-lg flex items-center justify-center">
                    <Icon name="mountain" className="text-white text-lg" />
                  </div>
                  <div>
                    <span className="font-dozer text-2xl text-gray-900 tracking-wide">GROUNDWORK</span>
                    <span className="text-brand-500 font-dozer text-2xl tracking-wide">PRO</span>
                  </div>
                </div>
                <div className="hidden md:flex items-center gap-8">
                  <a href="#features" className="text-gray-600 hover:text-gray-900 font-medium">Features</a>
                  <a href="#pricing" className="text-gray-600 hover:text-gray-900 font-medium">Pricing</a>
                  <a href="#testimonials" className="text-gray-600 hover:text-gray-900 font-medium">Testimonials</a>
                </div>
                <div className="flex items-center gap-3">
                  <button
                    onClick={() => { setAuthMode('login'); setShowAuthModal(true); }}
                    className="px-4 py-2 text-gray-700 font-medium hover:text-gray-900"
                  >
                    Log In
                  </button>
                  <button
                    onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                    className="px-5 py-2.5 bg-brand-500 text-white font-medium rounded-lg hover:bg-brand-600 transition-colors"
                  >
                    Start Free Trial
                  </button>
                </div>
              </div>
            </div>
          </nav>

          {/* Hero Section */}
          <section className="pt-32 pb-20 px-6 relative overflow-hidden">
            {/* Background Image */}
            <div className="absolute inset-0 z-0">
              {IMAGES.hero !== 'YOUR_HERO_IMAGE_URL' ? (
                <img src={IMAGES.hero} alt="Excavator at work" className="w-full h-full object-cover" />
              ) : (
                <div className="w-full h-full bg-gradient-to-br from-brand-100 to-brand-200 flex items-center justify-center">
                  <div className="text-center text-brand-400">
                    <Icon name="image" className="text-6xl mb-2" />
                    <p className="text-sm font-medium">Hero Image - Update IMAGES.hero</p>
                  </div>
                </div>
              )}
              <div className="absolute inset-0 bg-gradient-to-r from-white via-white/95 to-white/80"></div>
            </div>

            <div className="max-w-7xl mx-auto relative z-10">
              <div className="max-w-2xl">
                <div className="inline-flex items-center gap-2 px-4 py-2 bg-brand-50 text-brand-700 rounded-full text-sm font-medium mb-6">
                  <Icon name="sparkles" />
                  The #1 Platform for Excavation Companies
                </div>
                <h1 className="text-5xl md:text-6xl font-bold text-gray-900 mb-6 leading-tight">
                  Run Your Excavation Business
                  <span className="text-brand-500"> Like a Pro</span>
                </h1>
                <p className="text-xl text-gray-600 mb-10 leading-relaxed">
                  Manage crews, track equipment, schedule jobs, and control costsâall from one powerful platform built specifically for excavation and grading contractors.
                </p>
                <div className="flex flex-col sm:flex-row items-start gap-4">
                  <button
                    onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                    className="px-8 py-4 bg-brand-500 text-white font-semibold rounded-xl hover:bg-brand-600 transition-all transform hover:scale-105 shadow-lg shadow-brand-500/30 flex items-center gap-2"
                  >
                    Start Free Trial
                    <Icon name="arrow-right" />
                  </button>
                  <button className="px-8 py-4 bg-white text-gray-700 font-semibold rounded-xl border border-gray-200 hover:bg-gray-50 transition-colors flex items-center gap-2 shadow-sm">
                    <Icon name="play-circle" />
                    Watch Demo
                  </button>
                </div>
                <p className="mt-6 text-sm text-gray-500">14-day free trial. No credit card required.</p>

                {/* Trust badges */}
                <div className="flex items-center gap-6 mt-10 pt-10 border-t border-gray-200">
                  <div className="flex items-center gap-2">
                    <Icon name="shield-check" className="text-green-500" />
                    <span className="text-sm text-gray-600">SOC 2 Compliant</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Icon name="lock" className="text-green-500" />
                    <span className="text-sm text-gray-600">256-bit Encryption</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Icon name="clock" className="text-green-500" />
                    <span className="text-sm text-gray-600">99.9% Uptime</span>
                  </div>
                </div>
              </div>

              {/* Dashboard Preview - Working Mini Dashboard */}
              <div className="mt-16 relative">
                <div className="absolute inset-0 bg-gradient-to-t from-white via-transparent to-transparent z-10 pointer-events-none" style={{height: '120%'}}></div>
                <div className="bg-dark-900 rounded-2xl p-2 shadow-2xl">
                  <div className="bg-gray-50 rounded-xl overflow-hidden">
                    {/* Browser Chrome */}
                    <div className="bg-dark-800 px-4 py-2 flex items-center gap-2">
                      <div className="flex gap-1.5">
                        <div className="w-3 h-3 rounded-full bg-red-500"></div>
                        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                      </div>
                      <div className="flex-1 text-center">
                        <span className="text-xs text-gray-400">app.groundworkpro.com/dashboard</span>
                      </div>
                    </div>
                    {/* Mini Dashboard */}
                    <div className="flex h-[500px]">
                      {/* Sidebar */}
                      <div className="w-48 bg-dark-900 p-3 flex-shrink-0">
                        <div className="flex items-center gap-2 mb-6">
                          <div className="w-8 h-8 bg-brand-500 rounded-lg flex items-center justify-center">
                            <Icon name="mountain" className="text-white text-sm" />
                          </div>
                          <span className="text-white font-dozer text-sm tracking-wide">GROUNDWORK</span>
                        </div>
                        {['Dashboard', 'Messages', 'Schedule', 'Jobs', 'Fleet', 'Team'].map((item, i) => (
                          <div key={i} className={`flex items-center gap-2 px-2 py-2 rounded text-xs mb-1 ${i === 0 ? 'bg-brand-500 text-white' : 'text-gray-400'}`}>
                            <Icon name={['grid-2', 'comments', 'calendar-week', 'briefcase', 'truck-field', 'people-group'][i]} />
                            <span>{item}</span>
                          </div>
                        ))}
                      </div>
                      {/* Main Content */}
                      <div className="flex-1 p-4 overflow-hidden">
                        {/* Header */}
                        <div className="flex items-center justify-between mb-4">
                          <div>
                            <h3 className="font-semibold text-gray-900 text-sm">Dashboard</h3>
                            <p className="text-xs text-gray-500">Friday, February 6, 2026</p>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-6 h-6 bg-gray-100 rounded flex items-center justify-center">
                              <Icon name="bell" className="text-gray-400 text-xs" />
                            </div>
                            <div className="w-6 h-6 bg-brand-500 rounded-full"></div>
                          </div>
                        </div>
                        {/* Stats */}
                        <div className="grid grid-cols-4 gap-3 mb-4">
                          {[
                            { label: 'Active Jobs', value: '8', icon: 'briefcase', color: 'brand' },
                            { label: 'Fleet Utilization', value: '87%', icon: 'truck-field', color: 'green' },
                            { label: 'Crew On-Site', value: '24', icon: 'users', color: 'blue' },
                            { label: 'Month Revenue', value: '$847K', icon: 'dollar-sign', color: 'green' },
                          ].map((stat, i) => (
                            <div key={i} className="bg-white rounded-lg p-3 border border-gray-200">
                              <div className="flex items-center justify-between mb-1">
                                <Icon name={stat.icon} className={`text-${stat.color}-500 text-xs`} />
                              </div>
                              <p className="text-lg font-bold text-gray-900">{stat.value}</p>
                              <p className="text-xs text-gray-500">{stat.label}</p>
                            </div>
                          ))}
                        </div>
                        {/* Content Grid */}
                        <div className="grid grid-cols-3 gap-3">
                          {/* Jobs List */}
                          <div className="col-span-2 bg-white rounded-lg border border-gray-200 p-3">
                            <h4 className="font-medium text-gray-900 text-xs mb-3">Active Jobs</h4>
                            {['Highway 42 Expansion', 'Riverside Commercial', 'Oak Hills Subdivision'].map((job, i) => (
                              <div key={i} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                                <div>
                                  <p className="text-xs font-medium text-gray-900">{job}</p>
                                  <p className="text-xs text-gray-400">Progress: {[65, 42, 28][i]}%</p>
                                </div>
                                <div className="w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                  <div className="h-full bg-brand-500 rounded-full" style={{width: `${[65, 42, 28][i]}%`}}></div>
                                </div>
                              </div>
                            ))}
                          </div>
                          {/* Weather */}
                          <div className="bg-white rounded-lg border border-gray-200 p-3">
                            <h4 className="font-medium text-gray-900 text-xs mb-2">Weather</h4>
                            <div className="text-center">
                              <Icon name="sun" className="text-yellow-500 text-2xl mb-1" />
                              <p className="text-xl font-bold text-gray-900">47Â°F</p>
                              <p className="text-xs text-gray-500">Partly Cloudy</p>
                            </div>
                            <div className="grid grid-cols-3 gap-1 mt-3">
                              {['Sat', 'Sun', 'Mon'].map((d, i) => (
                                <div key={i} className="text-center">
                                  <p className="text-xs text-gray-500">{d}</p>
                                  <Icon name={['cloud', 'cloud-rain', 'sun'][i]} className="text-xs text-gray-400 my-1" />
                                  <p className="text-xs text-gray-700">{[48, 44, 50][i]}Â°</p>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          {/* Trusted By */}
          <section className="py-12 border-y border-gray-100">
            <div className="max-w-7xl mx-auto px-6">
              <p className="text-center text-sm text-gray-500 mb-8">Trusted by 500+ excavation companies across North America</p>
              <div className="flex flex-wrap items-center justify-center gap-12 opacity-50">
                {['Summit Excavating', 'Valley Grading Co.', 'Pioneer Earthworks', 'Metro Site Prep', 'Atlas Excavation'].map((company, i) => (
                  <div key={i} className="text-xl font-bold text-gray-400">{company}</div>
                ))}
              </div>
            </div>
          </section>

          {/* Features */}
          <section id="features" className="py-24 px-6">
            <div className="max-w-7xl mx-auto">
              <div className="text-center mb-16">
                <h2 className="text-4xl font-bold text-gray-900 mb-4">Everything You Need to Run Your Operation</h2>
                <p className="text-xl text-gray-600 max-w-2xl mx-auto">From job scheduling to equipment tracking, Groundwork Pro has all the tools you need in one place.</p>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {features.map((feature, i) => (
                  <div key={i} className="p-6 bg-white rounded-xl border border-gray-200 hover:border-brand-300 hover:shadow-lg transition-all group">
                    <div className="w-14 h-14 bg-brand-50 rounded-xl flex items-center justify-center mb-4 group-hover:bg-brand-100 transition-colors">
                      <Icon name={feature.icon} className="text-2xl text-brand-600" />
                    </div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-2">{feature.title}</h3>
                    <p className="text-gray-600 text-sm">{feature.desc}</p>
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* Photo Gallery Section */}
          <section className="py-16 px-6 bg-gray-100">
            <div className="max-w-7xl mx-auto">
              <div className="text-center mb-12">
                <h2 className="text-3xl font-bold text-gray-900 mb-4">Built for the Field</h2>
                <p className="text-lg text-gray-600">From excavators to dozers, track every piece of equipment in your fleet.</p>
              </div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                {[
                  { alt: 'Volvo excavator on mound', placeholder: 'GALLERY 1' },
                  { alt: 'Aerial trenching', placeholder: 'GALLERY 2' },
                  { alt: 'CAT dozer', placeholder: 'GALLERY 3' },
                  { alt: 'Operator in cab', placeholder: 'GALLERY 4' },
                  { alt: 'Wheel loader', placeholder: 'GALLERY 5' },
                  { alt: 'Excavator working', placeholder: 'GALLERY 6' },
                  { alt: 'Dozer on pile', placeholder: 'GALLERY 7' },
                  { alt: 'Dozer in woods', placeholder: 'GALLERY 8' },
                ].map((img, i) => (
                  <div key={i} className={`overflow-hidden rounded-xl ${i === 0 || i === 5 ? 'md:col-span-2 md:row-span-2' : ''}`}>
                    {IMAGES.gallery[i] && !IMAGES.gallery[i].includes('YOUR_') ? (
                      <img
                        src={IMAGES.gallery[i]}
                        alt={img.alt}
                        className="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                        style={{ minHeight: i === 0 || i === 5 ? '400px' : '190px' }}
                      />
                    ) : (
                      <div
                        className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center"
                        style={{ minHeight: i === 0 || i === 5 ? '400px' : '190px' }}
                      >
                        <div className="text-center text-gray-500">
                          <Icon name="image" className="text-3xl mb-1" />
                          <p className="text-xs font-medium">{img.placeholder}</p>
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* Stats */}
          <section className="py-20 bg-dark-900">
            <div className="max-w-7xl mx-auto px-6">
              <div className="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                {[
                  { value: '500+', label: 'Companies' },
                  { value: '50K+', label: 'Jobs Managed' },
                  { value: '98%', label: 'Customer Satisfaction' },
                  { value: '4.9/5', label: 'App Store Rating' },
                ].map((stat, i) => (
                  <div key={i}>
                    <p className="text-4xl md:text-5xl font-bold text-brand-500 mb-2">{stat.value}</p>
                    <p className="text-gray-400">{stat.label}</p>
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* Testimonials */}
          <section id="testimonials" className="py-24 px-6 bg-gray-50">
            <div className="max-w-7xl mx-auto">
              <div className="text-center mb-16">
                <h2 className="text-4xl font-bold text-gray-900 mb-4">Loved by Contractors</h2>
                <p className="text-xl text-gray-600">See what excavation professionals are saying about Groundwork Pro.</p>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {testimonials.map((t, i) => (
                  <div key={i} className="p-8 bg-white rounded-xl shadow-sm border border-gray-100">
                    <div className="flex items-center gap-1 mb-4">
                      {[1,2,3,4,5].map(s => (
                        <Icon key={s} name="star" className="text-yellow-400" />
                      ))}
                    </div>
                    <p className="text-gray-700 mb-6 leading-relaxed">"{t.quote}"</p>
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 rounded-full bg-brand-100 flex items-center justify-center text-brand-600 font-bold">
                        {t.avatar}
                      </div>
                      <div>
                        <p className="font-semibold text-gray-900">{t.name}</p>
                        <p className="text-sm text-gray-500">{t.role}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* Pricing */}
          <section id="pricing" className="py-24 px-6">
            <div className="max-w-7xl mx-auto">
              <div className="text-center mb-16">
                <h2 className="text-4xl font-bold text-gray-900 mb-4">Simple, Transparent Pricing</h2>
                <p className="text-xl text-gray-600">Start free, upgrade as you grow. No hidden fees.</p>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                {plans.map((plan, i) => (
                  <div key={i} className={`p-8 rounded-2xl ${plan.popular ? 'bg-dark-900 text-white ring-4 ring-brand-500 scale-105' : 'bg-white border border-gray-200'}`}>
                    {plan.popular && (
                      <span className="inline-block px-3 py-1 bg-brand-500 text-white text-xs font-medium rounded-full mb-4">Most Popular</span>
                    )}
                    <h3 className={`text-2xl font-bold mb-2 ${plan.popular ? 'text-white' : 'text-gray-900'}`}>{plan.name}</h3>
                    <p className={`text-sm mb-4 ${plan.popular ? 'text-gray-400' : 'text-gray-500'}`}>{plan.desc}</p>
                    <div className="mb-6">
                      <span className={`text-4xl font-bold ${plan.popular ? 'text-white' : 'text-gray-900'}`}>
                        {typeof plan.price === 'number' ? `$${plan.price}` : plan.price}
                      </span>
                      <span className={plan.popular ? 'text-gray-400' : 'text-gray-500'}>{plan.period}</span>
                    </div>
                    <ul className="space-y-3 mb-8">
                      {plan.features.map((f, j) => (
                        <li key={j} className={`flex items-center gap-2 text-sm ${plan.popular ? 'text-gray-300' : 'text-gray-600'}`}>
                          <Icon name="check" className={plan.popular ? 'text-brand-400' : 'text-brand-500'} />
                          {f}
                        </li>
                      ))}
                    </ul>
                    <button
                      onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                      className={`w-full py-3 font-semibold rounded-lg transition-colors ${
                        plan.popular
                          ? 'bg-brand-500 text-white hover:bg-brand-600'
                          : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                      }`}
                    >
                      {plan.cta}
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* CTA */}
          <section className="py-24 px-6 relative overflow-hidden">
            {/* Background Image */}
            <div className="absolute inset-0 z-0">
              {IMAGES.ctaBg && !IMAGES.ctaBg.includes('YOUR_') ? (
                <img src={IMAGES.ctaBg} alt="Construction site" className="w-full h-full object-cover" />
              ) : (
                <div className="w-full h-full bg-brand-700"></div>
              )}
              <div className="absolute inset-0 bg-brand-600/90"></div>
            </div>
            <div className="max-w-4xl mx-auto text-center relative z-10">
              <h2 className="text-4xl font-bold text-white mb-6">Ready to Transform Your Operation?</h2>
              <p className="text-xl text-brand-100 mb-10">Join 500+ excavation companies already using Groundwork Pro to streamline their business.</p>
              <button
                onClick={() => { setAuthMode('signup'); setShowAuthModal(true); }}
                className="px-10 py-4 bg-white text-brand-600 font-bold rounded-xl hover:bg-gray-100 transition-colors shadow-lg"
              >
                Start Your Free Trial
              </button>
            </div>
          </section>

          {/* Footer */}
          <footer className="py-16 px-6 bg-dark-900 text-gray-400">
            <div className="max-w-7xl mx-auto">
              <div className="grid grid-cols-2 md:grid-cols-5 gap-8 mb-12">
                <div className="col-span-2">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-10 h-10 bg-brand-500 rounded-lg flex items-center justify-center">
                      <Icon name="mountain" className="text-white text-lg" />
                    </div>
                    <div>
                      <span className="font-dozer text-2xl text-white tracking-wide">GROUNDWORK</span>
                      <span className="text-brand-500 font-dozer text-2xl tracking-wide">PRO</span>
                    </div>
                  </div>
                  <p className="text-sm leading-relaxed">The all-in-one platform for excavation and grading contractors. Manage your entire operation from one place.</p>
                </div>
                <div>
                  <h4 className="font-semibold text-white mb-4">Product</h4>
                  <ul className="space-y-2 text-sm">
                    <li><a href="#" className="hover:text-white">Features</a></li>
                    <li><a href="#" className="hover:text-white">Pricing</a></li>
                    <li><a href="#" className="hover:text-white">Integrations</a></li>
                    <li><a href="#" className="hover:text-white">Mobile App</a></li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold text-white mb-4">Company</h4>
                  <ul className="space-y-2 text-sm">
                    <li><a href="#" className="hover:text-white">About</a></li>
                    <li><a href="#" className="hover:text-white">Blog</a></li>
                    <li><a href="#" className="hover:text-white">Careers</a></li>
                    <li><a href="#" className="hover:text-white">Contact</a></li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold text-white mb-4">Support</h4>
                  <ul className="space-y-2 text-sm">
                    <li><a href="#" className="hover:text-white">Help Center</a></li>
                    <li><a href="#" className="hover:text-white">Documentation</a></li>
                    <li><a href="#" className="hover:text-white">API Reference</a></li>
                    <li><a href="#" className="hover:text-white">Status</a></li>
                  </ul>
                </div>
              </div>
              <div className="pt-8 border-t border-dark-700 flex flex-col md:flex-row items-center justify-between gap-4">
                <p className="text-sm">&copy; 2026 Groundwork Pro. All rights reserved.</p>
                <div className="flex items-center gap-6">
                  <a href="#" className="hover:text-white">Privacy Policy</a>
                  <a href="#" className="hover:text-white">Terms of Service</a>
                </div>
              </div>
            </div>
          </footer>

          {/* Auth Modal */}
          {showAuthModal && (
            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-2xl">
                <div className="p-8">
                  <div className="text-center mb-8">
                    <div className="flex items-center justify-center gap-2 mb-4">
                      <div className="w-10 h-10 bg-brand-500 rounded-lg flex items-center justify-center">
                        <Icon name="mountain" className="text-white text-lg" />
                      </div>
                      <span className="font-dozer text-2xl text-gray-900 tracking-wide">GROUNDWORK<span className="text-brand-500">PRO</span></span>
                    </div>
                    <h2 className="text-2xl font-bold text-gray-900">
                      {authMode === 'login' ? 'Welcome back' : 'Start your free trial'}
                    </h2>
                    <p className="text-gray-500 mt-1">
                      {authMode === 'login' ? 'Sign in to your account' : '14 days free. No credit card required.'}
                    </p>
                  </div>

                  <form onSubmit={handleSubmit} className="space-y-4">
                    {authMode === 'signup' && (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                          <input
                            type="text"
                            value={formData.name}
                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                            className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                            placeholder="John Doe"
                            required
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                          <input
                            type="text"
                            value={formData.company}
                            onChange={(e) => setFormData({ ...formData, company: e.target.value })}
                            className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                            placeholder="Acme Excavating"
                            required
                          />
                        </div>
                      </>
                    )}
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                      <input
                        type="email"
                        value={formData.email}
                        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                        placeholder="you@company.com"
                        required
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                      <input
                        type="password"
                        value={formData.password}
                        onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                        placeholder={authMode === 'login' ? 'â¢â¢â¢â¢â¢â¢â¢â¢' : 'Create a password'}
                        required
                      />
                    </div>
                    {authMode === 'login' && (
                      <div className="flex items-center justify-between">
                        <label className="flex items-center gap-2 text-sm text-gray-600">
                          <input type="checkbox" className="rounded border-gray-300 text-brand-500 focus:ring-brand-500" />
                          Remember me
                        </label>
                        <a href="#" className="text-sm text-brand-600 hover:text-brand-700 font-medium">Forgot password?</a>
                      </div>
                    )}
                    <button
                      type="submit"
                      className="w-full py-3 bg-brand-500 text-white font-semibold rounded-lg hover:bg-brand-600 transition-colors"
                    >
                      {authMode === 'login' ? 'Sign In' : 'Create Account'}
                    </button>
                  </form>

                  <div className="mt-6">
                    <div className="relative">
                      <div className="absolute inset-0 flex items-center">
                        <div className="w-full border-t border-gray-200"></div>
                      </div>
                      <div className="relative flex justify-center text-sm">
                        <span className="px-4 bg-white text-gray-500">or continue with</span>
                      </div>
                    </div>
                    <div className="mt-4 grid grid-cols-2 gap-3">
                      <button className="flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <Icon name="google" className="fab text-lg" />
                        <span className="text-sm font-medium text-gray-700">Google</span>
                      </button>
                      <button className="flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <Icon name="microsoft" className="fab text-lg" />
                        <span className="text-sm font-medium text-gray-700">Microsoft</span>
                      </button>
                    </div>
                  </div>

                  <p className="mt-6 text-center text-sm text-gray-500">
                    {authMode === 'login' ? "Don't have an account? " : "Already have an account? "}
                    <button
                      onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')}
                      className="text-brand-600 hover:text-brand-700 font-medium"
                    >
                      {authMode === 'login' ? 'Sign up' : 'Sign in'}
                    </button>
                  </p>
                </div>

                <button
                  onClick={() => setShowAuthModal(false)}
                  className="absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600"
                >
                  <Icon name="xmark" className="text-xl" />
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ============================================
    // ROOT - Authentication Wrapper
    // ============================================
    const Root = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);

      const handleLogin = (data) => {
        // Simulate login
        setCurrentUser({ name: data.name || 'John Doe', email: data.email, company: data.company || 'Demo Company' });
        setIsAuthenticated(true);
      };

      const handleSignup = (data) => {
        // Simulate signup
        setCurrentUser({ name: data.name, email: data.email, company: data.company });
        setIsAuthenticated(true);
      };

      const handleLogout = () => {
        setIsAuthenticated(false);
        setCurrentUser(null);
      };

      if (!isAuthenticated) {
        return <LandingPage onLogin={handleLogin} onSignup={handleSignup} />;
      }

      return <App currentUser={currentUser} onLogout={handleLogout} />;
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<Root />);
  </script>
</body>
</html>
